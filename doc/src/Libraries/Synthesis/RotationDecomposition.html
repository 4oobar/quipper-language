<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>-- | This module provides functions for decomposing a unitary /n/&#215;/n/</i></font>
<a name="line-2"></a><font color=Blue><i>-- operator into one- and two-level unitaries. </i></font>
<a name="line-3"></a><font color=Blue><i>-- </i></font>
<a name="line-4"></a><font color=Blue><i>-- The algorithm is adapted from Section 4.5.1 of Nielsen and</i></font>
<a name="line-5"></a><font color=Blue><i>-- Chuang. In addition to what is described in Nielsen and Chuang, our</i></font>
<a name="line-6"></a><font color=Blue><i>-- algorithm produces two-level operators that can be decomposed using</i></font>
<a name="line-7"></a><font color=Blue><i>-- only two Euler angles. The algorithm produces at most /n/(/n/&#8722;1)\/2</i></font>
<a name="line-8"></a><font color=Blue><i>-- two-level operators of type /R/[sub /z/](&#948;)/R/[sub /x/](&#947;), as well</i></font>
<a name="line-9"></a><font color=Blue><i>-- as /n/ one-level operators of type [exp /i/&#952;]. Therefore, the</i></font>
<a name="line-10"></a><font color=Blue><i>-- decomposition of a unitary /n/&#215;/n/ operator yields /n/[sup 2] real</i></font>
<a name="line-11"></a><font color=Blue><i>-- parameters, which is optimal.</i></font>
<a name="line-12"></a>
<a name="line-13"></a><font color=Green><u>module</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>RotationDecomposition <font color=Green><u>where</u></font>
<a name="line-14"></a>
<a name="line-15"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Matrix
<a name="line-16"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>MultiQubitSynthesis
<a name="line-17"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Ring
<a name="line-18"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>EulerAngles
<a name="line-19"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>ArcTan2
<a name="line-20"></a>
<a name="line-21"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>List
<a name="line-22"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Random
<a name="line-23"></a>
<a name="line-24"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-25"></a><font color=Blue><i>-- * Elementary rotations</i></font>
<a name="line-26"></a>
<a name="line-27"></a><a name="ElementaryRot"></a><font color=Blue><i>-- | An elementary rotation is either a combined /x/- and</i></font>
<a name="line-28"></a><a name="ElementaryRot"></a><font color=Blue><i>-- /z/-rotation, applied at indices /j/ and /k/, or a phase change</i></font>
<a name="line-29"></a><a name="ElementaryRot"></a><font color=Blue><i>-- applied at index /j/.</i></font>
<a name="line-30"></a><a name="ElementaryRot"></a><font color=Blue><i>-- </i></font>
<a name="line-31"></a><a name="ElementaryRot"></a><font color=Blue><i>-- * 'ERot_zx' &#948; &#947; /j/ /k/ represents the operator </i></font>
<a name="line-32"></a><a name="ElementaryRot"></a><font color=Blue><i>-- /R/[sub /z/](&#948;)/R/[sub /x/](&#947;), applied to levels /j/ and /k/.</i></font>
<a name="line-33"></a><a name="ElementaryRot"></a><font color=Blue><i>-- </i></font>
<a name="line-34"></a><a name="ElementaryRot"></a><font color=Blue><i>-- \[image ERot_zx.png]</i></font>
<a name="line-35"></a><a name="ElementaryRot"></a><font color=Blue><i>-- </i></font>
<a name="line-36"></a><a name="ElementaryRot"></a><font color=Blue><i>-- * 'ERot_phase' &#952; /j/ represents the operator [exp /i/&#952;] applied to level</i></font>
<a name="line-37"></a><a name="ElementaryRot"></a><font color=Blue><i>-- /j/.</i></font>
<a name="line-38"></a><a name="ElementaryRot"></a><font color=Blue><i>-- </i></font>
<a name="line-39"></a><a name="ElementaryRot"></a><font color=Blue><i>-- \[image ERot_phase.png]</i></font>
<a name="line-40"></a><a name="ElementaryRot"></a><font color=Blue><i>-- </i></font>
<a name="line-41"></a><a name="ElementaryRot"></a><font color=Blue><i>-- Note: when we use a list of 'ElementaryRot's to express a sequence of</i></font>
<a name="line-42"></a><a name="ElementaryRot"></a><font color=Blue><i>-- operators, the operators are meant to be applied right-to-left,</i></font>
<a name="line-43"></a><a name="ElementaryRot"></a><font color=Blue><i>-- i.e., as in the mathematical notation for matrix multiplication.</i></font>
<a name="line-44"></a><a name="ElementaryRot"></a><font color=Blue><i>-- This is the opposite of the quantum circuit notation.</i></font>
<a name="line-45"></a><a name="ElementaryRot"></a><font color=Green><u>data</u></font> ElementaryRot a <font color=Red>=</font> 
<a name="line-46"></a>  ERot_zx a a Index Index
<a name="line-47"></a>  <font color=Red>|</font> ERot_phase a Index
<a name="line-48"></a>    <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Show<font color=Cyan>)</font>
<a name="line-49"></a>
<a name="line-50"></a><a name="matrix_of_elementary"></a><font color=Blue><i>-- | Convert a symbolic elementary rotation to a concrete matrix.</i></font>
<a name="line-51"></a><font color=Blue>matrix_of_elementary</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>,</font> Floating a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> ElementaryRot a <font color=Red>-&gt;</font> Matrix n n <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font>
<a name="line-52"></a><font color=Blue>matrix_of_elementary</font> <font color=Cyan>(</font>ERot_zx delta gamma j k<font color=Cyan>)</font> <font color=Red>=</font> 
<a name="line-53"></a>  twolevel_matrix <font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>)</font> <font color=Cyan>(</font>c<font color=Cyan>,</font> d<font color=Cyan>)</font> j k <font color=Green><u>where</u></font>
<a name="line-54"></a>  a <font color=Red>=</font> ed' <font color=Cyan>*</font> cg
<a name="line-55"></a>  b <font color=Red>=</font> <font color=Blue><i>-</i></font>i <font color=Cyan>*</font> ed' <font color=Cyan>*</font> sg
<a name="line-56"></a>  c <font color=Red>=</font> <font color=Blue><i>-</i></font>i <font color=Cyan>*</font> ed <font color=Cyan>*</font> sg
<a name="line-57"></a>  d <font color=Red>=</font> ed <font color=Cyan>*</font> cg
<a name="line-58"></a>  cg <font color=Red>=</font> Cplx <font color=Cyan>(</font>cos <font color=Cyan>(</font>gamma<font color=Cyan>/</font><font color=Magenta>2</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Magenta>0</font>
<a name="line-59"></a>  sg <font color=Red>=</font> Cplx <font color=Cyan>(</font>sin <font color=Cyan>(</font>gamma<font color=Cyan>/</font><font color=Magenta>2</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Magenta>0</font>
<a name="line-60"></a>  ed <font color=Red>=</font> Cplx cd sd
<a name="line-61"></a>  ed' <font color=Red>=</font> Cplx cd <font color=Cyan>(</font><font color=Blue><i>-</i></font>sd<font color=Cyan>)</font>
<a name="line-62"></a>  cd <font color=Red>=</font> cos <font color=Cyan>(</font>delta<font color=Cyan>/</font><font color=Magenta>2</font><font color=Cyan>)</font> 
<a name="line-63"></a>  sd <font color=Red>=</font> sin <font color=Cyan>(</font>delta<font color=Cyan>/</font><font color=Magenta>2</font><font color=Cyan>)</font>
<a name="line-64"></a><font color=Blue>matrix_of_elementary</font> <font color=Cyan>(</font>ERot_phase theta j<font color=Cyan>)</font> <font color=Red>=</font> 
<a name="line-65"></a>  onelevel_matrix <font color=Cyan>(</font>Cplx c s<font color=Cyan>)</font> j <font color=Green><u>where</u></font>
<a name="line-66"></a>    c <font color=Red>=</font> cos theta
<a name="line-67"></a>    s <font color=Red>=</font> sin theta
<a name="line-68"></a>
<a name="line-69"></a><a name="matrix_of_elementaries"></a><font color=Blue><i>-- | Convert a sequence of elementary rotations to an /n/&#215;/n/-matrix.</i></font>
<a name="line-70"></a><font color=Blue>matrix_of_elementaries</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>,</font> Floating a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Red>[</font>ElementaryRot a<font color=Red>]</font> <font color=Red>-&gt;</font> Matrix n n <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font>
<a name="line-71"></a><font color=Blue>matrix_of_elementaries</font> ops <font color=Red>=</font>
<a name="line-72"></a>  foldl' <font color=Cyan>(</font><font color=Cyan>*</font><font color=Cyan>)</font> <font color=Magenta>1</font> <font color=Red>[</font> matrix_of_elementary op <font color=Red>|</font> op <font color=Red>&lt;-</font> ops <font color=Red>]</font>
<a name="line-73"></a>
<a name="line-74"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-75"></a><font color=Blue><i>-- * Decomposition into elementary rotations</i></font>
<a name="line-76"></a>
<a name="line-77"></a><a name="rotation_decomposition"></a><font color=Blue><i>-- | Convert an /n/&#215;/n/-matrix to a sequence of elementary rotations.</i></font>
<a name="line-78"></a><font color=Blue><i>-- </i></font>
<a name="line-79"></a><font color=Blue><i>-- Note: the list of elementary rotations will be returned in</i></font>
<a name="line-80"></a><font color=Blue><i>-- right-to-left order, i.e., as in the mathematical notation for</i></font>
<a name="line-81"></a><font color=Blue><i>-- matrix multiplication.  This is the opposite of the quantum circuit</i></font>
<a name="line-82"></a><font color=Blue><i>-- notation.</i></font>
<a name="line-83"></a><font color=Blue>rotation_decomposition</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> Fractional a<font color=Cyan>,</font> Floating a<font color=Cyan>,</font> Adjoint a<font color=Cyan>,</font> ArcTan2 a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n n <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Red>[</font>ElementaryRot a<font color=Red>]</font>
<a name="line-84"></a><font color=Blue>rotation_decomposition</font> op <font color=Red>=</font> concat gates <font color=Cyan>++</font> reverse gates' <font color=Green><u>where</u></font>
<a name="line-85"></a>  <font color=Cyan>(</font>op'<font color=Cyan>,</font> gates<font color=Cyan>)</font> <font color=Red>=</font> mapAccumL rowop op <font color=Red>[</font> <font color=Cyan>(</font>i<font color=Cyan>,</font>j<font color=Cyan>)</font> <font color=Red>|</font> j <font color=Red>&lt;-</font> <font color=Red>[</font><font color=Magenta>0</font><font color=Red>..</font>n<font color=Blue><i>-</i></font><font color=Magenta>2</font><font color=Red>]</font><font color=Cyan>,</font> i <font color=Red>&lt;-</font> <font color=Red>[</font>j<font color=Cyan>+</font><font color=Magenta>1</font><font color=Red>..</font>n<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Red>]</font> <font color=Red>]</font>
<a name="line-86"></a>  gates' <font color=Red>=</font> <font color=Red>[</font> get_phase op' i <font color=Red>|</font> i <font color=Red>&lt;-</font> <font color=Red>[</font><font color=Magenta>0</font><font color=Red>..</font>n<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Red>]</font> <font color=Red>]</font>
<a name="line-87"></a>  <font color=Cyan>(</font>n'<font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>)</font> <font color=Red>=</font> matrix_size op
<a name="line-88"></a>  n <font color=Red>=</font> fromInteger n'
<a name="line-89"></a>
<a name="line-90"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-91"></a><font color=Blue><i>-- * Auxiliary functions</i></font>
<a name="line-92"></a>
<a name="line-93"></a><a name="twolevel_matrix_of_matrix"></a><font color=Blue><i>-- | Construct a two-level /n/&#215;/n/-matrix from a given 2&#215;2-matrix and</i></font>
<a name="line-94"></a><font color=Blue><i>-- indices /j/ and /k/.</i></font>
<a name="line-95"></a><font color=Blue>twolevel_matrix_of_matrix</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix Two Two a <font color=Red>-&gt;</font> Index <font color=Red>-&gt;</font> Index <font color=Red>-&gt;</font> Matrix n n a
<a name="line-96"></a><font color=Blue>twolevel_matrix_of_matrix</font> u j k <font color=Red>=</font> op <font color=Green><u>where</u></font>
<a name="line-97"></a>  op <font color=Red>=</font> twolevel_matrix <font color=Cyan>(</font>a<font color=Cyan>,</font>b<font color=Cyan>)</font> <font color=Cyan>(</font>c<font color=Cyan>,</font>d<font color=Cyan>)</font> j k
<a name="line-98"></a>  <font color=Cyan>(</font><font color=Cyan>(</font>a<font color=Cyan>,</font>b<font color=Cyan>)</font><font color=Cyan>,</font> <font color=Cyan>(</font>c<font color=Cyan>,</font>d<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> from_matrix2x2 u
<a name="line-99"></a>  
<a name="line-100"></a><a name="get_phase"></a><font color=Blue><i>-- | Extract the phase of the /j/th diagonal entry of the given</i></font>
<a name="line-101"></a><font color=Blue><i>-- matrix.</i></font>
<a name="line-102"></a><font color=Blue>get_phase</font> <font color=Red>::</font> <font color=Cyan>(</font>ArcTan2 a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n n <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Index <font color=Red>-&gt;</font> ElementaryRot a
<a name="line-103"></a><font color=Blue>get_phase</font> op j <font color=Red>=</font> ERot_phase theta j <font color=Green><u>where</u></font>
<a name="line-104"></a>  a <font color=Red>=</font> matrix_index op j j
<a name="line-105"></a>  theta <font color=Red>=</font> arctan2 y x
<a name="line-106"></a>  Cplx x y <font color=Red>=</font> a
<a name="line-107"></a>             
<a name="line-108"></a><a name="rowop"></a><font color=Blue><i>-- | Perform a two-level operation on rows /j/ and /k/ of a matrix /U/,</i></font>
<a name="line-109"></a><font color=Blue><i>-- such that the resulting matrix has a 0 in the (/j/,/k/)-position.</i></font>
<a name="line-110"></a><font color=Blue><i>-- Return the inverse of the two-level operation used, as well as the</i></font>
<a name="line-111"></a><font color=Blue><i>-- updated matrix.</i></font>
<a name="line-112"></a><font color=Blue>rowop</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> Fractional a<font color=Cyan>,</font> Floating a<font color=Cyan>,</font> Adjoint a<font color=Cyan>,</font> ArcTan2 a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n n <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>Index<font color=Cyan>,</font> Index<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>Matrix n n <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font><font color=Cyan>,</font> <font color=Red>[</font>ElementaryRot a<font color=Red>]</font><font color=Cyan>)</font>
<a name="line-113"></a><font color=Blue>rowop</font> op <font color=Cyan>(</font>j<font color=Cyan>,</font>k<font color=Cyan>)</font> 
<a name="line-114"></a>  <font color=Red>|</font> b <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> <font color=Cyan>(</font>op<font color=Cyan>,</font> []<font color=Cyan>)</font>
<a name="line-115"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> <font color=Cyan>(</font>op'<font color=Cyan>,</font> gates<font color=Cyan>)</font> 
<a name="line-116"></a>  <font color=Green><u>where</u></font>
<a name="line-117"></a>    a <font color=Red>=</font> matrix_index op k k
<a name="line-118"></a>    b <font color=Red>=</font> matrix_index op j k
<a name="line-119"></a>    matrix <font color=Red>=</font> <font color=Magenta>1</font><font color=Cyan>/</font>Cplx <font color=Cyan>(</font>sqrt<font color=Cyan>(</font>real <font color=Cyan>(</font>a <font color=Cyan>*</font> adj a <font color=Cyan>+</font> b <font color=Cyan>*</font> adj b<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Magenta>0</font> <font color=Cyan>`scalarmult`</font> matrix2x2 <font color=Cyan>(</font>adj a<font color=Cyan>,</font> adj b<font color=Cyan>)</font> <font color=Cyan>(</font>b<font color=Cyan>,</font> <font color=Blue><i>-</i></font>a<font color=Cyan>)</font>
<a name="line-120"></a>    <font color=Cyan>(</font>alpha<font color=Cyan>,</font> beta<font color=Cyan>,</font> gamma<font color=Cyan>,</font> delta<font color=Cyan>)</font> <font color=Red>=</font> euler_angles matrix
<a name="line-121"></a>    matrix2 <font color=Red>=</font> matrix_of_euler_angles <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> gamma<font color=Cyan>,</font> delta<font color=Cyan>)</font>
<a name="line-122"></a>    op' <font color=Red>=</font> twolevel_matrix_of_matrix matrix2 k j <font color=Cyan>.*.</font> op
<a name="line-123"></a>    gates <font color=Red>=</font> <font color=Red>[</font> ERot_zx <font color=Cyan>(</font><font color=Blue><i>-</i></font>delta<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>gamma<font color=Cyan>)</font> k j <font color=Red>]</font>
<a name="line-124"></a>
<a name="line-125"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-126"></a><font color=Blue><i>-- * Testing</i></font>
<a name="line-127"></a>
<a name="line-128"></a><a name="random_unitary"></a><font color=Blue><i>-- | Return a \"random\" unitary /n/&#215;/n/-matrix. These matrices will</i></font>
<a name="line-129"></a><font color=Blue><i>-- not quite be uniformly distributed; this function is primarily</i></font>
<a name="line-130"></a><font color=Blue><i>-- meant to generate test cases. </i></font>
<a name="line-131"></a><font color=Blue>random_unitary</font> <font color=Red>::</font> <font color=Cyan>(</font>RandomGen g<font color=Cyan>,</font> Nat n<font color=Cyan>,</font> Floating a<font color=Cyan>,</font> Random a<font color=Cyan>)</font> <font color=Red>=&gt;</font> g <font color=Red>-&gt;</font> Matrix n n <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font>
<a name="line-132"></a><font color=Blue>random_unitary</font> g <font color=Red>=</font> op <font color=Green><u>where</u></font>
<a name="line-133"></a>  op <font color=Red>=</font> matrix_of_elementaries gates
<a name="line-134"></a>  gates <font color=Red>=</font> random_gates g <font color=Cyan>(</font><font color=Magenta>20</font><font color=Cyan>*</font>n<font color=Cyan>^</font><font color=Magenta>2</font><font color=Cyan>)</font>
<a name="line-135"></a>  random_gates g <font color=Magenta>0</font> <font color=Red>=</font> []
<a name="line-136"></a>  random_gates g m <font color=Red>=</font> h<font color=Red><b>:</b></font>t <font color=Green><u>where</u></font>
<a name="line-137"></a>    <font color=Cyan>(</font>gamma<font color=Cyan>,</font> g1<font color=Cyan>)</font> <font color=Red>=</font> randomR <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>2</font><font color=Cyan>*</font>pi<font color=Cyan>)</font> g
<a name="line-138"></a>    <font color=Cyan>(</font>delta<font color=Cyan>,</font> g1'<font color=Cyan>)</font> <font color=Red>=</font> randomR <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>2</font><font color=Cyan>*</font>pi<font color=Cyan>)</font> g1
<a name="line-139"></a>    <font color=Cyan>(</font>c<font color=Cyan>,</font> g2<font color=Cyan>)</font> <font color=Red>=</font> randomR <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>)</font> g1'
<a name="line-140"></a>    <font color=Cyan>(</font>j<font color=Cyan>,</font> g3<font color=Cyan>)</font> <font color=Red>=</font> randomR <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> n<font color=Blue><i>-</i></font><font color=Magenta>2</font><font color=Cyan>)</font> g2
<a name="line-141"></a>    <font color=Cyan>(</font>k<font color=Cyan>,</font> g4<font color=Cyan>)</font> <font color=Red>=</font> randomR <font color=Cyan>(</font>j<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>,</font> n<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font> g3
<a name="line-142"></a>    h <font color=Red>=</font> <font color=Green><u>case</u></font> c <font color=Red>::</font> Int <font color=Green><u>of</u></font>
<a name="line-143"></a>      <font color=Magenta>0</font> <font color=Red>-&gt;</font> ERot_zx delta gamma j k
<a name="line-144"></a>      <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> ERot_phase delta j
<a name="line-145"></a>    t <font color=Red>=</font> random_gates g4 <font color=Cyan>(</font>m<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-146"></a>  <font color=Cyan>(</font>n'<font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>)</font> <font color=Red>=</font> matrix_size op
<a name="line-147"></a>  n <font color=Red>=</font> fromInteger n'
<a name="line-148"></a>
<a name="line-149"></a><a name="test"></a><font color=Blue><i>-- | Generate a random matrix, decompose it, and then re-calculate the</i></font>
<a name="line-150"></a><font color=Blue><i>-- matrix from the decomposition.</i></font>
<a name="line-151"></a><font color=Blue>test</font> <font color=Red>::</font> IO ()
<a name="line-152"></a><font color=Blue>test</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-153"></a>  g <font color=Red>&lt;-</font> newStdGen
<a name="line-154"></a>  <font color=Green><u>let</u></font> m <font color=Red>=</font> random_unitary g <font color=Red>::</font> Matrix Four Four CDouble
<a name="line-155"></a>  <font color=Green><u>let</u></font> gates <font color=Red>=</font> rotation_decomposition m
<a name="line-156"></a>  <font color=Green><u>let</u></font> m' <font color=Red>=</font> matrix_of_elementaries gates <font color=Red>::</font> Matrix Four Four CDouble
<a name="line-157"></a>  putStrLn <font color=Cyan>$</font> <font color=Magenta>"m = "</font> <font color=Cyan>++</font> show m
<a name="line-158"></a>  putStrLn <font color=Cyan>$</font> <font color=Magenta>"gates = "</font> <font color=Cyan>++</font> show gates
<a name="line-159"></a>  putStrLn <font color=Cyan>$</font> <font color=Magenta>"m' = "</font> <font color=Cyan>++</font> show m'
<a name="line-160"></a>  
</pre>
</body>
</html>