<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>{-# LANGUAGE TypeFamilies #-}</i></font>
<a name="line-2"></a><font color=Blue><i>{-# LANGUAGE ScopedTypeVariables #-}</i></font>
<a name="line-3"></a><font color=Blue><i>{-# LANGUAGE TypeOperators #-}</i></font>
<a name="line-4"></a><font color=Blue><i>{-# LANGUAGE GADTs #-}</i></font>
<a name="line-5"></a><font color=Blue><i>{-# LANGUAGE FlexibleInstances #-}</i></font>
<a name="line-6"></a><font color=Blue><i>{-# LANGUAGE MultiParamTypeClasses #-}</i></font>
<a name="line-7"></a><font color=Blue><i>{-# LANGUAGE UndecidableInstances #-}</i></font>
<a name="line-8"></a><font color=Blue><i>{-# LANGUAGE FlexibleContexts #-}</i></font>
<a name="line-9"></a><font color=Blue><i>{-# LANGUAGE OverlappingInstances #-}</i></font>
<a name="line-10"></a><font color=Blue><i>{-# LANGUAGE IncoherentInstances #-}</i></font>
<a name="line-11"></a>
<a name="line-12"></a><font color=Blue><i>{-# OPTIONS_GHC -fno-warn-incomplete-patterns #-}</i></font>
<a name="line-13"></a>
<a name="line-14"></a><font color=Blue><i>-- | This module provides fixed but arbitrary sized vectors and</i></font>
<a name="line-15"></a><font color=Blue><i>-- matrices. The dimensions of the vectors and matrices are determined</i></font>
<a name="line-16"></a><font color=Blue><i>-- by the type, for example,</i></font>
<a name="line-17"></a><font color=Blue><i>-- </i></font>
<a name="line-18"></a><font color=Blue><i>-- &gt; Matrix Two Three Complex</i></font>
<a name="line-19"></a><font color=Blue><i>-- </i></font>
<a name="line-20"></a><font color=Blue><i>-- for complex 2&#215;3-matrices. The type system ensures that there are no</i></font>
<a name="line-21"></a><font color=Blue><i>-- run-time dimension errors.</i></font>
<a name="line-22"></a>
<a name="line-23"></a><font color=Green><u>module</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Matrix <font color=Green><u>where</u></font>
<a name="line-24"></a>
<a name="line-25"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Ring
<a name="line-26"></a>
<a name="line-27"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-28"></a><font color=Blue><i>-- * Type-level natural numbers</i></font>
<a name="line-29"></a>  
<a name="line-30"></a><font color=Blue><i>-- $ Note: with Haskell 7.4.2 data-kinds, this could be replaced by a</i></font>
<a name="line-31"></a><font color=Blue><i>-- tighter definition; however, the following works just fine in</i></font>
<a name="line-32"></a><font color=Blue><i>-- Haskell 7.2.</i></font>
<a name="line-33"></a>
<a name="line-34"></a><a name="Zero"></a><font color=Blue><i>-- | Type-level representation of zero.</i></font>
<a name="line-35"></a><a name="Zero"></a><font color=Green><u>data</u></font> Zero
<a name="line-36"></a>
<a name="line-37"></a><a name="Succ"></a><font color=Blue><i>-- | Type-level representation of successor.</i></font>
<a name="line-38"></a><a name="Succ"></a><font color=Green><u>data</u></font> Succ a
<a name="line-39"></a>
<a name="line-40"></a><a name="One"></a><font color=Blue><i>-- | The natural number 1 as a type.</i></font>
<a name="line-41"></a><a name="One"></a><font color=Green><u>type</u></font> One <font color=Red>=</font> Succ Zero
<a name="line-42"></a>
<a name="line-43"></a><a name="Two"></a><font color=Blue><i>-- | The natural number 2 as a type.</i></font>
<a name="line-44"></a><a name="Two"></a><font color=Green><u>type</u></font> Two <font color=Red>=</font> Succ One
<a name="line-45"></a>
<a name="line-46"></a><a name="Three"></a><font color=Blue><i>-- | The natural number 3 as a type.</i></font>
<a name="line-47"></a><a name="Three"></a><font color=Green><u>type</u></font> Three <font color=Red>=</font> Succ Two
<a name="line-48"></a>
<a name="line-49"></a><a name="Four"></a><font color=Blue><i>-- | The natural number 4 as a type.</i></font>
<a name="line-50"></a><a name="Four"></a><font color=Green><u>type</u></font> Four <font color=Red>=</font> Succ Three
<a name="line-51"></a>
<a name="line-52"></a><a name="Five"></a><font color=Blue><i>-- | The natural number 5 as a type.</i></font>
<a name="line-53"></a><a name="Five"></a><font color=Green><u>type</u></font> Five <font color=Red>=</font> Succ Four
<a name="line-54"></a>
<a name="line-55"></a><a name="Six"></a><font color=Blue><i>-- | The natural number 6 as a type.</i></font>
<a name="line-56"></a><a name="Six"></a><font color=Green><u>type</u></font> Six <font color=Red>=</font> Succ Five
<a name="line-57"></a>
<a name="line-58"></a><a name="Seven"></a><font color=Blue><i>-- | The natural number 7 as a type.</i></font>
<a name="line-59"></a><a name="Seven"></a><font color=Green><u>type</u></font> Seven <font color=Red>=</font> Succ Six
<a name="line-60"></a>
<a name="line-61"></a><a name="Eight"></a><font color=Blue><i>-- | The natural number 8 as a type.</i></font>
<a name="line-62"></a><a name="Eight"></a><font color=Green><u>type</u></font> Eight <font color=Red>=</font> Succ Seven
<a name="line-63"></a>
<a name="line-64"></a><a name="Nine"></a><font color=Blue><i>-- | The natural number 9 as a type.</i></font>
<a name="line-65"></a><a name="Nine"></a><font color=Green><u>type</u></font> Nine <font color=Red>=</font> Succ Eight
<a name="line-66"></a>
<a name="line-67"></a><a name="Ten"></a><font color=Blue><i>-- | The natural number 10 as a type.</i></font>
<a name="line-68"></a><a name="Ten"></a><font color=Green><u>type</u></font> Ten <font color=Red>=</font> Succ Nine
<a name="line-69"></a>
<a name="line-70"></a><a name="Ten_and"></a><font color=Blue><i>-- | The 10th successor of a natural number type. For example, the</i></font>
<a name="line-71"></a><a name="Ten_and"></a><font color=Blue><i>-- natural number 18 as a type is</i></font>
<a name="line-72"></a><a name="Ten_and"></a><font color=Blue><i>-- </i></font>
<a name="line-73"></a><a name="Ten_and"></a><font color=Blue><i>-- &gt; Ten_and Eight</i></font>
<a name="line-74"></a><a name="Ten_and"></a><font color=Green><u>type</u></font> Ten_and a <font color=Red>=</font> Succ <font color=Cyan>(</font>Succ <font color=Cyan>(</font>Succ <font color=Cyan>(</font>Succ <font color=Cyan>(</font>Succ <font color=Cyan>(</font>Succ <font color=Cyan>(</font>Succ <font color=Cyan>(</font>Succ <font color=Cyan>(</font>Succ <font color=Cyan>(</font>Succ a<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-75"></a>
<a name="line-76"></a><a name="NNat"></a><font color=Blue><i>-- | A data type for the natural numbers. Specifically, if /n/ is a</i></font>
<a name="line-77"></a><a name="NNat"></a><font color=Blue><i>-- type-level natural number, then</i></font>
<a name="line-78"></a><a name="NNat"></a><font color=Blue><i>-- </i></font>
<a name="line-79"></a><a name="NNat"></a><font color=Blue><i>-- &gt; NNat n</i></font>
<a name="line-80"></a><a name="NNat"></a><font color=Blue><i>-- </i></font>
<a name="line-81"></a><a name="NNat"></a><font color=Blue><i>-- is a singleton type containing only the natural number /n/.</i></font>
<a name="line-82"></a><a name="NNat"></a><font color=Green><u>data</u></font> NNat <font color=Red>::</font> <font color=Cyan>*</font> <font color=Red>-&gt;</font> <font color=Cyan>*</font> <font color=Green><u>where</u></font>
<a name="line-83"></a>  Zero <font color=Red>::</font> NNat Zero
<a name="line-84"></a>  Succ <font color=Red>::</font> <font color=Cyan>(</font>Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> NNat n <font color=Red>-&gt;</font> NNat <font color=Cyan>(</font>Succ n<font color=Cyan>)</font>
<a name="line-85"></a>
<a name="line-86"></a><a name="fromNNat"></a><font color=Blue><i>-- | Convert an 'NNat' to an 'Integer'.</i></font>
<a name="line-87"></a><font color=Blue>fromNNat</font> <font color=Red>::</font> NNat n <font color=Red>-&gt;</font> Integer
<a name="line-88"></a><font color=Blue>fromNNat</font> Zero <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-89"></a><font color=Blue>fromNNat</font> <font color=Cyan>(</font>Succ n<font color=Cyan>)</font> <font color=Red>=</font> <font color=Magenta>1</font> <font color=Cyan>+</font> fromNNat n
<a name="line-90"></a>
<a name="line-91"></a><font color=Green><u>instance</u></font> Show <font color=Cyan>(</font>NNat n<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-92"></a>  show <font color=Red>=</font> show <font color=Cyan>.</font> fromNNat
<a name="line-93"></a>
<a name="line-94"></a><a name="Nat"></a><font color=Blue><i>-- | A type class for the natural numbers. The members are exactly the</i></font>
<a name="line-95"></a><a name="Nat"></a><font color=Blue><i>-- type-level natural numbers.</i></font>
<a name="line-96"></a><a name="Nat"></a><font color=Green><u>class</u></font> Nat n <font color=Green><u>where</u></font>
<a name="line-97"></a>  <font color=Blue><i>-- | Return a term-level natural number corresponding to this</i></font>
<a name="line-98"></a>  <font color=Blue><i>-- type-level natural number.</i></font>
<a name="line-99"></a>  nnat <font color=Red>::</font> NNat n
<a name="line-100"></a>  
<a name="line-101"></a>  <font color=Blue><i>-- | Return a term-level integer corresponding to this type-level</i></font>
<a name="line-102"></a>  <font color=Blue><i>-- natural number. The argument is just a dummy argument and is not</i></font>
<a name="line-103"></a>  <font color=Blue><i>-- evaluated.</i></font>
<a name="line-104"></a>  nat <font color=Red>::</font> n <font color=Red>-&gt;</font> Integer
<a name="line-105"></a>  
<a name="line-106"></a><font color=Green><u>instance</u></font> Nat Zero <font color=Green><u>where</u></font>
<a name="line-107"></a>  nnat <font color=Red>=</font> Zero
<a name="line-108"></a>  nat n <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-109"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Nat a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Nat <font color=Cyan>(</font>Succ a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-110"></a>  nnat <font color=Red>=</font> Succ nnat
<a name="line-111"></a>  nat n <font color=Red>=</font> <font color=Magenta>1</font> <font color=Cyan>+</font> nat <font color=Cyan>(</font>un n<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-112"></a>    un <font color=Red>::</font> Succ a <font color=Red>-&gt;</font> a
<a name="line-113"></a>    un <font color=Red>=</font> undefined
<a name="line-114"></a>
<a name="line-115"></a><font color=Blue><i>-- | Addition of type-level natural numbers.</i></font>
<a name="line-116"></a><font color=Green><u>type</u></font> family Plus n m
<a name="line-117"></a><font color=Green><u>type</u></font> <font color=Green><u>instance</u></font> Zero <font color=Cyan>`Plus`</font> m <font color=Red>=</font> m
<a name="line-118"></a><font color=Green><u>type</u></font> <font color=Green><u>instance</u></font> <font color=Cyan>(</font>Succ n<font color=Cyan>)</font> <font color=Cyan>`Plus`</font> m <font color=Red>=</font> Succ <font color=Cyan>(</font>n <font color=Cyan>`Plus`</font> m<font color=Cyan>)</font>
<a name="line-119"></a>
<a name="line-120"></a><font color=Blue><i>-- | Multiplication of type-level natural numbers.</i></font>
<a name="line-121"></a><font color=Green><u>type</u></font> family Times n m
<a name="line-122"></a><font color=Green><u>type</u></font> <font color=Green><u>instance</u></font> Zero <font color=Cyan>`Times`</font> m <font color=Red>=</font> Zero
<a name="line-123"></a><font color=Green><u>type</u></font> <font color=Green><u>instance</u></font> <font color=Cyan>(</font>Succ n<font color=Cyan>)</font> <font color=Cyan>`Times`</font> m <font color=Red>=</font> m <font color=Cyan>`Plus`</font> <font color=Cyan>(</font>n <font color=Cyan>`Times`</font> m<font color=Cyan>)</font>
<a name="line-124"></a>
<a name="line-125"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-126"></a><font color=Blue><i>-- * Fixed-length vectors</i></font>
<a name="line-127"></a>
<a name="line-128"></a><a name="Eq"></a><font color=Blue><i>-- | @Vector /n/ /a/@ is the type of lists of length /n/ with elements</i></font>
<a name="line-129"></a><a name="Eq"></a><font color=Blue><i>-- from /a/. We call this a \"vector\" rather than a tuple or list for</i></font>
<a name="line-130"></a><a name="Eq"></a><font color=Blue><i>-- two reasons: the vectors are homogeneous (all elements have the</i></font>
<a name="line-131"></a><a name="Eq"></a><font color=Blue><i>-- same type), and they are strict: if any one component is undefined,</i></font>
<a name="line-132"></a><a name="Eq"></a><font color=Blue><i>-- the whole vector is undefined.</i></font>
<a name="line-133"></a><a name="Eq"></a><font color=Green><u>data</u></font> Vector <font color=Red>::</font> <font color=Cyan>*</font> <font color=Red>-&gt;</font> <font color=Cyan>*</font> <font color=Red>-&gt;</font> <font color=Cyan>*</font> <font color=Green><u>where</u></font>
<a name="line-134"></a>  Nil <font color=Red>::</font> Vector Zero a
<a name="line-135"></a>  Cons <font color=Red>::</font> <font color=Cyan>!</font>a <font color=Red>-&gt;</font> <font color=Cyan>!</font><font color=Cyan>(</font>Vector n a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Vector <font color=Cyan>(</font>Succ n<font color=Cyan>)</font> a
<a name="line-136"></a>
<a name="line-137"></a><font color=Green><u>infixr</u></font> <font color=Magenta>5</font> <font color=Cyan>`Cons`</font>
<a name="line-138"></a>
<a name="line-139"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Eq <font color=Cyan>(</font>Vector n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-140"></a>  Nil <font color=Cyan>==</font> Nil <font color=Red>=</font> True
<a name="line-141"></a>  Cons a <font color=Green><u>as</u></font> <font color=Cyan>==</font> Cons b bs <font color=Red>=</font> a <font color=Cyan>==</font> b <font color=Cyan>&amp;&amp;</font> <font color=Green><u>as</u></font> <font color=Cyan>==</font> bs
<a name="line-142"></a>
<a name="line-143"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Show a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>Vector n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-144"></a>  show <font color=Red>=</font> show <font color=Cyan>.</font> list_of_vector
<a name="line-145"></a>
<a name="line-146"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToDyadic a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToDyadic <font color=Cyan>(</font>Vector n a<font color=Cyan>)</font> <font color=Cyan>(</font>Vector n b<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-147"></a>  maybe_dyadic <font color=Green><u>as</u></font> <font color=Red>=</font> vector_sequence <font color=Cyan>(</font>vector_map maybe_dyadic <font color=Green><u>as</u></font><font color=Cyan>)</font>
<a name="line-148"></a>
<a name="line-149"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>WholePart a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> WholePart <font color=Cyan>(</font>Vector n a<font color=Cyan>)</font> <font color=Cyan>(</font>Vector n b<font color=Cyan>)</font> <font color=Green><u>where</u></font>  
<a name="line-150"></a>  from_whole <font color=Red>=</font> vector_map from_whole
<a name="line-151"></a>  to_whole <font color=Red>=</font> vector_map to_whole
<a name="line-152"></a>  
<a name="line-153"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>DenomExp a<font color=Cyan>)</font> <font color=Red>=&gt;</font> DenomExp <font color=Cyan>(</font>Vector n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-154"></a>  denomexp <font color=Green><u>as</u></font> <font color=Red>=</font> denomexp <font color=Cyan>(</font>list_of_vector <font color=Green><u>as</u></font><font color=Cyan>)</font>
<a name="line-155"></a>  denomexp_factor <font color=Green><u>as</u></font> k <font color=Red>=</font> vector_map <font color=Cyan>(</font><font color=Red>\</font>a <font color=Red>-&gt;</font> denomexp_factor a k<font color=Cyan>)</font> <font color=Green><u>as</u></font>
<a name="line-156"></a>  
<a name="line-157"></a><a name="vector_singleton"></a><font color=Blue><i>-- | Construct a vector of length 1.</i></font>
<a name="line-158"></a><font color=Blue>vector_singleton</font> <font color=Red>::</font> a <font color=Red>-&gt;</font> Vector One a
<a name="line-159"></a><font color=Blue>vector_singleton</font> x <font color=Red>=</font> x <font color=Cyan>`Cons`</font> Nil
<a name="line-160"></a>
<a name="line-161"></a><a name="vector_length"></a><font color=Blue><i>-- | Return the length of a vector. Since this information is</i></font>
<a name="line-162"></a><font color=Blue><i>-- contained in the type, the vector argument is never evaluated and</i></font>
<a name="line-163"></a><font color=Blue><i>-- can be a dummy (undefined) argument.</i></font>
<a name="line-164"></a><font color=Blue>vector_length</font> <font color=Red>::</font> <font color=Cyan>(</font>Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector n a <font color=Red>-&gt;</font> Integer
<a name="line-165"></a><font color=Blue>vector_length</font> <font color=Red>=</font> nat <font color=Cyan>.</font> un <font color=Green><u>where</u></font>
<a name="line-166"></a>  un <font color=Red>::</font> Vector n a <font color=Red>-&gt;</font> n
<a name="line-167"></a>  un <font color=Red>=</font> undefined
<a name="line-168"></a>
<a name="line-169"></a><a name="list_of_vector"></a><font color=Blue><i>-- | Convert a fixed-length list to an ordinary list.</i></font>
<a name="line-170"></a><font color=Blue>list_of_vector</font> <font color=Red>::</font> Vector n a <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font>
<a name="line-171"></a><font color=Blue>list_of_vector</font> Nil <font color=Red>=</font> []
<a name="line-172"></a><font color=Blue>list_of_vector</font> <font color=Cyan>(</font>Cons h t<font color=Cyan>)</font> <font color=Red>=</font> h <font color=Red><b>:</b></font> list_of_vector t
<a name="line-173"></a>
<a name="line-174"></a><a name="vector_zipwith"></a><font color=Blue><i>-- | Zip two equal length lists.</i></font>
<a name="line-175"></a><font color=Blue>vector_zipwith</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> c<font color=Cyan>)</font> <font color=Red>-&gt;</font> Vector n a <font color=Red>-&gt;</font> Vector n b <font color=Red>-&gt;</font> Vector n c
<a name="line-176"></a><font color=Blue>vector_zipwith</font> f Nil Nil <font color=Red>=</font> Nil
<a name="line-177"></a><font color=Blue>vector_zipwith</font> f <font color=Cyan>(</font>Cons a <font color=Green><u>as</u></font><font color=Cyan>)</font> <font color=Cyan>(</font>Cons b bs<font color=Cyan>)</font> <font color=Red>=</font> Cons c cs <font color=Green><u>where</u></font>
<a name="line-178"></a>  c <font color=Red>=</font> f a b
<a name="line-179"></a>  cs <font color=Red>=</font> vector_zipwith f <font color=Green><u>as</u></font> bs
<a name="line-180"></a>
<a name="line-181"></a><a name="vector_map"></a><font color=Blue><i>-- | Map a function over a fixed-length list.</i></font>
<a name="line-182"></a><font color=Blue>vector_map</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> Vector n a <font color=Red>-&gt;</font> Vector n b
<a name="line-183"></a><font color=Blue>vector_map</font> f Nil <font color=Red>=</font> Nil
<a name="line-184"></a><font color=Blue>vector_map</font> f <font color=Cyan>(</font>Cons a <font color=Green><u>as</u></font><font color=Cyan>)</font> <font color=Red>=</font> Cons <font color=Cyan>(</font>f a<font color=Cyan>)</font> <font color=Cyan>(</font>vector_map f <font color=Green><u>as</u></font><font color=Cyan>)</font>
<a name="line-185"></a>
<a name="line-186"></a><a name="vector_enum"></a><font color=Blue><i>-- | Create the vector (0, 1, &#8230;, /n/-1).</i></font>
<a name="line-187"></a><font color=Blue>vector_enum</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector n a
<a name="line-188"></a><font color=Blue>vector_enum</font> <font color=Red>=</font> aux nnat <font color=Magenta>0</font> <font color=Green><u>where</u></font>
<a name="line-189"></a>  aux <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> NNat n <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> Vector n a
<a name="line-190"></a>  aux Zero a <font color=Red>=</font> Nil
<a name="line-191"></a>  aux <font color=Cyan>(</font>Succ n<font color=Cyan>)</font> a <font color=Red>=</font> Cons a <font color=Cyan>(</font>aux n <font color=Cyan>(</font>a<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-192"></a>
<a name="line-193"></a><a name="vector_of_function"></a><font color=Blue><i>-- | Create the vector (/f/(0), /f/(1), &#8230;, /f/(/n/-1)).</i></font>
<a name="line-194"></a><font color=Blue>vector_of_function</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> Vector n b
<a name="line-195"></a><font color=Blue>vector_of_function</font> f <font color=Red>=</font> vector_map f vector_enum
<a name="line-196"></a>
<a name="line-197"></a><a name="vector"></a><font color=Blue><i>-- | Construct a vector from a list. Note: since the length of the</i></font>
<a name="line-198"></a><font color=Blue><i>-- vector is a type-level integer, it cannot be inferred from the</i></font>
<a name="line-199"></a><font color=Blue><i>-- length of the input list; instead, it must be specified explicitly</i></font>
<a name="line-200"></a><font color=Blue><i>-- in the type. It is an error to apply this function to a list of</i></font>
<a name="line-201"></a><font color=Blue><i>-- the wrong length.</i></font>
<a name="line-202"></a><font color=Blue>vector</font> <font color=Red>::</font> <font color=Cyan>(</font>Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> Vector n a
<a name="line-203"></a><font color=Blue>vector</font> <font color=Red>=</font> aux nnat <font color=Green><u>where</u></font>
<a name="line-204"></a>  aux <font color=Red>::</font> NNat n <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>-&gt;</font> Vector n a
<a name="line-205"></a>  aux Zero [] <font color=Red>=</font> Nil
<a name="line-206"></a>  aux <font color=Cyan>(</font>Succ n<font color=Cyan>)</font> <font color=Cyan>(</font>h<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> Cons h <font color=Cyan>(</font>aux n t<font color=Cyan>)</font>
<a name="line-207"></a>  aux <font color=Green><u>_</u></font> <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"vector: length mismatch"</font>
<a name="line-208"></a>
<a name="line-209"></a><a name="vector_index"></a><font color=Blue><i>-- | Return the /i/th element of the vector. Counting starts from 0.</i></font>
<a name="line-210"></a><font color=Blue><i>-- Throws an error if the index is out of range.</i></font>
<a name="line-211"></a><font color=Blue>vector_index</font> <font color=Red>::</font> <font color=Cyan>(</font>Integral i<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector n a <font color=Red>-&gt;</font> i <font color=Red>-&gt;</font> a
<a name="line-212"></a><font color=Blue>vector_index</font> v i <font color=Red>=</font> list_of_vector v <font color=Cyan>!!</font> fromIntegral i
<a name="line-213"></a>
<a name="line-214"></a><a name="vector_repeat"></a><font color=Blue><i>-- | Return a fixed-length list consisting of a repetition of the</i></font>
<a name="line-215"></a><font color=Blue><i>-- given element. Unlike 'replicate', no count is needed, because this</i></font>
<a name="line-216"></a><font color=Blue><i>-- information is already contained in the type. However, the type</i></font>
<a name="line-217"></a><font color=Blue><i>-- must of course be inferable from the context.</i></font>
<a name="line-218"></a><font color=Blue>vector_repeat</font> <font color=Red>::</font> <font color=Cyan>(</font>Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> Vector n a
<a name="line-219"></a><font color=Blue>vector_repeat</font> x <font color=Red>=</font> vector_of_function <font color=Cyan>(</font>const x<font color=Cyan>)</font>
<a name="line-220"></a>
<a name="line-221"></a><a name="vector_transpose"></a><font color=Blue><i>-- | Turn a list of columns into a list of rows.</i></font>
<a name="line-222"></a><font color=Blue>vector_transpose</font> <font color=Red>::</font> <font color=Cyan>(</font>Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector n <font color=Cyan>(</font>Vector m a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Vector m <font color=Cyan>(</font>Vector n a<font color=Cyan>)</font>
<a name="line-223"></a><font color=Blue>vector_transpose</font> Nil <font color=Red>=</font> vector_repeat Nil
<a name="line-224"></a><font color=Blue>vector_transpose</font> <font color=Cyan>(</font>Cons a <font color=Green><u>as</u></font><font color=Cyan>)</font> <font color=Red>=</font> vector_zipwith Cons a <font color=Cyan>(</font>vector_transpose <font color=Green><u>as</u></font><font color=Cyan>)</font>
<a name="line-225"></a>
<a name="line-226"></a><a name="vector_foldl"></a><font color=Blue><i>-- | Left strict fold over a fixed-length list.</i></font>
<a name="line-227"></a><font color=Blue>vector_foldl</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> Vector n b <font color=Red>-&gt;</font> a
<a name="line-228"></a><font color=Blue>vector_foldl</font> f x l <font color=Red>=</font> foldl f x <font color=Cyan>(</font>list_of_vector l<font color=Cyan>)</font>
<a name="line-229"></a>
<a name="line-230"></a><a name="vector_foldr"></a><font color=Blue><i>-- | Right fold over a fixed-length list.</i></font>
<a name="line-231"></a><font color=Blue>vector_foldr</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> Vector n a <font color=Red>-&gt;</font> b
<a name="line-232"></a><font color=Blue>vector_foldr</font> f x l <font color=Red>=</font> foldr f x <font color=Cyan>(</font>list_of_vector l<font color=Cyan>)</font>
<a name="line-233"></a>
<a name="line-234"></a><a name="vector_tail"></a><font color=Blue><i>-- | Return the tail of a fixed-length list. Note that the type system</i></font>
<a name="line-235"></a><font color=Blue><i>-- ensures that this never fails.</i></font>
<a name="line-236"></a><font color=Blue>vector_tail</font> <font color=Red>::</font> Vector <font color=Cyan>(</font>Succ n<font color=Cyan>)</font> a <font color=Red>-&gt;</font> Vector n a
<a name="line-237"></a><font color=Blue>vector_tail</font> <font color=Cyan>(</font>Cons h t<font color=Cyan>)</font> <font color=Red>=</font> t
<a name="line-238"></a>
<a name="line-239"></a><a name="vector_head"></a><font color=Blue><i>-- | Return the head of a fixed-length list. Note that the type system</i></font>
<a name="line-240"></a><font color=Blue><i>-- ensures that this never fails.</i></font>
<a name="line-241"></a><font color=Blue>vector_head</font> <font color=Red>::</font> Vector <font color=Cyan>(</font>Succ n<font color=Cyan>)</font> a <font color=Red>-&gt;</font> a
<a name="line-242"></a><font color=Blue>vector_head</font> <font color=Cyan>(</font>Cons h t<font color=Cyan>)</font> <font color=Red>=</font> h
<a name="line-243"></a>
<a name="line-244"></a><a name="vector_append"></a><font color=Blue><i>-- | Append two fixed-length lists.</i></font>
<a name="line-245"></a><font color=Blue>vector_append</font> <font color=Red>::</font> Vector n a <font color=Red>-&gt;</font> Vector m a <font color=Red>-&gt;</font> Vector <font color=Cyan>(</font>n <font color=Cyan>`Plus`</font> m<font color=Cyan>)</font> a
<a name="line-246"></a><font color=Blue>vector_append</font> Nil v <font color=Red>=</font> v
<a name="line-247"></a><font color=Blue>vector_append</font> <font color=Cyan>(</font>Cons h t<font color=Cyan>)</font> v <font color=Red>=</font> Cons h <font color=Cyan>(</font>vector_append t v<font color=Cyan>)</font>
<a name="line-248"></a>
<a name="line-249"></a><a name="vector_sequence"></a><font color=Blue><i>-- | Version of 'sequence' for fixed-length lists.</i></font>
<a name="line-250"></a><font color=Blue>vector_sequence</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector n <font color=Cyan>(</font>m a<font color=Cyan>)</font> <font color=Red>-&gt;</font> m <font color=Cyan>(</font>Vector n a<font color=Cyan>)</font>
<a name="line-251"></a><font color=Blue>vector_sequence</font> Nil <font color=Red>=</font> return Nil
<a name="line-252"></a><font color=Blue>vector_sequence</font> <font color=Cyan>(</font>Cons a <font color=Green><u>as</u></font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-253"></a>  a' <font color=Red>&lt;-</font> a
<a name="line-254"></a>  as' <font color=Red>&lt;-</font> vector_sequence <font color=Green><u>as</u></font>
<a name="line-255"></a>  return <font color=Cyan>(</font>Cons a' as'<font color=Cyan>)</font>
<a name="line-256"></a>
<a name="line-257"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-258"></a><font color=Blue><i>-- * Matrices</i></font>
<a name="line-259"></a>
<a name="line-260"></a><a name="Matrix"></a><font color=Blue><i>-- | An /m/&#215;/n/-matrix is a list of /n/ columns, each of which is a</i></font>
<a name="line-261"></a><a name="Matrix"></a><font color=Blue><i>-- list of /m/ scalars.  The type of square matrices of any fixed</i></font>
<a name="line-262"></a><a name="Matrix"></a><font color=Blue><i>-- dimension is an instance of the 'Ring' class, and therefore the</i></font>
<a name="line-263"></a><a name="Matrix"></a><font color=Blue><i>-- usual symbols, such as \"'+'\" and \"'*'\" can be used on</i></font>
<a name="line-264"></a><a name="Matrix"></a><font color=Blue><i>-- them. However, the non-square matrices, the symbols \"'.+.'\" and</i></font>
<a name="line-265"></a><a name="Matrix"></a><font color=Blue><i>-- \"'.*.'\" must be used.</i></font>
<a name="line-266"></a><a name="Matrix"></a><font color=Green><u>data</u></font> Matrix m n a <font color=Red>=</font> Matrix <font color=Cyan>!</font><font color=Cyan>(</font>Vector n <font color=Cyan>(</font>Vector m a<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-267"></a>               <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Eq<font color=Cyan>)</font>
<a name="line-268"></a>
<a name="line-269"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Nat m<font color=Cyan>,</font> Show a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>Matrix m n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-270"></a>  show m <font color=Red>=</font> <font color=Magenta>"Matrix"</font> <font color=Cyan>++</font> string_of_rows rows <font color=Green><u>where</u></font>
<a name="line-271"></a>    rows <font color=Red>=</font> from_matrix <font color=Cyan>(</font>matrix_transpose m<font color=Cyan>)</font>
<a name="line-272"></a>    
<a name="line-273"></a>    string_of_rows <font color=Red>=</font> string_of_list <font color=Magenta>"("</font> <font color=Magenta>","</font> <font color=Magenta>")"</font> <font color=Magenta>"()"</font> string_of_elts
<a name="line-274"></a>    string_of_elts <font color=Red>=</font> string_of_list <font color=Magenta>"("</font> <font color=Magenta>","</font> <font color=Magenta>")"</font> <font color=Magenta>"()"</font> show
<a name="line-275"></a>    
<a name="line-276"></a>    string_of_list <font color=Red>::</font> String <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> String <font color=Red>-&gt;</font> <font color=Cyan>(</font>t <font color=Red>-&gt;</font> String<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Red>[</font>t<font color=Red>]</font> <font color=Red>-&gt;</font> String
<a name="line-277"></a>    string_of_list lpar comma rpar nil string_of_elt lst <font color=Red>=</font>
<a name="line-278"></a>      <font color=Green><u>case</u></font> lst <font color=Green><u>of</u></font>
<a name="line-279"></a>        [] <font color=Red>-&gt;</font> nil
<a name="line-280"></a>        h<font color=Red><b>:</b></font>t <font color=Red>-&gt;</font> lpar <font color=Cyan>++</font> string_of_elt h <font color=Cyan>++</font> string_of_tail t <font color=Cyan>++</font> rpar
<a name="line-281"></a>      <font color=Green><u>where</u></font> string_of_tail lst <font color=Red>=</font>
<a name="line-282"></a>              <font color=Green><u>case</u></font> lst <font color=Green><u>of</u></font>
<a name="line-283"></a>                [] <font color=Red>-&gt;</font> <font color=Magenta>""</font>
<a name="line-284"></a>                h<font color=Red><b>:</b></font>t <font color=Red>-&gt;</font> comma <font color=Cyan>++</font> string_of_elt h <font color=Cyan>++</font> string_of_tail t
<a name="line-285"></a>  
<a name="line-286"></a><font color=Blue><i>-- This is an overlapping instance.</i></font>
<a name="line-287"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>Matrix m n DReal<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-288"></a>  showsPrec <font color=Red>=</font> showsPrec_DenomExp
<a name="line-289"></a>  
<a name="line-290"></a><font color=Blue><i>-- This is an overlapping instance.</i></font>
<a name="line-291"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>Matrix m n DComplex<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-292"></a>  showsPrec <font color=Red>=</font> showsPrec_DenomExp
<a name="line-293"></a>
<a name="line-294"></a><font color=Blue><i>-- This is an overlapping instance.</i></font>
<a name="line-295"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>Matrix m n DOmega<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-296"></a>  showsPrec <font color=Red>=</font> showsPrec_DenomExp
<a name="line-297"></a>  
<a name="line-298"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToDyadic a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToDyadic <font color=Cyan>(</font>Matrix m n a<font color=Cyan>)</font> <font color=Cyan>(</font>Matrix m n b<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-299"></a>  maybe_dyadic <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-300"></a>    b <font color=Red>&lt;-</font> maybe_dyadic a
<a name="line-301"></a>    return <font color=Cyan>(</font>Matrix b<font color=Cyan>)</font>
<a name="line-302"></a>
<a name="line-303"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>WholePart a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> WholePart <font color=Cyan>(</font>Matrix m n a<font color=Cyan>)</font> <font color=Cyan>(</font>Matrix m n b<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-304"></a>  from_whole <font color=Cyan>(</font>Matrix m<font color=Cyan>)</font> <font color=Red>=</font> Matrix <font color=Cyan>(</font>from_whole m<font color=Cyan>)</font>
<a name="line-305"></a>  to_whole <font color=Cyan>(</font>Matrix m<font color=Cyan>)</font> <font color=Red>=</font> Matrix <font color=Cyan>(</font>to_whole m<font color=Cyan>)</font>
<a name="line-306"></a>
<a name="line-307"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>DenomExp a<font color=Cyan>)</font> <font color=Red>=&gt;</font> DenomExp <font color=Cyan>(</font>Matrix m n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-308"></a>  denomexp <font color=Cyan>(</font>Matrix m<font color=Cyan>)</font> <font color=Red>=</font> denomexp m
<a name="line-309"></a>  denomexp_factor <font color=Cyan>(</font>Matrix m<font color=Cyan>)</font> k <font color=Red>=</font> Matrix <font color=Cyan>(</font>denomexp_factor m k<font color=Cyan>)</font>
<a name="line-310"></a>
<a name="line-311"></a><a name="unMatrix"></a><font color=Blue><i>-- | Decompose a matrix into a list of columns.</i></font>
<a name="line-312"></a><font color=Blue>unMatrix</font> <font color=Red>::</font> Matrix m n a <font color=Red>-&gt;</font> <font color=Cyan>(</font>Vector n <font color=Cyan>(</font>Vector m a<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-313"></a><font color=Blue>unMatrix</font> <font color=Cyan>(</font>Matrix m<font color=Cyan>)</font> <font color=Red>=</font> m
<a name="line-314"></a>
<a name="line-315"></a><a name="matrix_size"></a><font color=Blue><i>-- | Return the size (/m/, /n/) of a matrix, where /m/ is the number</i></font>
<a name="line-316"></a><font color=Blue><i>-- of rows, and /n/ is the number of columns. Since this information</i></font>
<a name="line-317"></a><font color=Blue><i>-- is contained in the type, the matrix argument is not evaluated and</i></font>
<a name="line-318"></a><font color=Blue><i>-- can be a dummy (undefined) argument.</i></font>
<a name="line-319"></a><font color=Blue>matrix_size</font> <font color=Red>::</font> <font color=Cyan>(</font>Nat m<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n a <font color=Red>-&gt;</font> <font color=Cyan>(</font>Integer<font color=Cyan>,</font> Integer<font color=Cyan>)</font>
<a name="line-320"></a><font color=Blue>matrix_size</font> op <font color=Red>=</font> <font color=Cyan>(</font>nat <font color=Cyan>(</font>m op<font color=Cyan>)</font><font color=Cyan>,</font> nat <font color=Cyan>(</font>n op<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-321"></a>  m <font color=Red>::</font> Matrix m n a <font color=Red>-&gt;</font> m
<a name="line-322"></a>  m <font color=Red>=</font> undefined
<a name="line-323"></a>  n <font color=Red>::</font> Matrix m n a <font color=Red>-&gt;</font> n
<a name="line-324"></a>  n <font color=Red>=</font> undefined
<a name="line-325"></a>
<a name="line-326"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-327"></a><font color=Blue><i>-- ** Basic matrix operations</i></font>
<a name="line-328"></a>
<a name="line-329"></a><a name=".+."></a><font color=Blue><i>-- | Addition of /m/&#215;/n/-matrices. We use a special symbol because</i></font>
<a name="line-330"></a><font color=Blue><i>-- /m/&#215;/n/-matrices do not form a ring; only /n/&#215;/n/-matrices form a</i></font>
<a name="line-331"></a><font color=Blue><i>-- ring (in which case the normal symbol \"'+'\" also works).</i></font>
<a name="line-332"></a><font color=Cyan>(</font><font color=Cyan>.+.</font><font color=Cyan>)</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix m n a
<a name="line-333"></a>Matrix a <font color=Cyan>.+.</font> Matrix b <font color=Red>=</font> Matrix c <font color=Green><u>where</u></font>
<a name="line-334"></a>  c <font color=Red>=</font> vector_zipwith <font color=Cyan>(</font>vector_zipwith <font color=Cyan>(</font><font color=Cyan>+</font><font color=Cyan>)</font><font color=Cyan>)</font> a b
<a name="line-335"></a>
<a name="line-336"></a><font color=Green><u>infixl</u></font> <font color=Magenta>6</font> <font color=Cyan>.+.</font>
<a name="line-337"></a>
<a name="line-338"></a><a name=".-."></a><font color=Blue><i>-- | Subtraction of /m/&#215;/n/-matrices. We use a special symbol because</i></font>
<a name="line-339"></a><font color=Blue><i>-- /m/&#215;/n/-matrices do not form a ring; only /n/&#215;/n/-matrices form a</i></font>
<a name="line-340"></a><font color=Blue><i>-- ring (in which case the normal symbol \"'-'\" also works).</i></font>
<a name="line-341"></a><font color=Cyan>(</font><font color=Cyan>.-.</font><font color=Cyan>)</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix m n a
<a name="line-342"></a>Matrix a <font color=Cyan>.-.</font> Matrix b <font color=Red>=</font> Matrix c <font color=Green><u>where</u></font>
<a name="line-343"></a>  c <font color=Red>=</font> vector_zipwith <font color=Cyan>(</font>vector_zipwith <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Cyan>)</font><font color=Cyan>)</font> a b
<a name="line-344"></a>
<a name="line-345"></a><font color=Green><u>infixl</u></font> <font color=Magenta>6</font> <font color=Cyan>.-.</font>
<a name="line-346"></a>
<a name="line-347"></a><a name="matrix_map"></a><font color=Blue><i>-- | Map some function over every element of a matrix.</i></font>
<a name="line-348"></a><font color=Blue>matrix_map</font> <font color=Red>::</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix m n b
<a name="line-349"></a><font color=Blue>matrix_map</font> f <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Red>=</font> Matrix b <font color=Green><u>where</u></font>
<a name="line-350"></a>  b <font color=Red>=</font> vector_map <font color=Cyan>(</font>vector_map f<font color=Cyan>)</font> a
<a name="line-351"></a>
<a name="line-352"></a><a name="matrix_enum"></a><font color=Blue><i>-- | Create the matrix whose /i/,/j/-entry is (/i/,/j/). Here /i/ and</i></font>
<a name="line-353"></a><font color=Blue><i>-- /j/ are 0-based, i.e., the top left entry is (0,0).</i></font>
<a name="line-354"></a><font color=Blue>matrix_enum</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>,</font> Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n <font color=Cyan>(</font>a<font color=Cyan>,</font>a<font color=Cyan>)</font>
<a name="line-355"></a><font color=Blue>matrix_enum</font> <font color=Red>=</font> Matrix <font color=Cyan>(</font>vector_of_function f<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-356"></a>  f i <font color=Red>=</font> vector_of_function <font color=Cyan>(</font><font color=Red>\</font>j <font color=Red>-&gt;</font> <font color=Cyan>(</font>j<font color=Cyan>,</font>i<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-357"></a>
<a name="line-358"></a><a name="matrix_of_function"></a><font color=Blue><i>-- | Create the matrix whose /i/,/j/-entry is @f i j@. Here /i/ and</i></font>
<a name="line-359"></a><font color=Blue><i>-- /j/ are 0-based, i.e., the top left entry is @f 0 0@.</i></font>
<a name="line-360"></a><font color=Blue>matrix_of_function</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>,</font> Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Cyan>(</font>a <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> b<font color=Cyan>)</font> <font color=Red>-&gt;</font> Matrix m n b
<a name="line-361"></a><font color=Blue>matrix_of_function</font> f <font color=Red>=</font> matrix_map <font color=Cyan>(</font>uncurry f<font color=Cyan>)</font> matrix_enum
<a name="line-362"></a>
<a name="line-363"></a><a name="scalarmult"></a><font color=Blue><i>-- | Multiplication of a scalar and an /m/&#215;/n/-matrix.</i></font>
<a name="line-364"></a><font color=Blue>scalarmult</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix m n a
<a name="line-365"></a><font color=Blue>scalarmult</font> x m <font color=Red>=</font> matrix_map <font color=Cyan>(</font>x <font color=Cyan>*</font><font color=Cyan>)</font> m
<a name="line-366"></a>
<a name="line-367"></a><font color=Green><u>infixl</u></font> <font color=Magenta>7</font> <font color=Cyan>`scalarmult`</font>
<a name="line-368"></a>
<a name="line-369"></a><a name=".*."></a><font color=Blue><i>-- | Multiplication of /m/&#215;/n/-matrices. We use a special symbol</i></font>
<a name="line-370"></a><font color=Blue><i>-- because /m/&#215;/n/-matrices do not form a ring; only /n/&#215;/n/-matrices</i></font>
<a name="line-371"></a><font color=Blue><i>-- form a ring (in which case the normal symbol \"'*'\" also works).</i></font>
<a name="line-372"></a><font color=Cyan>(</font><font color=Cyan>.*.</font><font color=Cyan>)</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix n p a <font color=Red>-&gt;</font> Matrix m p a
<a name="line-373"></a>Matrix a <font color=Cyan>.*.</font> Matrix b <font color=Red>=</font> Matrix c <font color=Green><u>where</u></font>
<a name="line-374"></a>  c <font color=Red>=</font> vector_map <font color=Cyan>(</font>a <font color=Cyan>`mmv`</font><font color=Cyan>)</font> b
<a name="line-375"></a>  
<a name="line-376"></a>  mmv <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector n <font color=Cyan>(</font>Vector m a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Vector n a <font color=Red>-&gt;</font> Vector m a
<a name="line-377"></a>  Nil <font color=Cyan>`mmv`</font> Nil <font color=Red>=</font> vector_repeat <font color=Magenta>0</font>
<a name="line-378"></a>  <font color=Cyan>(</font>Cons h Nil<font color=Cyan>)</font> <font color=Cyan>`mmv`</font> <font color=Cyan>(</font>Cons k Nil<font color=Cyan>)</font> <font color=Red>=</font> k <font color=Cyan>`msv`</font> h
<a name="line-379"></a>  <font color=Cyan>(</font>Cons h t<font color=Cyan>)</font> <font color=Cyan>`mmv`</font> <font color=Cyan>(</font>Cons k s<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>k <font color=Cyan>`msv`</font> h<font color=Cyan>)</font> <font color=Cyan>`avv`</font> <font color=Cyan>(</font>t <font color=Cyan>`mmv`</font> s<font color=Cyan>)</font>
<a name="line-380"></a>  
<a name="line-381"></a>  msv <font color=Red>::</font> <font color=Cyan>(</font>Num b<font color=Cyan>)</font> <font color=Red>=&gt;</font> b <font color=Red>-&gt;</font> Vector n b <font color=Red>-&gt;</font> Vector n b
<a name="line-382"></a>  k <font color=Cyan>`msv`</font> h <font color=Red>=</font> vector_map <font color=Cyan>(</font>k<font color=Cyan>*</font><font color=Cyan>)</font> h
<a name="line-383"></a>  
<a name="line-384"></a>  avv <font color=Red>::</font> <font color=Cyan>(</font>Num c<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector n c <font color=Red>-&gt;</font> Vector n c <font color=Red>-&gt;</font> Vector n c
<a name="line-385"></a>  v <font color=Cyan>`avv`</font> w <font color=Red>=</font> vector_zipwith <font color=Cyan>(</font><font color=Cyan>+</font><font color=Cyan>)</font> v w
<a name="line-386"></a>
<a name="line-387"></a><font color=Green><u>infixl</u></font> <font color=Magenta>7</font> <font color=Cyan>.*.</font>
<a name="line-388"></a>
<a name="line-389"></a><a name="null_matrix"></a><font color=Blue><i>-- | Return the 0 matrix of the given dimension.</i></font>
<a name="line-390"></a><font color=Blue>null_matrix</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>,</font> Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n a
<a name="line-391"></a><font color=Blue>null_matrix</font> <font color=Red>=</font> Matrix <font color=Cyan>(</font>vector_repeat <font color=Cyan>(</font>vector_repeat <font color=Magenta>0</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-392"></a>
<a name="line-393"></a><a name="matrix_transpose"></a><font color=Blue><i>-- | Take the transpose of an /m/&#215;/n/-matrix.</i></font>
<a name="line-394"></a><font color=Blue>matrix_transpose</font> <font color=Red>::</font> <font color=Cyan>(</font>Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix n m a
<a name="line-395"></a><font color=Blue>matrix_transpose</font> <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Red>=</font> Matrix b <font color=Green><u>where</u></font>
<a name="line-396"></a>  b <font color=Red>=</font> vector_transpose a
<a name="line-397"></a>
<a name="line-398"></a><a name="adjoint"></a><font color=Blue><i>-- | Take the adjoint of an /m/&#215;/n/-matrix. Unlike 'adj', this can be</i></font>
<a name="line-399"></a><font color=Blue><i>-- applied to non-square matrices.</i></font>
<a name="line-400"></a><font color=Blue>adjoint</font> <font color=Red>::</font> <font color=Cyan>(</font>Nat m<font color=Cyan>,</font> Adjoint a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix n m a
<a name="line-401"></a><font color=Blue>adjoint</font> <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Red>=</font> Matrix c <font color=Green><u>where</u></font>
<a name="line-402"></a>  b <font color=Red>=</font> vector_map <font color=Cyan>(</font>vector_map adj<font color=Cyan>)</font> a
<a name="line-403"></a>  c <font color=Red>=</font> vector_transpose b
<a name="line-404"></a>  
<a name="line-405"></a><a name="matrix_index"></a><font color=Blue><i>-- | Return the element in the /i/th row and /j/th column of the</i></font>
<a name="line-406"></a><font color=Blue><i>-- matrix. Counting of rows and columns starts from 0. Throws an error</i></font>
<a name="line-407"></a><font color=Blue><i>-- if the index is out of range.</i></font>
<a name="line-408"></a><font color=Blue>matrix_index</font> <font color=Red>::</font> <font color=Cyan>(</font>Integral i<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix m n a <font color=Red>-&gt;</font> i <font color=Red>-&gt;</font> i <font color=Red>-&gt;</font> a
<a name="line-409"></a><font color=Blue>matrix_index</font> <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> i j <font color=Red>=</font> a <font color=Cyan>`vector_index`</font> j <font color=Cyan>`vector_index`</font> i
<a name="line-410"></a>
<a name="line-411"></a><a name="matrix_entries"></a><font color=Blue><i>-- | Return a list of all the entries of a matrix, in some fixed but</i></font>
<a name="line-412"></a><font color=Blue><i>-- unspecified order.</i></font>
<a name="line-413"></a><font color=Blue>matrix_entries</font> <font color=Red>::</font> Matrix m n a <font color=Red>-&gt;</font> <font color=Red>[</font>a<font color=Red>]</font>
<a name="line-414"></a><font color=Blue>matrix_entries</font> <font color=Cyan>(</font>Matrix m<font color=Cyan>)</font> <font color=Red>=</font> 
<a name="line-415"></a>  concat <font color=Cyan>$</font> map list_of_vector <font color=Cyan>$</font> list_of_vector m
<a name="line-416"></a>
<a name="line-417"></a><a name="matrix_sequence"></a><font color=Blue><i>-- | Version of 'sequence' for matrices.</i></font>
<a name="line-418"></a><font color=Blue>matrix_sequence</font> <font color=Red>::</font> <font color=Cyan>(</font>Monad m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n p <font color=Cyan>(</font>m a<font color=Cyan>)</font> <font color=Red>-&gt;</font> m <font color=Cyan>(</font>Matrix n p a<font color=Cyan>)</font>
<a name="line-419"></a><font color=Blue>matrix_sequence</font> <font color=Cyan>(</font>Matrix m<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-420"></a>  m' <font color=Red>&lt;-</font> vector_sequence <font color=Cyan>(</font>vector_map vector_sequence m<font color=Cyan>)</font>
<a name="line-421"></a>  return <font color=Cyan>(</font>Matrix m'<font color=Cyan>)</font>
<a name="line-422"></a>
<a name="line-423"></a><a name="tr"></a><font color=Blue><i>-- | Return the trace of a square matrix.</i></font>
<a name="line-424"></a><font color=Blue>tr</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n n a <font color=Red>-&gt;</font> a
<a name="line-425"></a><font color=Blue>tr</font> <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Red>=</font> aux a <font color=Green><u>where</u></font>
<a name="line-426"></a>  aux <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector n <font color=Cyan>(</font>Vector n a<font color=Cyan>)</font> <font color=Red>-&gt;</font> a
<a name="line-427"></a>  aux Nil <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-428"></a>  aux <font color=Cyan>(</font><font color=Cyan>(</font>h <font color=Cyan>`Cons`</font> t<font color=Cyan>)</font> <font color=Cyan>`Cons`</font> s<font color=Cyan>)</font> <font color=Red>=</font> h <font color=Cyan>+</font> aux <font color=Cyan>(</font>vector_map vector_tail s<font color=Cyan>)</font>
<a name="line-429"></a>
<a name="line-430"></a><a name="hs_sqnorm"></a><font color=Blue><i>-- | Return the square of the Hilbert-Schmidt norm of an</i></font>
<a name="line-431"></a><font color=Blue><i>-- /m/&#215;/n/-matrix, defined by &#8214;/M/&#8214;&#178; = tr /M/[sup &#8224;]/M/.</i></font>
<a name="line-432"></a><font color=Blue>hs_sqnorm</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>,</font> Adjoint a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n m a <font color=Red>-&gt;</font> a
<a name="line-433"></a><font color=Blue>hs_sqnorm</font> m <font color=Red>=</font> tr <font color=Cyan>(</font>m <font color=Cyan>.*.</font> adjoint m<font color=Cyan>)</font>
<a name="line-434"></a>
<a name="line-435"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-436"></a><font color=Blue><i>-- Class instances for the ring of square matrices</i></font>
<a name="line-437"></a>
<a name="line-438"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Num <font color=Cyan>(</font>Matrix n n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-439"></a>  <font color=Cyan>(</font><font color=Cyan>+</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font><font color=Cyan>.+.</font><font color=Cyan>)</font>
<a name="line-440"></a>  <font color=Cyan>(</font><font color=Cyan>*</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font><font color=Cyan>.*.</font><font color=Cyan>)</font>
<a name="line-441"></a>  negate <font color=Red>=</font> scalarmult <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-442"></a>  <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font><font color=Cyan>.-.</font><font color=Cyan>)</font>
<a name="line-443"></a>  fromInteger x <font color=Red>=</font> matrix_of_function <font color=Cyan>(</font><font color=Red>\</font>i j <font color=Red>-&gt;</font> <font color=Green><u>if</u></font> i <font color=Cyan>==</font> j <font color=Green><u>then</u></font> fromInteger x <font color=Green><u>else</u></font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-444"></a>  abs a <font color=Red>=</font> a
<a name="line-445"></a>  signum a <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-446"></a>        
<a name="line-447"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Nat n<font color=Cyan>,</font> Adjoint a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint <font color=Cyan>(</font>Matrix n n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-448"></a>  adj <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Red>=</font> Matrix c <font color=Green><u>where</u></font>
<a name="line-449"></a>    b <font color=Red>=</font> vector_map <font color=Cyan>(</font>vector_map adj<font color=Cyan>)</font> a
<a name="line-450"></a>    c <font color=Red>=</font> vector_transpose b
<a name="line-451"></a>
<a name="line-452"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Nat n<font color=Cyan>,</font> Adjoint2 a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint2 <font color=Cyan>(</font>Matrix n n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-453"></a>  adj2 <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Red>=</font> Matrix b <font color=Green><u>where</u></font>
<a name="line-454"></a>    b <font color=Red>=</font> vector_map <font color=Cyan>(</font>vector_map adj2<font color=Cyan>)</font> a
<a name="line-455"></a>
<a name="line-456"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>HalfRing a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> HalfRing <font color=Cyan>(</font>Matrix n n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-457"></a>  half <font color=Red>=</font> scalarmult half <font color=Magenta>1</font>
<a name="line-458"></a>
<a name="line-459"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootHalfRing <font color=Cyan>(</font>Matrix n n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-460"></a>  roothalf <font color=Red>=</font> scalarmult roothalf <font color=Magenta>1</font>
<a name="line-461"></a>
<a name="line-462"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>RootTwoRing a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootTwoRing <font color=Cyan>(</font>Matrix n n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-463"></a>  roottwo <font color=Red>=</font> scalarmult roottwo <font color=Magenta>1</font>
<a name="line-464"></a>
<a name="line-465"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ComplexRing a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> ComplexRing <font color=Cyan>(</font>Matrix n n a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-466"></a>  i <font color=Red>=</font> scalarmult i <font color=Magenta>1</font>
<a name="line-467"></a>
<a name="line-468"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-469"></a><font color=Blue><i>-- ** Operations on block matrices</i></font>
<a name="line-470"></a>
<a name="line-471"></a><a name="stack_vertical"></a><font color=Blue><i>-- | Stack matrices vertically.</i></font>
<a name="line-472"></a><font color=Blue>stack_vertical</font> <font color=Red>::</font> Matrix m n a <font color=Red>-&gt;</font> Matrix p n a <font color=Red>-&gt;</font> Matrix <font color=Cyan>(</font>m <font color=Cyan>`Plus`</font> p<font color=Cyan>)</font> n a
<a name="line-473"></a><font color=Blue>stack_vertical</font> <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Cyan>(</font>Matrix b<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>Matrix c<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-474"></a>  c <font color=Red>=</font> vector_zipwith vector_append a b
<a name="line-475"></a>
<a name="line-476"></a><a name="stack_horizontal"></a><font color=Blue><i>-- | Stack matrices horizontally.</i></font>
<a name="line-477"></a><font color=Blue>stack_horizontal</font> <font color=Red>::</font> Matrix m n a <font color=Red>-&gt;</font> Matrix m p a <font color=Red>-&gt;</font> Matrix m <font color=Cyan>(</font>n <font color=Cyan>`Plus`</font> p<font color=Cyan>)</font> a
<a name="line-478"></a><font color=Blue>stack_horizontal</font> <font color=Cyan>(</font>Matrix a<font color=Cyan>)</font> <font color=Cyan>(</font>Matrix b<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>Matrix c<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-479"></a>  c <font color=Red>=</font> vector_append a b
<a name="line-480"></a>  
<a name="line-481"></a><a name="tensor_vertical"></a><font color=Blue><i>-- | Repeat a matrix vertically, according to some vector of scalars.</i></font>
<a name="line-482"></a><font color=Blue>tensor_vertical</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector p a <font color=Red>-&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix <font color=Cyan>(</font>p <font color=Cyan>`Times`</font> m<font color=Cyan>)</font> n a
<a name="line-483"></a><font color=Blue>tensor_vertical</font> v m <font color=Red>=</font> concat_vertical <font color=Cyan>(</font>vector_map <font color=Cyan>(</font><font color=Cyan>`scalarmult`</font> m<font color=Cyan>)</font> v<font color=Cyan>)</font>
<a name="line-484"></a>                               
<a name="line-485"></a><a name="concat_vertical"></a><font color=Blue><i>-- | Vertically concatenate a vector of matrices.</i></font>
<a name="line-486"></a><font color=Blue>concat_vertical</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector p <font color=Cyan>(</font>Matrix m n a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Matrix <font color=Cyan>(</font>p <font color=Cyan>`Times`</font> m<font color=Cyan>)</font> n a
<a name="line-487"></a><font color=Blue>concat_vertical</font> Nil <font color=Red>=</font> null_matrix
<a name="line-488"></a><font color=Blue>concat_vertical</font> <font color=Cyan>(</font>Cons h t<font color=Cyan>)</font> <font color=Red>=</font> stack_vertical h <font color=Cyan>(</font>concat_vertical t<font color=Cyan>)</font>
<a name="line-489"></a>
<a name="line-490"></a><a name="tensor_horizontal"></a><font color=Blue><i>-- | Repeat a matrix horizontally, according to some vector of scalars.</i></font>
<a name="line-491"></a><font color=Blue>tensor_horizontal</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector p a <font color=Red>-&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix m <font color=Cyan>(</font>p <font color=Cyan>`Times`</font> n<font color=Cyan>)</font> a
<a name="line-492"></a><font color=Blue>tensor_horizontal</font> v m <font color=Red>=</font> concat_horizontal <font color=Cyan>(</font>vector_map <font color=Cyan>(</font><font color=Cyan>`scalarmult`</font> m<font color=Cyan>)</font> v<font color=Cyan>)</font>
<a name="line-493"></a>  
<a name="line-494"></a><a name="concat_horizontal"></a><font color=Blue><i>-- | Horizontally concatenate a vector of matrices.</i></font>
<a name="line-495"></a><font color=Blue>concat_horizontal</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> Vector p <font color=Cyan>(</font>Matrix m n a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Matrix m <font color=Cyan>(</font>p <font color=Cyan>`Times`</font> n<font color=Cyan>)</font> a
<a name="line-496"></a><font color=Blue>concat_horizontal</font> Nil <font color=Red>=</font> null_matrix
<a name="line-497"></a><font color=Blue>concat_horizontal</font> <font color=Cyan>(</font>Cons h t<font color=Cyan>)</font> <font color=Red>=</font> stack_horizontal h <font color=Cyan>(</font>concat_horizontal t<font color=Cyan>)</font>
<a name="line-498"></a>
<a name="line-499"></a><a name="tensor"></a><font color=Blue><i>-- | Kronecker tensor of two matrices.</i></font>
<a name="line-500"></a><font color=Blue>tensor</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat n<font color=Cyan>,</font> Nat <font color=Cyan>(</font>p <font color=Cyan>`Times`</font> m<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix p q a <font color=Red>-&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix <font color=Cyan>(</font>p <font color=Cyan>`Times`</font> m<font color=Cyan>)</font> <font color=Cyan>(</font>q <font color=Cyan>`Times`</font> n<font color=Cyan>)</font> a
<a name="line-501"></a><font color=Blue>tensor</font> a b <font color=Red>=</font> ab3 <font color=Green><u>where</u></font>
<a name="line-502"></a>  Matrix ab1 <font color=Red>=</font> matrix_map <font color=Cyan>(</font><font color=Cyan>`scalarmult`</font> b<font color=Cyan>)</font> a
<a name="line-503"></a>  ab2 <font color=Red>=</font> vector_map concat_vertical ab1
<a name="line-504"></a>  ab3 <font color=Red>=</font> concat_horizontal ab2
<a name="line-505"></a>
<a name="line-506"></a><a name="oplus"></a><font color=Blue><i>-- | Form a diagonal block matrix.</i></font>
<a name="line-507"></a><font color=Blue>oplus</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>,</font> Nat m<font color=Cyan>,</font> Nat q<font color=Cyan>,</font> Nat n<font color=Cyan>,</font> Nat p<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix p q a <font color=Red>-&gt;</font> Matrix m n a <font color=Red>-&gt;</font> Matrix <font color=Cyan>(</font>p <font color=Cyan>`Plus`</font> m<font color=Cyan>)</font> <font color=Cyan>(</font>q <font color=Cyan>`Plus`</font> n<font color=Cyan>)</font> a
<a name="line-508"></a><font color=Blue>oplus</font> <font color=Cyan>(</font>a <font color=Red>::</font> Matrix p q a<font color=Cyan>)</font> <font color=Cyan>(</font>b <font color=Red>::</font> Matrix m n a<font color=Cyan>)</font> <font color=Red>=</font> 
<a name="line-509"></a>  <font color=Cyan>(</font>a <font color=Cyan>`stack_vertical`</font> <font color=Cyan>(</font>null_matrix <font color=Red>::</font> Matrix m q a<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>`stack_horizontal`</font> <font color=Cyan>(</font><font color=Cyan>(</font>null_matrix <font color=Red>::</font> Matrix p n a<font color=Cyan>)</font> <font color=Cyan>`stack_vertical`</font> b<font color=Cyan>)</font>
<a name="line-510"></a>
<a name="line-511"></a><a name="matrix_controlled"></a><font color=Blue><i>-- | Form a controlled gate.</i></font>
<a name="line-512"></a><font color=Blue>matrix_controlled</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> Num a<font color=Cyan>,</font> Nat n<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix n n a <font color=Red>-&gt;</font> Matrix <font color=Cyan>(</font>n <font color=Cyan>`Plus`</font> n<font color=Cyan>)</font> <font color=Cyan>(</font>n <font color=Cyan>`Plus`</font> n<font color=Cyan>)</font> a
<a name="line-513"></a><font color=Blue>matrix_controlled</font> <font color=Cyan>(</font>m <font color=Red>::</font> Matrix n n a<font color=Cyan>)</font> <font color=Red>=</font> oplus <font color=Cyan>(</font><font color=Magenta>1</font> <font color=Red>::</font> Matrix n n a<font color=Cyan>)</font> m
<a name="line-514"></a>
<a name="line-515"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-516"></a><font color=Blue><i>-- ** Constructors and destructors</i></font>
<a name="line-517"></a>
<a name="line-518"></a><a name="U2"></a><font color=Blue><i>-- | A convenient abbreviation for the type of 2&#215;2-matrices.</i></font>
<a name="line-519"></a><a name="U2"></a><font color=Green><u>type</u></font> U2 a <font color=Red>=</font> Matrix Two Two a
<a name="line-520"></a>
<a name="line-521"></a><a name="SO3"></a><font color=Blue><i>-- | A convenient abbreviation for the type of 3&#215;3-matrices.</i></font>
<a name="line-522"></a><a name="SO3"></a><font color=Green><u>type</u></font> SO3 a <font color=Red>=</font> Matrix Three Three a
<a name="line-523"></a>
<a name="line-524"></a><a name="matrix"></a><font color=Blue><i>-- | A convenience constructor for matrices: turn a list of columns</i></font>
<a name="line-525"></a><font color=Blue><i>-- into a matrix. </i></font>
<a name="line-526"></a><font color=Blue><i>-- </i></font>
<a name="line-527"></a><font color=Blue><i>-- Note: since the dimensions of the matrix are type-level integers,</i></font>
<a name="line-528"></a><font color=Blue><i>-- they cannot be inferred from the dimensions of the input; instead,</i></font>
<a name="line-529"></a><font color=Blue><i>-- they must be specified explicitly in the type. It is an error to</i></font>
<a name="line-530"></a><font color=Blue><i>-- apply this function to a list of the wrong dimension.</i></font>
<a name="line-531"></a><font color=Blue>matrix</font> <font color=Red>::</font> <font color=Cyan>(</font>Nat n<font color=Cyan>,</font> Nat m<font color=Cyan>)</font> <font color=Red>=&gt;</font> <font color=Red>[</font><font color=Red>[</font>a<font color=Red>]</font><font color=Red>]</font> <font color=Red>-&gt;</font> Matrix n m a
<a name="line-532"></a><font color=Blue>matrix</font> columns <font color=Red>=</font> Matrix m <font color=Green><u>where</u></font>
<a name="line-533"></a>  m <font color=Red>=</font> vector <font color=Cyan>$</font> map vector columns
<a name="line-534"></a>
<a name="line-535"></a><a name="from_matrix"></a><font color=Blue><i>-- | Turn a matrix into a list of columns.</i></font>
<a name="line-536"></a><font color=Blue>from_matrix</font> <font color=Red>::</font> Matrix n m a <font color=Red>-&gt;</font> <font color=Red>[</font><font color=Red>[</font>a<font color=Red>]</font><font color=Red>]</font>
<a name="line-537"></a><font color=Blue>from_matrix</font> <font color=Cyan>(</font>Matrix m<font color=Cyan>)</font> <font color=Red>=</font> 
<a name="line-538"></a>  map list_of_vector <font color=Cyan>(</font>list_of_vector m<font color=Cyan>)</font>
<a name="line-539"></a>
<a name="line-540"></a><a name="matrix2x2"></a><font color=Blue><i>-- | A convenience constructor for 2&#215;2-matrices. The arguments are by</i></font>
<a name="line-541"></a><font color=Blue><i>-- rows.</i></font>
<a name="line-542"></a><font color=Blue>matrix2x2</font> <font color=Red>::</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Matrix Two Two a
<a name="line-543"></a><font color=Blue>matrix2x2</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>)</font> <font color=Cyan>(</font>c<font color=Cyan>,</font> d<font color=Cyan>)</font> <font color=Red>=</font> matrix <font color=Red>[</font><font color=Red>[</font>a<font color=Cyan>,</font>c<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>b<font color=Cyan>,</font>d<font color=Red>]</font><font color=Red>]</font>
<a name="line-544"></a>
<a name="line-545"></a><a name="from_matrix2x2"></a><font color=Blue><i>-- | A convenience destructor for 2&#215;2-matrices. The result is by rows.</i></font>
<a name="line-546"></a><font color=Blue>from_matrix2x2</font> <font color=Red>::</font> Matrix Two Two a <font color=Red>-&gt;</font> <font color=Cyan>(</font><font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>)</font><font color=Cyan>,</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-547"></a><font color=Blue>from_matrix2x2</font> <font color=Cyan>(</font>Matrix <font color=Cyan>(</font><font color=Cyan>(</font>a <font color=Cyan>`Cons`</font> c <font color=Cyan>`Cons`</font> Nil<font color=Cyan>)</font> <font color=Cyan>`Cons`</font> <font color=Cyan>(</font>b <font color=Cyan>`Cons`</font> d <font color=Cyan>`Cons`</font> Nil<font color=Cyan>)</font> <font color=Cyan>`Cons`</font> Nil<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font><font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>)</font><font color=Cyan>,</font> <font color=Cyan>(</font>c<font color=Cyan>,</font> d<font color=Cyan>)</font><font color=Cyan>)</font>  
<a name="line-548"></a>
<a name="line-549"></a><a name="matrix3x3"></a><font color=Blue><i>-- | A convenience constructor for 3&#215;3-matrices. The arguments are by</i></font>
<a name="line-550"></a><font color=Blue><i>-- rows.</i></font>
<a name="line-551"></a><font color=Blue>matrix3x3</font> <font color=Red>::</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Matrix Three Three a
<a name="line-552"></a><font color=Blue>matrix3x3</font> <font color=Cyan>(</font>a0<font color=Cyan>,</font> a1<font color=Cyan>,</font> a2<font color=Cyan>)</font> <font color=Cyan>(</font>b0<font color=Cyan>,</font> b1<font color=Cyan>,</font> b2<font color=Cyan>)</font> <font color=Cyan>(</font>c0<font color=Cyan>,</font> c1<font color=Cyan>,</font> c2<font color=Cyan>)</font> <font color=Red>=</font> 
<a name="line-553"></a>  matrix <font color=Red>[</font><font color=Red>[</font>a0<font color=Cyan>,</font> b0<font color=Cyan>,</font> c0<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>a1<font color=Cyan>,</font> b1<font color=Cyan>,</font> c1<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>a2<font color=Cyan>,</font> b2<font color=Cyan>,</font> c2<font color=Red>]</font><font color=Red>]</font>
<a name="line-554"></a>
<a name="line-555"></a><a name="matrix4x4"></a><font color=Blue><i>-- | A convenience constructor for 4&#215;4-matrices. The arguments are by</i></font>
<a name="line-556"></a><font color=Blue><i>-- rows.</i></font>
<a name="line-557"></a><font color=Blue>matrix4x4</font> <font color=Red>::</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Matrix Four Four a
<a name="line-558"></a><font color=Blue>matrix4x4</font> <font color=Cyan>(</font>a0<font color=Cyan>,</font> a1<font color=Cyan>,</font> a2<font color=Cyan>,</font> a3<font color=Cyan>)</font> <font color=Cyan>(</font>b0<font color=Cyan>,</font> b1<font color=Cyan>,</font> b2<font color=Cyan>,</font> b3<font color=Cyan>)</font> <font color=Cyan>(</font>c0<font color=Cyan>,</font> c1<font color=Cyan>,</font> c2<font color=Cyan>,</font> c3<font color=Cyan>)</font> <font color=Cyan>(</font>d0<font color=Cyan>,</font> d1<font color=Cyan>,</font> d2<font color=Cyan>,</font> d3<font color=Cyan>)</font> <font color=Red>=</font> 
<a name="line-559"></a>  matrix <font color=Red>[</font><font color=Red>[</font>a0<font color=Cyan>,</font> b0<font color=Cyan>,</font> c0<font color=Cyan>,</font> d0<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>a1<font color=Cyan>,</font> b1<font color=Cyan>,</font> c1<font color=Cyan>,</font> d1<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>a2<font color=Cyan>,</font> b2<font color=Cyan>,</font> c2<font color=Cyan>,</font> d2<font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font>a3<font color=Cyan>,</font> b3<font color=Cyan>,</font> c3<font color=Cyan>,</font> d3<font color=Red>]</font><font color=Red>]</font>
<a name="line-560"></a>
<a name="line-561"></a><a name="column3"></a><font color=Blue><i>-- | A convenience constructor for 3-dimensional column vectors.</i></font>
<a name="line-562"></a><font color=Blue>column3</font> <font color=Red>::</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font> <font color=Red>-&gt;</font> Matrix Three One a
<a name="line-563"></a><font color=Blue>column3</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>,</font> c<font color=Cyan>)</font> <font color=Red>=</font> matrix <font color=Red>[</font><font color=Red>[</font>a<font color=Cyan>,</font> b<font color=Cyan>,</font> c<font color=Red>]</font><font color=Red>]</font>
<a name="line-564"></a>
<a name="line-565"></a><a name="from_column3"></a><font color=Blue><i>-- | A convenience destructor for 3-dimensional column vectors. This</i></font>
<a name="line-566"></a><font color=Blue><i>-- is the inverse of 'column3'.</i></font>
<a name="line-567"></a><font color=Blue>from_column3</font> <font color=Red>::</font> Matrix Three One a <font color=Red>-&gt;</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> a<font color=Cyan>,</font> a<font color=Cyan>)</font>
<a name="line-568"></a><font color=Blue>from_column3</font> <font color=Cyan>(</font>Matrix <font color=Cyan>(</font><font color=Cyan>(</font>a <font color=Cyan>`Cons`</font> b <font color=Cyan>`Cons`</font> c <font color=Cyan>`Cons`</font> Nil<font color=Cyan>)</font> <font color=Cyan>`Cons`</font> Nil<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>a<font color=Cyan>,</font> b<font color=Cyan>,</font> c<font color=Cyan>)</font>
<a name="line-569"></a>
<a name="line-570"></a><a name="column_matrix"></a><font color=Blue><i>-- | A convenience constructor for turning a vector into a column matrix.</i></font>
<a name="line-571"></a><font color=Blue>column_matrix</font> <font color=Red>::</font> Vector n a <font color=Red>-&gt;</font> Matrix n One a
<a name="line-572"></a><font color=Blue>column_matrix</font> v <font color=Red>=</font> Matrix <font color=Cyan>(</font>vector_singleton v<font color=Cyan>)</font>
<a name="line-573"></a>
<a name="line-574"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-575"></a><font color=Blue><i>-- ** Particular matrices</i></font>
<a name="line-576"></a>
<a name="line-577"></a><a name="cnot"></a><font color=Blue><i>-- | Controlled-not gate.</i></font>
<a name="line-578"></a><font color=Blue>cnot</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix Four Four a
<a name="line-579"></a><font color=Blue>cnot</font> <font color=Red>=</font> matrix4x4 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-580"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>1</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-581"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-582"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>1</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-583"></a>
<a name="line-584"></a><a name="swap"></a><font color=Blue><i>-- | Swap gate.</i></font>
<a name="line-585"></a><font color=Blue>swap</font> <font color=Red>::</font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Matrix Four Four a
<a name="line-586"></a><font color=Blue>swap</font> <font color=Red>=</font> matrix4x4 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-587"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>1</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-588"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>1</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-589"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-590"></a>
<a name="line-591"></a><a name="zrot"></a><font color=Blue><i>-- | A /z/-rotation gate, /R/[sub /z/](&#952;) = [exp &#8722;/i/&#952;/Z/\/2].</i></font>
<a name="line-592"></a><font color=Blue>zrot</font> <font color=Red>::</font> <font color=Cyan>(</font>Eq r<font color=Cyan>,</font> Floating r<font color=Cyan>,</font> Adjoint r<font color=Cyan>)</font> <font color=Red>=&gt;</font> r <font color=Red>-&gt;</font> Matrix Two Two <font color=Cyan>(</font>Cplx r<font color=Cyan>)</font>
<a name="line-593"></a><font color=Blue>zrot</font> theta <font color=Red>=</font> matrix2x2 <font color=Cyan>(</font>u<font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-594"></a>                       <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> adj u<font color=Cyan>)</font>
<a name="line-595"></a>  <font color=Green><u>where</u></font>
<a name="line-596"></a>    u <font color=Red>=</font> Cplx <font color=Cyan>(</font>cos <font color=Cyan>(</font>theta<font color=Cyan>/</font><font color=Magenta>2</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>sin <font color=Cyan>(</font>theta<font color=Cyan>/</font><font color=Magenta>2</font><font color=Cyan>)</font><font color=Cyan>)</font>
</pre>
</body>
</html>