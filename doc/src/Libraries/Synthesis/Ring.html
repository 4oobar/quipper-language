<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>{-# LANGUAGE MultiParamTypeClasses #-}</i></font>
<a name="line-2"></a><font color=Blue><i>{-# LANGUAGE FunctionalDependencies #-}</i></font>
<a name="line-3"></a><font color=Blue><i>{-# LANGUAGE TypeSynonymInstances #-}</i></font>
<a name="line-4"></a><font color=Blue><i>{-# LANGUAGE UndecidableInstances #-}</i></font>
<a name="line-5"></a><font color=Blue><i>{-# LANGUAGE FlexibleInstances #-}</i></font>
<a name="line-6"></a><font color=Blue><i>{-# LANGUAGE GeneralizedNewtypeDeriving #-}</i></font>
<a name="line-7"></a><font color=Blue><i>{-# LANGUAGE IncoherentInstances #-}</i></font>
<a name="line-8"></a><font color=Blue><i>{-# LANGUAGE BangPatterns #-}</i></font>
<a name="line-9"></a>
<a name="line-10"></a><font color=Blue><i>-- | This module provides type classes for rings. It also provides</i></font>
<a name="line-11"></a><font color=Blue><i>-- several specific instances of rings, such as the ring &#8484;&#8322; of</i></font>
<a name="line-12"></a><font color=Blue><i>-- integers modulo 2, the ring &#8474; of rational numbers, the ring &#8484;[&#189;] of</i></font>
<a name="line-13"></a><font color=Blue><i>-- dyadic fractions, the ring &#8484;[/i/] of Gaussian integers, the ring</i></font>
<a name="line-14"></a><font color=Blue><i>-- &#8484;[&#8730;2] of quadratic integers with radix 2, and the ring &#8484;[&#969;] of</i></font>
<a name="line-15"></a><font color=Blue><i>-- cyclotomic integers of degree 8.</i></font>
<a name="line-16"></a>
<a name="line-17"></a><font color=Green><u>module</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Ring <font color=Green><u>where</u></font>
<a name="line-18"></a>
<a name="line-19"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Bits
<a name="line-20"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Complex
<a name="line-21"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Ratio
<a name="line-22"></a>
<a name="line-23"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-24"></a><font color=Blue><i>-- * Rings</i></font>
<a name="line-25"></a>
<a name="line-26"></a><font color=Blue><i>-- | A type class to denote rings. We make 'Ring' a synonym of</i></font>
<a name="line-27"></a><font color=Blue><i>-- Haskell's 'Num' type class, so that we can use the usual notation</i></font>
<a name="line-28"></a><font color=Blue><i>-- '+', '-', '*' for the ring operations.  This is not a perfect fit,</i></font>
<a name="line-29"></a><font color=Blue><i>-- because Haskell's 'Num' class also contains two non-ring operations</i></font>
<a name="line-30"></a><font color=Blue><i>-- 'abs' and 'signum'.  By convention, for rings where these notions</i></font>
<a name="line-31"></a><font color=Blue><i>-- don't make sense (or are inconvenient to define), we set 'abs' /x/</i></font>
<a name="line-32"></a><font color=Blue><i>-- = /x/ and 'signum' /x/ = 1.</i></font>
<a name="line-33"></a>
<a name="line-34"></a><a name="Ring"></a><font color=Green><u>class</u></font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Ring a
<a name="line-35"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Ring a
<a name="line-36"></a>
<a name="line-37"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-38"></a><font color=Blue><i>-- * Rings with particular elements</i></font>
<a name="line-39"></a>
<a name="line-40"></a><font color=Blue><i>-- $ We define several classes of rings with special elements.</i></font>
<a name="line-41"></a>
<a name="line-42"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-43"></a><font color=Blue><i>-- ** Rings with &#189;</i></font>
<a name="line-44"></a>
<a name="line-45"></a><a name="HalfRing"></a><font color=Blue><i>-- | A type class for rings that contain &#189;.</i></font>
<a name="line-46"></a><a name="HalfRing"></a><font color=Green><u>class</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> HalfRing a <font color=Green><u>where</u></font>
<a name="line-47"></a>  <font color=Blue><i>-- | The value &#189;.</i></font>
<a name="line-48"></a>  half <font color=Red>::</font> a
<a name="line-49"></a>
<a name="line-50"></a><font color=Green><u>instance</u></font> HalfRing Double <font color=Green><u>where</u></font>
<a name="line-51"></a>  half <font color=Red>=</font> <font color=Magenta>0.5</font>
<a name="line-52"></a>
<a name="line-53"></a><font color=Green><u>instance</u></font> HalfRing Float <font color=Green><u>where</u></font>
<a name="line-54"></a>  half <font color=Red>=</font> <font color=Magenta>0.5</font>
<a name="line-55"></a>
<a name="line-56"></a><font color=Green><u>instance</u></font> HalfRing Rational <font color=Green><u>where</u></font>
<a name="line-57"></a>  half <font color=Red>=</font> <font color=Magenta>1</font><font color=Cyan>%</font><font color=Magenta>2</font>
<a name="line-58"></a>
<a name="line-59"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>HalfRing a<font color=Cyan>,</font> RealFloat a<font color=Cyan>)</font> <font color=Red>=&gt;</font> HalfRing <font color=Cyan>(</font>Complex a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-60"></a>  half <font color=Red>=</font> half <font color=Red><b>:+</b></font> <font color=Magenta>0</font>
<a name="line-61"></a>
<a name="line-62"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-63"></a><font color=Blue><i>-- ** Rings with &#8730;2</i></font>
<a name="line-64"></a>
<a name="line-65"></a><a name="RootTwoRing"></a><font color=Blue><i>-- | A type class for rings that contain &#8730;2.</i></font>
<a name="line-66"></a><a name="RootTwoRing"></a><font color=Green><u>class</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootTwoRing a <font color=Green><u>where</u></font>
<a name="line-67"></a>  <font color=Blue><i>-- | The square root of 2.</i></font>
<a name="line-68"></a>  roottwo <font color=Red>::</font> a
<a name="line-69"></a>  
<a name="line-70"></a><font color=Green><u>instance</u></font> RootTwoRing Double <font color=Green><u>where</u></font>
<a name="line-71"></a>  roottwo <font color=Red>=</font> sqrt <font color=Magenta>2</font>
<a name="line-72"></a>
<a name="line-73"></a><font color=Green><u>instance</u></font> RootTwoRing Float <font color=Green><u>where</u></font>
<a name="line-74"></a>  roottwo <font color=Red>=</font> sqrt <font color=Magenta>2</font>
<a name="line-75"></a>
<a name="line-76"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>RootTwoRing a<font color=Cyan>,</font> RealFloat a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootTwoRing <font color=Cyan>(</font>Complex a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-77"></a>  roottwo <font color=Red>=</font> roottwo <font color=Red><b>:+</b></font> <font color=Magenta>0</font>
<a name="line-78"></a>
<a name="line-79"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-80"></a><font color=Blue><i>-- ** Rings with 1\/&#8730;2</i></font>
<a name="line-81"></a>
<a name="line-82"></a><a name="RootHalfRing"></a><font color=Blue><i>-- | A type class for rings that contain 1\/&#8730;2.</i></font>
<a name="line-83"></a><a name="RootHalfRing"></a><font color=Green><u>class</u></font> <font color=Cyan>(</font>HalfRing a<font color=Cyan>,</font> RootTwoRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootHalfRing a <font color=Green><u>where</u></font>
<a name="line-84"></a>  <font color=Blue><i>-- | The square root of &#189;.</i></font>
<a name="line-85"></a>  roothalf <font color=Red>::</font> a
<a name="line-86"></a>  
<a name="line-87"></a><font color=Green><u>instance</u></font> RootHalfRing Double <font color=Green><u>where</u></font>
<a name="line-88"></a>  roothalf <font color=Red>=</font> sqrt <font color=Magenta>0.5</font>
<a name="line-89"></a>
<a name="line-90"></a><font color=Green><u>instance</u></font> RootHalfRing Float <font color=Green><u>where</u></font>
<a name="line-91"></a>  roothalf <font color=Red>=</font> sqrt <font color=Magenta>0.5</font>
<a name="line-92"></a>
<a name="line-93"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>,</font> RealFloat a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootHalfRing <font color=Cyan>(</font>Complex a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-94"></a>  roothalf <font color=Red>=</font> roothalf <font color=Red><b>:+</b></font> <font color=Magenta>0</font>
<a name="line-95"></a>
<a name="line-96"></a>
<a name="line-97"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-98"></a><font color=Blue><i>-- ** Rings with /i/</i></font>
<a name="line-99"></a>
<a name="line-100"></a><a name="ComplexRing"></a><font color=Blue><i>-- | A type class for rings that contain a square root of -1.</i></font>
<a name="line-101"></a><a name="ComplexRing"></a><font color=Green><u>class</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ComplexRing a <font color=Green><u>where</u></font>
<a name="line-102"></a>  <font color=Blue><i>-- | The complex unit.</i></font>
<a name="line-103"></a>  i <font color=Red>::</font> a
<a name="line-104"></a>       
<a name="line-105"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>,</font> RealFloat a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ComplexRing <font color=Cyan>(</font>Complex a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-106"></a>  i <font color=Red>=</font> <font color=Magenta>0</font> <font color=Red><b>:+</b></font> <font color=Magenta>1</font>
<a name="line-107"></a>
<a name="line-108"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-109"></a><font color=Blue><i>-- ** Rings with &#969;</i></font>
<a name="line-110"></a>
<a name="line-111"></a><a name="OmegaRing"></a><font color=Blue><i>-- | A type class for rings that contain a square root of /i/, or</i></font>
<a name="line-112"></a><a name="OmegaRing"></a><font color=Blue><i>-- equivalently, a fourth root of &#8722;1.</i></font>
<a name="line-113"></a><a name="OmegaRing"></a><font color=Green><u>class</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> OmegaRing a <font color=Green><u>where</u></font>
<a name="line-114"></a>  <font color=Blue><i>-- | The square root of /i/.</i></font>
<a name="line-115"></a>  omega <font color=Red>::</font> a
<a name="line-116"></a>  
<a name="line-117"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ComplexRing a<font color=Cyan>,</font> RootHalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> OmegaRing a <font color=Green><u>where</u></font>
<a name="line-118"></a>  omega <font color=Red>=</font> roothalf <font color=Cyan>*</font> <font color=Cyan>(</font><font color=Magenta>1</font> <font color=Cyan>+</font> i<font color=Cyan>)</font>
<a name="line-119"></a>
<a name="line-120"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-121"></a><font color=Blue><i>-- * Rings with particular automorphisms</i></font>
<a name="line-122"></a>
<a name="line-123"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-124"></a><font color=Blue><i>-- ** Rings with complex conjugation</i></font>
<a name="line-125"></a>
<a name="line-126"></a><a name="Adjoint"></a><font color=Blue><i>-- | A type class for rings with complex conjugation, i.e., an</i></font>
<a name="line-127"></a><a name="Adjoint"></a><font color=Blue><i>-- automorphism mapping /i/ to &#8722;/i/. </i></font>
<a name="line-128"></a><a name="Adjoint"></a><font color=Blue><i>-- </i></font>
<a name="line-129"></a><a name="Adjoint"></a><font color=Blue><i>-- When instances of this type class are vectors or matrices, the</i></font>
<a name="line-130"></a><a name="Adjoint"></a><font color=Blue><i>-- conjugation also exchanges the roles of rows and columns (in other</i></font>
<a name="line-131"></a><a name="Adjoint"></a><font color=Blue><i>-- words, it is the adjoint).</i></font>
<a name="line-132"></a><a name="Adjoint"></a><font color=Blue><i>-- </i></font>
<a name="line-133"></a><a name="Adjoint"></a><font color=Blue><i>-- For rings that are not complex, the conjugation can be defined to</i></font>
<a name="line-134"></a><a name="Adjoint"></a><font color=Blue><i>-- be the identity function.</i></font>
<a name="line-135"></a><a name="Adjoint"></a><font color=Green><u>class</u></font> Adjoint a <font color=Green><u>where</u></font>
<a name="line-136"></a>  <font color=Blue><i>-- | Compute the adjoint (complex conjugate transpose).</i></font>
<a name="line-137"></a>  adj <font color=Red>::</font> a <font color=Red>-&gt;</font> a
<a name="line-138"></a>
<a name="line-139"></a><font color=Green><u>instance</u></font> Adjoint Integer <font color=Green><u>where</u></font>
<a name="line-140"></a>  adj x <font color=Red>=</font> x
<a name="line-141"></a>  
<a name="line-142"></a><font color=Green><u>instance</u></font> Adjoint Int <font color=Green><u>where</u></font>
<a name="line-143"></a>  adj x <font color=Red>=</font> x
<a name="line-144"></a>  
<a name="line-145"></a><font color=Green><u>instance</u></font> Adjoint Double <font color=Green><u>where</u></font>
<a name="line-146"></a>  adj x <font color=Red>=</font> x
<a name="line-147"></a>  
<a name="line-148"></a><font color=Green><u>instance</u></font> Adjoint Float <font color=Green><u>where</u></font>
<a name="line-149"></a>  adj x <font color=Red>=</font> x
<a name="line-150"></a>  
<a name="line-151"></a><font color=Green><u>instance</u></font> Adjoint Rational <font color=Green><u>where</u></font>  
<a name="line-152"></a>  adj x <font color=Red>=</font> x
<a name="line-153"></a>  
<a name="line-154"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Adjoint a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint <font color=Cyan>(</font>Complex a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-155"></a>  adj <font color=Cyan>(</font>a <font color=Red><b>:+</b></font> b<font color=Cyan>)</font> <font color=Red>=</font> adj a <font color=Red><b>:+</b></font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>adj b<font color=Cyan>)</font>
<a name="line-156"></a>
<a name="line-157"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-158"></a><font color=Blue><i>-- ** Rings with &#8730;2-conjugation</i></font>
<a name="line-159"></a>
<a name="line-160"></a><a name="Adjoint2"></a><font color=Blue><i>-- | A type class for rings with a &#8730;2-conjugation, i.e., an</i></font>
<a name="line-161"></a><a name="Adjoint2"></a><font color=Blue><i>-- automorphism mapping &#8730;2 to &#8722;&#8730;2. </i></font>
<a name="line-162"></a><a name="Adjoint2"></a><font color=Blue><i>-- </i></font>
<a name="line-163"></a><a name="Adjoint2"></a><font color=Blue><i>-- When instances of this type class are vectors or matrices, the</i></font>
<a name="line-164"></a><a name="Adjoint2"></a><font color=Blue><i>-- &#8730;2-conjugation does /not/ exchange the roles of rows and columns.</i></font>
<a name="line-165"></a><a name="Adjoint2"></a><font color=Blue><i>-- </i></font>
<a name="line-166"></a><a name="Adjoint2"></a><font color=Blue><i>-- For rings that have no &#8730;2, the conjugation can be defined to be the</i></font>
<a name="line-167"></a><a name="Adjoint2"></a><font color=Blue><i>-- identity function.</i></font>
<a name="line-168"></a><a name="Adjoint2"></a><font color=Green><u>class</u></font> Adjoint2 a <font color=Green><u>where</u></font>
<a name="line-169"></a>  <font color=Blue><i>-- | Compute the adjoint, mapping /a/ + /b/&#8730;2 to /a/ &#8722;/b/&#8730;2.</i></font>
<a name="line-170"></a>  adj2 <font color=Red>::</font> a <font color=Red>-&gt;</font> a
<a name="line-171"></a>
<a name="line-172"></a><font color=Green><u>instance</u></font> Adjoint2 Integer <font color=Green><u>where</u></font>
<a name="line-173"></a>  adj2 x <font color=Red>=</font> x
<a name="line-174"></a>
<a name="line-175"></a><font color=Green><u>instance</u></font> Adjoint2 Int <font color=Green><u>where</u></font>
<a name="line-176"></a>  adj2 x <font color=Red>=</font> x
<a name="line-177"></a>  
<a name="line-178"></a><font color=Green><u>instance</u></font> Adjoint2 Double <font color=Green><u>where</u></font>
<a name="line-179"></a>  adj2 x <font color=Red>=</font> x
<a name="line-180"></a>  
<a name="line-181"></a><font color=Green><u>instance</u></font> Adjoint2 Float <font color=Green><u>where</u></font>
<a name="line-182"></a>  adj2 x <font color=Red>=</font> x
<a name="line-183"></a>  
<a name="line-184"></a><font color=Green><u>instance</u></font> Adjoint2 Rational <font color=Green><u>where</u></font>  
<a name="line-185"></a>  adj2 x <font color=Red>=</font> x
<a name="line-186"></a>  
<a name="line-187"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-188"></a><font color=Blue><i>-- * Normed rings</i></font>
<a name="line-189"></a>
<a name="line-190"></a><a name="NormedRing"></a><font color=Blue><i>-- | A (number-theoretic) /norm/ on a ring /R/ is a function /N/ : /R/</i></font>
<a name="line-191"></a><a name="NormedRing"></a><font color=Blue><i>-- &#8594; &#8484; such that /N/(/rs/) = /N/(/r/)/N/(/s/), for all /r/, /s/ &#8712; /R/.</i></font>
<a name="line-192"></a><a name="NormedRing"></a><font color=Blue><i>-- The norm also satisfies /N/(/r/) = 0 iff /r/ = 0, and /N/(/r/) = &#177;1</i></font>
<a name="line-193"></a><a name="NormedRing"></a><font color=Blue><i>-- iff /r/ is a unit of the ring.</i></font>
<a name="line-194"></a><a name="NormedRing"></a><font color=Green><u>class</u></font> <font color=Cyan>(</font>Ring r<font color=Cyan>)</font> <font color=Red>=&gt;</font> NormedRing r <font color=Green><u>where</u></font>
<a name="line-195"></a>  norm <font color=Red>::</font> r <font color=Red>-&gt;</font> Integer
<a name="line-196"></a>  
<a name="line-197"></a><font color=Green><u>instance</u></font> NormedRing Integer <font color=Green><u>where</u></font>
<a name="line-198"></a>  norm x <font color=Red>=</font> x
<a name="line-199"></a>  
<a name="line-200"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-201"></a><font color=Blue><i>-- * Floor and ceiling</i></font>
<a name="line-202"></a>  
<a name="line-203"></a><a name="Floor"></a><font color=Blue><i>-- | The 'floor' and 'ceiling' functions provided by the standard</i></font>
<a name="line-204"></a><a name="Floor"></a><font color=Blue><i>-- Haskell libraries are predicated on many unnecessary assumptions.</i></font>
<a name="line-205"></a><a name="Floor"></a><font color=Blue><i>-- This type class provides an alternative.</i></font>
<a name="line-206"></a><a name="Floor"></a><font color=Blue><i>-- </i></font>
<a name="line-207"></a><a name="Floor"></a><font color=Blue><i>-- Minimal complete definition: 'floor_of' or 'ceiling_of'.</i></font>
<a name="line-208"></a><a name="Floor"></a><font color=Green><u>class</u></font> <font color=Cyan>(</font>Ring r<font color=Cyan>)</font> <font color=Red>=&gt;</font> Floor r <font color=Green><u>where</u></font>
<a name="line-209"></a>  <font color=Blue><i>-- | Compute the floor of /x/, i.e., the greatest integer /n/ such</i></font>
<a name="line-210"></a>  <font color=Blue><i>-- that /n/ &#8804; /x/.</i></font>
<a name="line-211"></a>  floor_of <font color=Red>::</font> r <font color=Red>-&gt;</font> Integer
<a name="line-212"></a>  floor_of x <font color=Red>=</font> <font color=Blue><i>-</i></font><font color=Cyan>(</font>ceiling_of <font color=Cyan>(</font><font color=Blue><i>-</i></font>x<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-213"></a>  <font color=Blue><i>-- | Compute the ceiling of /x/, i.e., the least integer /n/ such</i></font>
<a name="line-214"></a>  <font color=Blue><i>-- that /x/ &#8804; /n/.</i></font>
<a name="line-215"></a>  ceiling_of <font color=Red>::</font> r <font color=Red>-&gt;</font> Integer
<a name="line-216"></a>  ceiling_of x <font color=Red>=</font> <font color=Blue><i>-</i></font><font color=Cyan>(</font>floor_of <font color=Cyan>(</font><font color=Blue><i>-</i></font>x<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-217"></a>
<a name="line-218"></a><font color=Green><u>instance</u></font> Floor Integer <font color=Green><u>where</u></font>
<a name="line-219"></a>  floor_of <font color=Red>=</font> id
<a name="line-220"></a>  ceiling_of <font color=Red>=</font> id
<a name="line-221"></a>
<a name="line-222"></a><font color=Green><u>instance</u></font> Floor Rational <font color=Green><u>where</u></font>
<a name="line-223"></a>  floor_of <font color=Red>=</font> floor
<a name="line-224"></a>  ceiling_of <font color=Red>=</font> ceiling
<a name="line-225"></a>
<a name="line-226"></a><font color=Green><u>instance</u></font> Floor Float <font color=Green><u>where</u></font>
<a name="line-227"></a>  floor_of <font color=Red>=</font> floor
<a name="line-228"></a>  ceiling_of <font color=Red>=</font> ceiling
<a name="line-229"></a>
<a name="line-230"></a><font color=Green><u>instance</u></font> Floor Double <font color=Green><u>where</u></font>
<a name="line-231"></a>  floor_of <font color=Red>=</font> floor
<a name="line-232"></a>  ceiling_of <font color=Red>=</font> ceiling
<a name="line-233"></a>
<a name="line-234"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-235"></a><font color=Blue><i>-- * Particular rings</i></font>
<a name="line-236"></a>
<a name="line-237"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-238"></a><font color=Blue><i>-- ** The ring &#8484;&#8322; of integers modulo 2</i></font>
<a name="line-239"></a>
<a name="line-240"></a><a name="Z2"></a><font color=Blue><i>-- | The ring &#8484;&#8322; of integers modulo 2. </i></font>
<a name="line-241"></a><a name="Z2"></a><font color=Green><u>data</u></font> Z2 <font color=Red>=</font> Even <font color=Red>|</font> Odd
<a name="line-242"></a>        <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Eq<font color=Cyan>)</font>
<a name="line-243"></a>                     
<a name="line-244"></a><font color=Green><u>instance</u></font> Show Z2 <font color=Green><u>where</u></font>
<a name="line-245"></a>  show Even <font color=Red>=</font> <font color=Magenta>"0"</font>
<a name="line-246"></a>  show Odd <font color=Red>=</font> <font color=Magenta>"1"</font>
<a name="line-247"></a>
<a name="line-248"></a><font color=Green><u>instance</u></font> Num Z2 <font color=Green><u>where</u></font>
<a name="line-249"></a>  Even <font color=Cyan>+</font> x <font color=Red>=</font> x
<a name="line-250"></a>  x <font color=Cyan>+</font> Even <font color=Red>=</font> x
<a name="line-251"></a>  Odd <font color=Cyan>+</font> Odd <font color=Red>=</font> Even
<a name="line-252"></a>  Even <font color=Cyan>*</font> x <font color=Red>=</font> Even
<a name="line-253"></a>  x <font color=Cyan>*</font> Even <font color=Red>=</font> Even
<a name="line-254"></a>  Odd <font color=Cyan>*</font> Odd <font color=Red>=</font> Odd
<a name="line-255"></a>  negate x <font color=Red>=</font> x
<a name="line-256"></a>  fromInteger n <font color=Red>=</font> <font color=Green><u>if</u></font> even n <font color=Green><u>then</u></font> Even <font color=Green><u>else</u></font> Odd
<a name="line-257"></a>  abs x <font color=Red>=</font> x
<a name="line-258"></a>  signum x <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-259"></a>
<a name="line-260"></a><font color=Green><u>instance</u></font> Adjoint Z2 <font color=Green><u>where</u></font>
<a name="line-261"></a>  adj x <font color=Red>=</font> x
<a name="line-262"></a>
<a name="line-263"></a><font color=Green><u>instance</u></font> Adjoint2 Z2 <font color=Green><u>where</u></font>
<a name="line-264"></a>  adj2 x <font color=Red>=</font> x
<a name="line-265"></a>
<a name="line-266"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-267"></a><font color=Blue><i>-- ** The ring [bold D] of dyadic rationals</i></font>
<a name="line-268"></a>
<a name="line-269"></a><a name="Dyadic"></a><font color=Blue><i>-- | A dyadic rational is a rational number whose denominator is a</i></font>
<a name="line-270"></a><a name="Dyadic"></a><font color=Blue><i>-- power of 2. We denote the dyadic rationals by [bold D] = &#8484;[&#189;].</i></font>
<a name="line-271"></a><a name="Dyadic"></a><font color=Blue><i>-- </i></font>
<a name="line-272"></a><a name="Dyadic"></a><font color=Blue><i>-- We internally represent a dyadic rational /a/\/2[sup /n/] as a pair</i></font>
<a name="line-273"></a><a name="Dyadic"></a><font color=Blue><i>-- (/a/,/n/). Note that this representation is not unique. When it is</i></font>
<a name="line-274"></a><a name="Dyadic"></a><font color=Blue><i>-- necessary to choose a canonical representative, we choose the least</i></font>
<a name="line-275"></a><a name="Dyadic"></a><font color=Blue><i>-- possible /n/&#8805;0.</i></font>
<a name="line-276"></a><a name="Dyadic"></a><font color=Green><u>data</u></font> Dyadic <font color=Red>=</font> Dyadic <font color=Cyan>!</font>Integer <font color=Cyan>!</font>Integer
<a name="line-277"></a>
<a name="line-278"></a><a name="decompose_dyadic"></a><font color=Blue><i>-- | Given a dyadic rational /r/, return (/a/,/n/) such that /r/ =</i></font>
<a name="line-279"></a><font color=Blue><i>-- /a/\/2[sup /n/], where /n/&#8805;0 is chosen as small as possible.</i></font>
<a name="line-280"></a><font color=Blue>decompose_dyadic</font> <font color=Red>::</font> Dyadic <font color=Red>-&gt;</font> <font color=Cyan>(</font>Integer<font color=Cyan>,</font> Integer<font color=Cyan>)</font>
<a name="line-281"></a><font color=Blue>decompose_dyadic</font> <font color=Cyan>(</font>Dyadic a n<font color=Cyan>)</font> 
<a name="line-282"></a>  <font color=Red>|</font> a <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-283"></a>  <font color=Red>|</font> n <font color=Cyan>&gt;=</font> k <font color=Red>=</font> <font color=Cyan>(</font>b<font color=Cyan>,</font> n<font color=Blue><i>-</i></font>k<font color=Cyan>)</font>
<a name="line-284"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> <font color=Cyan>(</font>shiftL b <font color=Cyan>(</font>fromInteger <font color=Cyan>(</font>k<font color=Blue><i>-</i></font>n<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-285"></a>  <font color=Green><u>where</u></font>
<a name="line-286"></a>    <font color=Cyan>(</font>b<font color=Cyan>,</font>k<font color=Cyan>)</font> <font color=Red>=</font> lobit a
<a name="line-287"></a>
<a name="line-288"></a><a name="integer_of_dyadic"></a><font color=Blue><i>-- | Given a dyadic rational /r/ and an integer /k/&#8805;0, such that /a/ =</i></font>
<a name="line-289"></a><font color=Blue><i>-- /r/2[sup /k/] is an integer, return /a/. If /a/ is not an integer,</i></font>
<a name="line-290"></a><font color=Blue><i>-- the behavior is undefined.</i></font>
<a name="line-291"></a><font color=Blue>integer_of_dyadic</font> <font color=Red>::</font> Dyadic <font color=Red>-&gt;</font> Integer <font color=Red>-&gt;</font> Integer
<a name="line-292"></a><font color=Blue>integer_of_dyadic</font> <font color=Cyan>(</font>Dyadic a n<font color=Cyan>)</font> k <font color=Red>=</font>
<a name="line-293"></a>  shift a <font color=Cyan>(</font>fromInteger <font color=Cyan>(</font>k<font color=Blue><i>-</i></font>n<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-294"></a>
<a name="line-295"></a><font color=Green><u>instance</u></font> Real Dyadic <font color=Green><u>where</u></font>
<a name="line-296"></a>  toRational <font color=Cyan>(</font>Dyadic a n<font color=Cyan>)</font> 
<a name="line-297"></a>    <font color=Red>|</font> n <font color=Cyan>&gt;=</font> <font color=Magenta>0</font>    <font color=Red>=</font> a <font color=Cyan>%</font> <font color=Magenta>2</font><font color=Cyan>^</font>n
<a name="line-298"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font> a <font color=Cyan>*</font> <font color=Magenta>2</font><font color=Cyan>^</font><font color=Cyan>(</font><font color=Blue><i>-</i></font>n<font color=Cyan>)</font> <font color=Cyan>%</font> <font color=Magenta>1</font>
<a name="line-299"></a>
<a name="line-300"></a><font color=Green><u>instance</u></font> Show Dyadic <font color=Green><u>where</u></font>
<a name="line-301"></a>  showsPrec d a <font color=Red>=</font> showsPrec_rational d <font color=Cyan>(</font>toRational a<font color=Cyan>)</font>
<a name="line-302"></a>
<a name="line-303"></a><font color=Green><u>instance</u></font> Eq Dyadic <font color=Green><u>where</u></font>
<a name="line-304"></a>  Dyadic a n <font color=Cyan>==</font> Dyadic b m <font color=Red>=</font> a <font color=Cyan>*</font> <font color=Magenta>2</font><font color=Cyan>^</font><font color=Cyan>(</font>k<font color=Blue><i>-</i></font>n<font color=Cyan>)</font> <font color=Cyan>==</font> b <font color=Cyan>*</font> <font color=Magenta>2</font><font color=Cyan>^</font><font color=Cyan>(</font>k<font color=Blue><i>-</i></font>m<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-305"></a>    k <font color=Red>=</font> max n m
<a name="line-306"></a>
<a name="line-307"></a><font color=Green><u>instance</u></font> Ord Dyadic <font color=Green><u>where</u></font>
<a name="line-308"></a>  compare <font color=Cyan>(</font>Dyadic a n<font color=Cyan>)</font> <font color=Cyan>(</font>Dyadic b m<font color=Cyan>)</font> <font color=Red>=</font> compare <font color=Cyan>(</font>a <font color=Cyan>*</font> <font color=Magenta>2</font><font color=Cyan>^</font><font color=Cyan>(</font>k<font color=Blue><i>-</i></font>n<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font>b <font color=Cyan>*</font> <font color=Magenta>2</font><font color=Cyan>^</font><font color=Cyan>(</font>k<font color=Blue><i>-</i></font>m<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-309"></a>    k <font color=Red>=</font> max n m
<a name="line-310"></a>
<a name="line-311"></a><font color=Green><u>instance</u></font> Num Dyadic <font color=Green><u>where</u></font>
<a name="line-312"></a>  Dyadic a n <font color=Cyan>+</font> Dyadic b m 
<a name="line-313"></a>    <font color=Red>|</font> n <font color=Cyan>&lt;</font> m     <font color=Red>=</font> Dyadic c m
<a name="line-314"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font> Dyadic d n
<a name="line-315"></a>    <font color=Green><u>where</u></font>
<a name="line-316"></a>      c <font color=Red>=</font> shiftL a <font color=Cyan>(</font>fromInteger <font color=Cyan>(</font>m<font color=Blue><i>-</i></font>n<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>+</font> b
<a name="line-317"></a>      d <font color=Red>=</font> a <font color=Cyan>+</font> shiftL b <font color=Cyan>(</font>fromInteger <font color=Cyan>(</font>n<font color=Blue><i>-</i></font>m<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-318"></a>  Dyadic a n <font color=Cyan>*</font> Dyadic b m <font color=Red>=</font> Dyadic <font color=Cyan>(</font>a<font color=Cyan>*</font>b<font color=Cyan>)</font> <font color=Cyan>(</font>n<font color=Cyan>+</font>m<font color=Cyan>)</font>
<a name="line-319"></a>  negate <font color=Cyan>(</font>Dyadic a n<font color=Cyan>)</font> <font color=Red>=</font> Dyadic <font color=Cyan>(</font><font color=Blue><i>-</i></font>a<font color=Cyan>)</font> n
<a name="line-320"></a>  abs x <font color=Red>=</font> <font color=Green><u>if</u></font> x <font color=Cyan>&gt;=</font> <font color=Magenta>0</font> <font color=Green><u>then</u></font> x <font color=Green><u>else</u></font> <font color=Blue><i>-</i></font>x
<a name="line-321"></a>  signum x <font color=Red>=</font> <font color=Green><u>case</u></font> compare <font color=Magenta>0</font> x <font color=Green><u>of</u></font> <font color=Cyan>{</font> LT <font color=Red>-&gt;</font> <font color=Magenta>1</font><font color=Cyan>;</font> EQ <font color=Red>-&gt;</font> <font color=Magenta>0</font><font color=Cyan>;</font> GT <font color=Red>-&gt;</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font> <font color=Cyan>}</font>
<a name="line-322"></a>  fromInteger n <font color=Red>=</font> Dyadic n <font color=Magenta>0</font>
<a name="line-323"></a>
<a name="line-324"></a><font color=Green><u>instance</u></font> HalfRing Dyadic <font color=Green><u>where</u></font>
<a name="line-325"></a>  half <font color=Red>=</font> Dyadic <font color=Magenta>1</font> <font color=Magenta>1</font>
<a name="line-326"></a>
<a name="line-327"></a><font color=Green><u>instance</u></font> Adjoint Dyadic <font color=Green><u>where</u></font>
<a name="line-328"></a>  adj x <font color=Red>=</font> x
<a name="line-329"></a>
<a name="line-330"></a><font color=Green><u>instance</u></font> Adjoint2 Dyadic <font color=Green><u>where</u></font>
<a name="line-331"></a>  adj2 x <font color=Red>=</font> x
<a name="line-332"></a>
<a name="line-333"></a><font color=Blue><i>-- | The unique ring homomorphism from &#8484;[&#189;] to any ring containing</i></font>
<a name="line-334"></a><font color=Blue><i>-- &#189;. This exists because &#8484;[&#189;] is the free such ring.</i></font>
<a name="line-335"></a>
<a name="line-336"></a><a name="fromDyadic"></a><font color=Blue><i>-- Implementation note: we can't just use fromInteger a * half^n,</i></font>
<a name="line-337"></a><font color=Blue><i>-- because this can give potentially bad round-off errors in case</i></font>
<a name="line-338"></a><font color=Blue><i>-- half^n underflows in the target type. Moreover, this does not work</i></font>
<a name="line-339"></a><font color=Blue><i>-- if n is negative.</i></font>
<a name="line-340"></a><font color=Blue>fromDyadic</font> <font color=Red>::</font> <font color=Cyan>(</font>HalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Dyadic <font color=Red>-&gt;</font> a
<a name="line-341"></a><font color=Blue>fromDyadic</font> x <font color=Red>=</font> aux <font color=Cyan>(</font>fromInteger a<font color=Cyan>)</font> n <font color=Green><u>where</u></font>
<a name="line-342"></a>  <font color=Cyan>(</font>a<font color=Cyan>,</font>n<font color=Cyan>)</font> <font color=Red>=</font> decompose_dyadic x
<a name="line-343"></a>  aux <font color=Cyan>!</font>a <font color=Cyan>!</font>n
<a name="line-344"></a>    <font color=Red>|</font> n<font color=Cyan>&gt;</font><font color=Magenta>0</font>       <font color=Red>=</font> aux <font color=Cyan>(</font>half<font color=Cyan>*</font>a<font color=Cyan>)</font> <font color=Cyan>(</font>n<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-345"></a>    <font color=Red>|</font> n<font color=Cyan>==</font><font color=Magenta>0</font>      <font color=Red>=</font> a
<a name="line-346"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font> aux <font color=Cyan>(</font><font color=Magenta>2</font><font color=Cyan>*</font>a<font color=Cyan>)</font> <font color=Cyan>(</font>n<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-347"></a>
<a name="line-348"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-349"></a><font color=Blue><i>-- ** The ring &#8474; of rational numbers</i></font>
<a name="line-350"></a>
<a name="line-351"></a><a name="Rationals"></a><font color=Blue><i>-- | We define our own variant of the rational numbers, which is an</i></font>
<a name="line-352"></a><a name="Rationals"></a><font color=Blue><i>-- identical copy of the type 'Rational' from the standard Haskell</i></font>
<a name="line-353"></a><a name="Rationals"></a><font color=Blue><i>-- library, except that it has a more sensible 'Show' instance.</i></font>
<a name="line-354"></a><a name="Rationals"></a><font color=Green><u>newtype</u></font> Rationals <font color=Red>=</font> ToRationals <font color=Cyan>{</font> unRationals <font color=Red>::</font> Rational <font color=Cyan>}</font>
<a name="line-355"></a>                  <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Num<font color=Cyan>,</font> Eq<font color=Cyan>,</font> Ord<font color=Cyan>,</font> Fractional<font color=Cyan>,</font> Real<font color=Cyan>,</font> RealFrac<font color=Cyan>,</font> HalfRing<font color=Cyan>,</font> Adjoint<font color=Cyan>,</font> Adjoint2<font color=Cyan>,</font> ToEComplex<font color=Cyan>,</font> Floor<font color=Cyan>)</font>
<a name="line-356"></a>
<a name="line-357"></a><a name="showsPrec_rational"></a><font color=Blue><i>-- | An auxiliary function for printing rational numbers, using</i></font>
<a name="line-358"></a><font color=Blue><i>-- correct precedences, and omitting denominators of 1.</i></font>
<a name="line-359"></a><font color=Blue>showsPrec_rational</font> <font color=Red>::</font> <font color=Cyan>(</font>Show a<font color=Cyan>,</font> Integral a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Int <font color=Red>-&gt;</font> Ratio a <font color=Red>-&gt;</font> ShowS
<a name="line-360"></a><font color=Blue>showsPrec_rational</font> d a
<a name="line-361"></a>  <font color=Red>|</font> denom <font color=Cyan>==</font> <font color=Magenta>1</font> <font color=Red>=</font> showsPrec d numer
<a name="line-362"></a>  <font color=Red>|</font> numer <font color=Cyan>&lt;</font> <font color=Magenta>0</font>  <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>5</font><font color=Cyan>)</font> <font color=Cyan>$</font> showString <font color=Magenta>"-"</font> <font color=Cyan>.</font> showsPrec_rational <font color=Magenta>6</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>a<font color=Cyan>)</font>
<a name="line-363"></a>  <font color=Red>|</font> otherwise  <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>6</font><font color=Cyan>)</font> <font color=Cyan>$</font>
<a name="line-364"></a>                 showsPrec <font color=Magenta>7</font> numer <font color=Cyan>.</font> showString <font color=Magenta>"/"</font> <font color=Cyan>.</font> showsPrec <font color=Magenta>7</font> denom
<a name="line-365"></a>    <font color=Green><u>where</u></font>
<a name="line-366"></a>      numer <font color=Red>=</font> numerator a
<a name="line-367"></a>      denom <font color=Red>=</font> denominator a
<a name="line-368"></a>
<a name="line-369"></a><font color=Green><u>instance</u></font> Show Rationals <font color=Green><u>where</u></font>
<a name="line-370"></a>  showsPrec d <font color=Cyan>(</font>ToRationals a<font color=Cyan>)</font> <font color=Red>=</font> showsPrec_rational d a
<a name="line-371"></a>
<a name="line-372"></a><a name="fromRationals"></a><font color=Blue><i>-- | Conversion from 'Rationals' to any 'Fractional' type.</i></font>
<a name="line-373"></a><font color=Blue>fromRationals</font> <font color=Red>::</font> <font color=Cyan>(</font>Fractional a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Rationals <font color=Red>-&gt;</font> a
<a name="line-374"></a><font color=Blue>fromRationals</font> <font color=Red>=</font> fromRational <font color=Cyan>.</font> unRationals
<a name="line-375"></a>
<a name="line-376"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-377"></a><font color=Blue><i>-- ** The ring /R/[&#8730;2]</i></font>
<a name="line-378"></a>  
<a name="line-379"></a><a name="RootTwo"></a><font color=Blue><i>-- | The ring /R/[&#8730;2], where /R/ is any ring. The value 'RootTwo' /a/</i></font>
<a name="line-380"></a><a name="RootTwo"></a><font color=Blue><i>-- /b/ represents /a/ + /b/ &#8730;2.</i></font>
<a name="line-381"></a><a name="RootTwo"></a><font color=Green><u>data</u></font> RootTwo a <font color=Red>=</font> RootTwo <font color=Cyan>!</font>a <font color=Cyan>!</font>a
<a name="line-382"></a>                <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Eq<font color=Cyan>)</font>
<a name="line-383"></a>
<a name="line-384"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Num <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-385"></a>  RootTwo a b <font color=Cyan>+</font> RootTwo a' b' <font color=Red>=</font> RootTwo a'' b'' <font color=Green><u>where</u></font>
<a name="line-386"></a>    a'' <font color=Red>=</font> a <font color=Cyan>+</font> a'
<a name="line-387"></a>    b'' <font color=Red>=</font> b <font color=Cyan>+</font> b'
<a name="line-388"></a>  RootTwo a b <font color=Cyan>*</font> RootTwo a' b' <font color=Red>=</font> RootTwo a'' b'' <font color=Green><u>where</u></font>
<a name="line-389"></a>    a'' <font color=Red>=</font> a <font color=Cyan>*</font> a' <font color=Cyan>+</font> <font color=Magenta>2</font> <font color=Cyan>*</font> b <font color=Cyan>*</font> b'
<a name="line-390"></a>    b'' <font color=Red>=</font> a <font color=Cyan>*</font> b' <font color=Cyan>+</font> a' <font color=Cyan>*</font> b
<a name="line-391"></a>  negate <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font> <font color=Red>=</font> RootTwo a' b' <font color=Green><u>where</u></font>
<a name="line-392"></a>    a' <font color=Red>=</font> <font color=Blue><i>-</i></font>a
<a name="line-393"></a>    b' <font color=Red>=</font> <font color=Blue><i>-</i></font>b
<a name="line-394"></a>  fromInteger n <font color=Red>=</font> RootTwo n' <font color=Magenta>0</font> <font color=Green><u>where</u></font>
<a name="line-395"></a>    n' <font color=Red>=</font> fromInteger n
<a name="line-396"></a>  abs f <font color=Red>=</font> f <font color=Cyan>*</font> signum f
<a name="line-397"></a>  signum f<font color=Red>@</font><font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font>
<a name="line-398"></a>    <font color=Red>|</font> sa <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Cyan>&amp;&amp;</font> sb <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-399"></a>    <font color=Red>|</font> sa <font color=Cyan>/=</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> sb <font color=Cyan>/=</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font> <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-400"></a>    <font color=Red>|</font> sa <font color=Cyan>/=</font> <font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> sb <font color=Cyan>/=</font> <font color=Magenta>1</font> <font color=Red>=</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font>
<a name="line-401"></a>    <font color=Red>|</font> sa <font color=Cyan>/=</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> sb <font color=Cyan>/=</font> <font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> signum <font color=Cyan>(</font>a<font color=Cyan>*</font>a <font color=Blue><i>-</i></font> <font color=Magenta>2</font><font color=Cyan>*</font>b<font color=Cyan>*</font>b<font color=Cyan>)</font> <font color=Cyan>/=</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font> <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-402"></a>    <font color=Red>|</font> sa <font color=Cyan>/=</font> <font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> sb <font color=Cyan>/=</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> signum <font color=Cyan>(</font>a<font color=Cyan>*</font>a <font color=Blue><i>-</i></font> <font color=Magenta>2</font><font color=Cyan>*</font>b<font color=Cyan>*</font>b<font color=Cyan>)</font> <font color=Cyan>/=</font> <font color=Magenta>1</font>  <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-403"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font>
<a name="line-404"></a>    <font color=Green><u>where</u></font>
<a name="line-405"></a>      sa <font color=Red>=</font> signum a
<a name="line-406"></a>      sb <font color=Red>=</font> signum b
<a name="line-407"></a>
<a name="line-408"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Ord <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-409"></a>  x <font color=Cyan>&lt;=</font> y  <font color=Red>=</font>  signum <font color=Cyan>(</font>y<font color=Blue><i>-</i></font>x<font color=Cyan>)</font> <font color=Cyan>/=</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-410"></a>  
<a name="line-411"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Show a<font color=Cyan>,</font> Eq a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-412"></a>  showsPrec d <font color=Cyan>(</font>RootTwo a <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>=</font> showsPrec d a
<a name="line-413"></a>  showsPrec d <font color=Cyan>(</font>RootTwo <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Red>=</font> showString <font color=Magenta>"&#8730;2"</font>
<a name="line-414"></a>  showsPrec d <font color=Cyan>(</font>RootTwo <font color=Magenta>0</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>5</font><font color=Cyan>)</font> <font color=Cyan>$</font> showString <font color=Magenta>"-&#8730;2"</font>
<a name="line-415"></a>  showsPrec d <font color=Cyan>(</font>RootTwo <font color=Magenta>0</font> b<font color=Cyan>)</font> <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>10</font><font color=Cyan>)</font> <font color=Cyan>$</font> 
<a name="line-416"></a>    showsPrec <font color=Magenta>11</font> b <font color=Cyan>.</font> showString <font color=Magenta>" &#8730;2"</font>
<a name="line-417"></a>  showsPrec d <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font> <font color=Red>|</font> signum b <font color=Cyan>==</font> <font color=Magenta>1</font> <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>6</font><font color=Cyan>)</font> <font color=Cyan>$</font>
<a name="line-418"></a>    showsPrec <font color=Magenta>7</font> a <font color=Cyan>.</font> showString <font color=Magenta>" + "</font> <font color=Cyan>.</font> showsPrec <font color=Magenta>7</font> <font color=Cyan>(</font>RootTwo <font color=Magenta>0</font> b<font color=Cyan>)</font>
<a name="line-419"></a>  showsPrec d <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font> <font color=Red>|</font> otherwise <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>6</font><font color=Cyan>)</font> <font color=Cyan>$</font>
<a name="line-420"></a>    showsPrec <font color=Magenta>7</font> a <font color=Cyan>.</font> showString <font color=Magenta>" - "</font> <font color=Cyan>.</font> showsPrec <font color=Magenta>7</font> <font color=Cyan>(</font>RootTwo <font color=Magenta>0</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>b<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-421"></a>
<a name="line-422"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> Adjoint2 a<font color=Cyan>,</font> Fractional a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Fractional <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-423"></a>  recip y <font color=Red>=</font> RootTwo <font color=Cyan>(</font>a<font color=Cyan>/</font>k<font color=Cyan>)</font> <font color=Cyan>(</font>b<font color=Cyan>/</font>k<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-424"></a>    RootTwo k <font color=Green><u>_</u></font> <font color=Red>=</font> y <font color=Cyan>*</font> adj2 y
<a name="line-425"></a>    RootTwo a b <font color=Red>=</font> adj2 y
<a name="line-426"></a>  fromRational r <font color=Red>=</font> fromInteger a <font color=Cyan>/</font> fromInteger b <font color=Green><u>where</u></font>
<a name="line-427"></a>    a <font color=Red>=</font> numerator r
<a name="line-428"></a>    b <font color=Red>=</font> denominator r
<a name="line-429"></a>
<a name="line-430"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootTwoRing <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-431"></a>  roottwo <font color=Red>=</font> RootTwo <font color=Magenta>0</font> <font color=Magenta>1</font>
<a name="line-432"></a>
<a name="line-433"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> HalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> HalfRing <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-434"></a>  half <font color=Red>=</font> RootTwo half <font color=Magenta>0</font>
<a name="line-435"></a>  
<a name="line-436"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> HalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootHalfRing <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-437"></a>  roothalf <font color=Red>=</font> RootTwo <font color=Magenta>0</font> half
<a name="line-438"></a>  
<a name="line-439"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> ComplexRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ComplexRing <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-440"></a>  i <font color=Red>=</font> RootTwo i <font color=Magenta>0</font>
<a name="line-441"></a>
<a name="line-442"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Adjoint a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>  
<a name="line-443"></a>  adj <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font> <font color=Red>=</font> RootTwo <font color=Cyan>(</font>adj a<font color=Cyan>)</font> <font color=Cyan>(</font>adj b<font color=Cyan>)</font>
<a name="line-444"></a>
<a name="line-445"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Adjoint2 a<font color=Cyan>,</font> Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint2 <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>  
<a name="line-446"></a>  adj2 <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font> <font color=Red>=</font> RootTwo <font color=Cyan>(</font>adj2 a<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>adj2 b<font color=Cyan>)</font>
<a name="line-447"></a>
<a name="line-448"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> NormedRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> NormedRing <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-449"></a>  norm <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>norm a<font color=Cyan>)</font><font color=Cyan>^</font><font color=Magenta>2</font> <font color=Blue><i>-</i></font> <font color=Magenta>2</font> <font color=Cyan>*</font> <font color=Cyan>(</font>norm b<font color=Cyan>)</font><font color=Cyan>^</font><font color=Magenta>2</font>
<a name="line-450"></a>
<a name="line-451"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-452"></a><font color=Blue><i>-- ** The ring &#8484;[&#8730;2]</i></font>
<a name="line-453"></a>
<a name="line-454"></a><a name="DInteger"></a><font color=Blue><i>-- | The ring &#8484;[&#8730;2].</i></font>
<a name="line-455"></a><a name="DInteger"></a><font color=Green><u>type</u></font> DInteger <font color=Red>=</font> RootTwo Integer
<a name="line-456"></a>
<a name="line-457"></a><a name="fromDInteger"></a><font color=Blue><i>-- | The unique ring homomorphism from &#8484;[&#8730;2] to any ring containing</i></font>
<a name="line-458"></a><font color=Blue><i>-- &#8730;2. This exists because &#8484;[&#8730;2] is the free such ring.</i></font>
<a name="line-459"></a><font color=Blue>fromDInteger</font> <font color=Red>::</font> <font color=Cyan>(</font>RootTwoRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> DInteger <font color=Red>-&gt;</font> a
<a name="line-460"></a><font color=Blue>fromDInteger</font> <font color=Cyan>(</font>RootTwo x y<font color=Cyan>)</font> <font color=Red>=</font> fromInteger x <font color=Cyan>+</font> roottwo <font color=Cyan>*</font> fromInteger y
<a name="line-461"></a>
<a name="line-462"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-463"></a><font color=Blue><i>-- ** The ring &#8484;[1\/&#8730;2]</i></font>
<a name="line-464"></a>
<a name="line-465"></a><a name="DReal"></a><font color=Blue><i>-- | The ring &#8484;[1\/&#8730;2]. We think of the elements of &#8484;[1\/&#8730;2] as</i></font>
<a name="line-466"></a><a name="DReal"></a><font color=Blue><i>-- (certain) exact real numbers. The \"D\" stands for \"dyadic\".</i></font>
<a name="line-467"></a><a name="DReal"></a><font color=Green><u>type</u></font> DReal <font color=Red>=</font> RootTwo Dyadic
<a name="line-468"></a>
<a name="line-469"></a><a name="fromDReal"></a><font color=Blue><i>-- | The unique ring homomorphism from &#8484;[1\/&#8730;2] to any ring containing</i></font>
<a name="line-470"></a><font color=Blue><i>-- 1\/&#8730;2. This exists because &#8484;[1\/&#8730;2] is the free such ring.</i></font>
<a name="line-471"></a><font color=Blue>fromDReal</font> <font color=Red>::</font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> DReal <font color=Red>-&gt;</font> a
<a name="line-472"></a><font color=Blue>fromDReal</font> <font color=Cyan>(</font>RootTwo x y<font color=Cyan>)</font> <font color=Red>=</font> fromDyadic x <font color=Cyan>+</font> roottwo <font color=Cyan>*</font> fromDyadic y
<a name="line-473"></a>
<a name="line-474"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-475"></a><font color=Blue><i>-- ** The field &#8474;[&#8730;2]</i></font>
<a name="line-476"></a>
<a name="line-477"></a><a name="EReal"></a><font color=Blue><i>-- | The field &#8474;[&#8730;2]. We think of the elements of &#8474;[&#8730;2] as (certain)</i></font>
<a name="line-478"></a><a name="EReal"></a><font color=Blue><i>-- exact real numbers, so the \"E\" stands for \"exact\".</i></font>
<a name="line-479"></a><a name="EReal"></a><font color=Green><u>type</u></font> EReal <font color=Red>=</font> RootTwo Rationals
<a name="line-480"></a>
<a name="line-481"></a><font color=Green><u>instance</u></font> Floor EReal <font color=Green><u>where</u></font>
<a name="line-482"></a>  floor_of x<font color=Red>@</font><font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font>
<a name="line-483"></a>    <font color=Red>|</font> r'<font color=Cyan>+</font><font color=Magenta>1</font> <font color=Cyan>&lt;=</font> x  <font color=Red>=</font> r<font color=Cyan>+</font><font color=Magenta>1</font>
<a name="line-484"></a>    <font color=Red>|</font> r' <font color=Cyan>&lt;=</font> x    <font color=Red>=</font> r
<a name="line-485"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font> r<font color=Blue><i>-</i></font><font color=Magenta>1</font> 
<a name="line-486"></a>   <font color=Green><u>where</u></font> 
<a name="line-487"></a>    a' <font color=Red>=</font> floor a
<a name="line-488"></a>    b' <font color=Red>=</font> intsqrt <font color=Cyan>(</font>floor <font color=Cyan>(</font><font color=Magenta>2</font> <font color=Cyan>*</font> b<font color=Cyan>^</font><font color=Magenta>2</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-489"></a>    r <font color=Red>|</font> b <font color=Cyan>&gt;=</font> <font color=Magenta>0</font>    <font color=Red>=</font> a' <font color=Cyan>+</font> b'
<a name="line-490"></a>      <font color=Red>|</font> otherwise <font color=Red>=</font> a' <font color=Blue><i>-</i></font> b'
<a name="line-491"></a>    r' <font color=Red>=</font> fromInteger r
<a name="line-492"></a>
<a name="line-493"></a><a name="fromEReal"></a><font color=Blue><i>-- | The unique ring homomorphism from &#8474;[&#8730;2] to any ring containing</i></font>
<a name="line-494"></a><font color=Blue><i>-- the rational numbers and &#8730;2. This exists because &#8474;[&#8730;2] is the free</i></font>
<a name="line-495"></a><font color=Blue><i>-- such ring.</i></font>
<a name="line-496"></a><font color=Blue>fromEReal</font> <font color=Red>::</font> <font color=Cyan>(</font>RootTwoRing a<font color=Cyan>,</font> Fractional a<font color=Cyan>)</font> <font color=Red>=&gt;</font> EReal <font color=Red>-&gt;</font> a
<a name="line-497"></a><font color=Blue>fromEReal</font> <font color=Cyan>(</font>RootTwo x y<font color=Cyan>)</font> <font color=Red>=</font> fromRationals x <font color=Cyan>+</font> roottwo <font color=Cyan>*</font> fromRationals y
<a name="line-498"></a>
<a name="line-499"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-500"></a><font color=Blue><i>-- ** The ring /R/[/i/]</i></font>
<a name="line-501"></a>
<a name="line-502"></a><a name="Cplx"></a><font color=Blue><i>-- | The ring /R/[/i/], where /R/ is any ring. The reason we do not</i></font>
<a name="line-503"></a><a name="Cplx"></a><font color=Blue><i>-- use the 'Complex' /a/ type from the standard Haskell libraries is</i></font>
<a name="line-504"></a><a name="Cplx"></a><font color=Blue><i>-- that it assumes too much, for example, it assumes /a/ is a member</i></font>
<a name="line-505"></a><a name="Cplx"></a><font color=Blue><i>-- of the 'RealFloat' class. Also, this allows us to define a more</i></font>
<a name="line-506"></a><a name="Cplx"></a><font color=Blue><i>-- sensible 'Show' instance.</i></font>
<a name="line-507"></a><a name="Cplx"></a><font color=Green><u>data</u></font> Cplx a <font color=Red>=</font> Cplx <font color=Cyan>!</font>a <font color=Cyan>!</font>a
<a name="line-508"></a>            <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Eq<font color=Cyan>)</font>
<a name="line-509"></a>
<a name="line-510"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Eq a<font color=Cyan>,</font> Show a<font color=Cyan>,</font> Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-511"></a>  showsPrec d <font color=Cyan>(</font>Cplx a <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>=</font> showsPrec d a
<a name="line-512"></a>  showsPrec d <font color=Cyan>(</font>Cplx <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Red>=</font> showString <font color=Magenta>"i"</font>
<a name="line-513"></a>  showsPrec d <font color=Cyan>(</font>Cplx <font color=Magenta>0</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font><font color=Cyan>)</font> <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>5</font><font color=Cyan>)</font> <font color=Cyan>$</font> showString <font color=Magenta>"-i"</font>
<a name="line-514"></a>  showsPrec d <font color=Cyan>(</font>Cplx <font color=Magenta>0</font> b<font color=Cyan>)</font> <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>10</font><font color=Cyan>)</font> <font color=Cyan>$</font> 
<a name="line-515"></a>    showsPrec <font color=Magenta>11</font> b <font color=Cyan>.</font> showString <font color=Magenta>" i"</font>
<a name="line-516"></a>  showsPrec d <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>|</font> signum b <font color=Cyan>==</font> <font color=Magenta>1</font> <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>6</font><font color=Cyan>)</font> <font color=Cyan>$</font>
<a name="line-517"></a>    showsPrec <font color=Magenta>7</font> a <font color=Cyan>.</font> showString <font color=Magenta>" + "</font> <font color=Cyan>.</font> showsPrec <font color=Magenta>7</font> <font color=Cyan>(</font>Cplx <font color=Magenta>0</font> b<font color=Cyan>)</font>
<a name="line-518"></a>  showsPrec d <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>|</font> otherwise <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>6</font><font color=Cyan>)</font> <font color=Cyan>$</font>
<a name="line-519"></a>    showsPrec <font color=Magenta>7</font> a <font color=Cyan>.</font> showString <font color=Magenta>" - "</font> <font color=Cyan>.</font> showsPrec <font color=Magenta>7</font> <font color=Cyan>(</font>Cplx <font color=Magenta>0</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>b<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-520"></a>
<a name="line-521"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Num <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-522"></a>  Cplx a b <font color=Cyan>+</font> Cplx a' b' <font color=Red>=</font> Cplx a'' b'' <font color=Green><u>where</u></font>
<a name="line-523"></a>    a'' <font color=Red>=</font> a <font color=Cyan>+</font> a'
<a name="line-524"></a>    b'' <font color=Red>=</font> b <font color=Cyan>+</font> b'
<a name="line-525"></a>  Cplx a b <font color=Cyan>*</font> Cplx a' b' <font color=Red>=</font> Cplx a'' b'' <font color=Green><u>where</u></font>
<a name="line-526"></a>    a'' <font color=Red>=</font> a <font color=Cyan>*</font> a' <font color=Blue><i>-</i></font> b <font color=Cyan>*</font> b'
<a name="line-527"></a>    b'' <font color=Red>=</font> a <font color=Cyan>*</font> b' <font color=Cyan>+</font> a' <font color=Cyan>*</font> b
<a name="line-528"></a>  negate <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> Cplx a' b' <font color=Green><u>where</u></font>
<a name="line-529"></a>    a' <font color=Red>=</font> <font color=Blue><i>-</i></font>a
<a name="line-530"></a>    b' <font color=Red>=</font> <font color=Blue><i>-</i></font>b
<a name="line-531"></a>  fromInteger n <font color=Red>=</font> Cplx n' <font color=Magenta>0</font> <font color=Green><u>where</u></font>
<a name="line-532"></a>    n' <font color=Red>=</font> fromInteger n
<a name="line-533"></a>  abs x <font color=Red>=</font> x
<a name="line-534"></a>  signum x <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-535"></a>
<a name="line-536"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Fractional a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Fractional <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-537"></a>  fromRational a <font color=Red>=</font> Cplx <font color=Cyan>(</font>fromRational a<font color=Cyan>)</font> <font color=Magenta>0</font>
<a name="line-538"></a>  recip <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> Cplx <font color=Cyan>(</font>a<font color=Cyan>/</font>d<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>b<font color=Cyan>/</font>d<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-539"></a>    d <font color=Red>=</font> a<font color=Cyan>^</font><font color=Magenta>2</font> <font color=Cyan>+</font> b<font color=Cyan>^</font><font color=Magenta>2</font>
<a name="line-540"></a>
<a name="line-541"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ComplexRing <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-542"></a>  i <font color=Red>=</font> Cplx <font color=Magenta>0</font> <font color=Magenta>1</font>
<a name="line-543"></a>
<a name="line-544"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>HalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> HalfRing <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-545"></a>  half <font color=Red>=</font> Cplx half <font color=Magenta>0</font>
<a name="line-546"></a>
<a name="line-547"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootHalfRing <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-548"></a>  roothalf <font color=Red>=</font> Cplx roothalf <font color=Magenta>0</font>
<a name="line-549"></a>
<a name="line-550"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>RootTwoRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootTwoRing <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-551"></a>  roottwo <font color=Red>=</font> Cplx roottwo <font color=Magenta>0</font>
<a name="line-552"></a>
<a name="line-553"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Adjoint a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-554"></a>  adj <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>Cplx <font color=Cyan>(</font>adj a<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Cyan>(</font>adj b<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-555"></a>
<a name="line-556"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Adjoint2 a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint2 <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-557"></a>  adj2 <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>Cplx <font color=Cyan>(</font>adj2 a<font color=Cyan>)</font> <font color=Cyan>(</font>adj2 b<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-558"></a>
<a name="line-559"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>NormedRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> NormedRing <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-560"></a>  norm <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>norm a<font color=Cyan>)</font><font color=Cyan>^</font><font color=Magenta>2</font> <font color=Cyan>+</font> <font color=Cyan>(</font>norm b<font color=Cyan>)</font><font color=Cyan>^</font><font color=Magenta>2</font>
<a name="line-561"></a>
<a name="line-562"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-563"></a><font color=Blue><i>-- ** The ring &#8484;[/i/] of Gaussian integers</i></font>
<a name="line-564"></a>
<a name="line-565"></a><a name="ZComplex"></a><font color=Blue><i>-- | The ring &#8484;[/i/] of Gaussian integers.</i></font>
<a name="line-566"></a><a name="ZComplex"></a><font color=Green><u>type</u></font> ZComplex <font color=Red>=</font> Cplx Integer
<a name="line-567"></a>
<a name="line-568"></a><a name="fromZComplex"></a><font color=Blue><i>-- | The unique ring homomorphism from &#8484;[/i/] to any ring containing</i></font>
<a name="line-569"></a><font color=Blue><i>-- /i/. This exists because &#8484;[/i/] is the free such ring.</i></font>
<a name="line-570"></a><font color=Blue>fromZComplex</font> <font color=Red>::</font> <font color=Cyan>(</font>ComplexRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ZComplex <font color=Red>-&gt;</font> a
<a name="line-571"></a><font color=Blue>fromZComplex</font> <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> fromInteger a <font color=Cyan>+</font> i <font color=Cyan>*</font> fromInteger b
<a name="line-572"></a>
<a name="line-573"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-574"></a><font color=Blue><i>-- ** The ring &#8484;[1\/&#8730;2, /i/]</i></font>
<a name="line-575"></a>
<a name="line-576"></a><a name="DComplex"></a><font color=Blue><i>-- | The ring &#8484;[1\/&#8730;2, /i/]. We think of the elements as (certain)</i></font>
<a name="line-577"></a><a name="DComplex"></a><font color=Blue><i>-- exact complex numbers. The \"D\" stands for \"dyadic\".</i></font>
<a name="line-578"></a><a name="DComplex"></a><font color=Green><u>type</u></font> DComplex <font color=Red>=</font> Cplx DReal
<a name="line-579"></a>
<a name="line-580"></a><a name="fromDComplex"></a><font color=Blue><i>-- | The unique ring homomorphism from &#8484;[1\/&#8730;2, /i/] to any ring containing</i></font>
<a name="line-581"></a><font color=Blue><i>-- 1\/&#8730;2 and /i/. This exists because &#8484;[1\/&#8730;2, /i/] is the free such ring.</i></font>
<a name="line-582"></a><font color=Blue>fromDComplex</font> <font color=Red>::</font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>,</font> ComplexRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> DComplex <font color=Red>-&gt;</font> a
<a name="line-583"></a><font color=Blue>fromDComplex</font> <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> fromDReal a <font color=Cyan>+</font> i <font color=Cyan>*</font> fromDReal b
<a name="line-584"></a>
<a name="line-585"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-586"></a><font color=Blue><i>-- ** The ring &#8474;[&#8730;2, /i/]</i></font>
<a name="line-587"></a>
<a name="line-588"></a><a name="EComplex"></a><font color=Blue><i>-- | The field &#8474;[&#8730;2, /i/]. We think of the elements as (certain) exact</i></font>
<a name="line-589"></a><a name="EComplex"></a><font color=Blue><i>-- complex numbers, hence the \"E\" in the name.</i></font>
<a name="line-590"></a><a name="EComplex"></a><font color=Green><u>type</u></font> EComplex <font color=Red>=</font> Cplx EReal
<a name="line-591"></a>
<a name="line-592"></a><a name="fromEComplex"></a><font color=Blue><i>-- | The unique ring homomorphism from &#8474;[&#8730;2, /i/] to any ring</i></font>
<a name="line-593"></a><font color=Blue><i>-- containing the rational numbers, &#8730;2, and /i/. This exists because</i></font>
<a name="line-594"></a><font color=Blue><i>-- &#8474;[&#8730;2, /i/] is the free such ring.</i></font>
<a name="line-595"></a><font color=Blue>fromEComplex</font> <font color=Red>::</font> <font color=Cyan>(</font>RootTwoRing a<font color=Cyan>,</font> ComplexRing a<font color=Cyan>,</font> Fractional a<font color=Cyan>)</font> <font color=Red>=&gt;</font> EComplex <font color=Red>-&gt;</font> a
<a name="line-596"></a><font color=Blue>fromEComplex</font> <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> fromEReal a <font color=Cyan>+</font> i <font color=Cyan>*</font> fromEReal b
<a name="line-597"></a>
<a name="line-598"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-599"></a><font color=Blue><i>-- ** The ring &#8450; of complex numbers</i></font>
<a name="line-600"></a>
<a name="line-601"></a><font color=Blue><i>-- $ We provide two versions of the complex numbers using floating</i></font>
<a name="line-602"></a><font color=Blue><i>-- point arithmetic.</i></font>
<a name="line-603"></a>
<a name="line-604"></a><a name="CDouble"></a><font color=Blue><i>-- | Double precision complex floating point numbers.</i></font>
<a name="line-605"></a><a name="CDouble"></a><font color=Green><u>type</u></font> CDouble <font color=Red>=</font> Cplx Double
<a name="line-606"></a>
<a name="line-607"></a><a name="CFloat"></a><font color=Blue><i>-- | Single precision complex floating point numbers.</i></font>
<a name="line-608"></a><a name="CFloat"></a><font color=Green><u>type</u></font> CFloat <font color=Red>=</font> Cplx Float
<a name="line-609"></a>
<a name="line-610"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-611"></a><font color=Blue><i>-- ** The ring /R/[&#969;]</i></font>
<a name="line-612"></a>
<a name="line-613"></a><a name="Omega"></a><font color=Blue><i>-- | The ring /R/[&#969;], where /R/ is any ring, and &#969; is an 8th root of</i></font>
<a name="line-614"></a><a name="Omega"></a><font color=Blue><i>-- unity. The value 'Omega' /a/ /b/ /c/ /d/ represents </i></font>
<a name="line-615"></a><a name="Omega"></a><font color=Blue><i>-- /a/&#969;[sup 3]+/b/&#969;[sup 2]+/c/&#969;+/d/.</i></font>
<a name="line-616"></a><a name="Omega"></a><font color=Green><u>data</u></font> Omega a <font color=Red>=</font> Omega <font color=Cyan>!</font>a <font color=Cyan>!</font>a <font color=Cyan>!</font>a <font color=Cyan>!</font>a
<a name="line-617"></a>            <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Eq<font color=Cyan>)</font>
<a name="line-618"></a>
<a name="line-619"></a><a name="omega_real"></a><font color=Blue><i>-- | An inverse to the embedding /R/ &#8614; /R/[&#969;]: return the \"real</i></font>
<a name="line-620"></a><font color=Blue><i>-- rational\" part.</i></font>
<a name="line-621"></a><font color=Blue>omega_real</font> <font color=Red>::</font> Omega a <font color=Red>-&gt;</font> a
<a name="line-622"></a><font color=Blue>omega_real</font> <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> d
<a name="line-623"></a>
<a name="line-624"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Show a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Show <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-625"></a>  show <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> <font color=Magenta>"&#937;"</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>a<font color=Cyan>,</font>b<font color=Cyan>,</font>c<font color=Cyan>,</font>d<font color=Cyan>)</font>
<a name="line-626"></a>
<a name="line-627"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Num a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Num <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-628"></a>  Omega a b c d <font color=Cyan>+</font> Omega a' b' c' d' <font color=Red>=</font> Omega a'' b'' c'' d'' <font color=Green><u>where</u></font>
<a name="line-629"></a>    a'' <font color=Red>=</font> a <font color=Cyan>+</font> a'
<a name="line-630"></a>    b'' <font color=Red>=</font> b <font color=Cyan>+</font> b'
<a name="line-631"></a>    c'' <font color=Red>=</font> c <font color=Cyan>+</font> c'
<a name="line-632"></a>    d'' <font color=Red>=</font> d <font color=Cyan>+</font> d'
<a name="line-633"></a>  Omega a b c d <font color=Cyan>*</font> Omega a' b' c' d' <font color=Red>=</font> Omega a'' b'' c'' d'' <font color=Green><u>where</u></font>  
<a name="line-634"></a>    a'' <font color=Red>=</font> a<font color=Cyan>*</font>d' <font color=Cyan>+</font> b<font color=Cyan>*</font>c' <font color=Cyan>+</font> c<font color=Cyan>*</font>b' <font color=Cyan>+</font> d<font color=Cyan>*</font>a'
<a name="line-635"></a>    b'' <font color=Red>=</font> b<font color=Cyan>*</font>d' <font color=Cyan>+</font> c<font color=Cyan>*</font>c' <font color=Cyan>+</font> d<font color=Cyan>*</font>b' <font color=Blue><i>-</i></font> a<font color=Cyan>*</font>a'
<a name="line-636"></a>    c'' <font color=Red>=</font> c<font color=Cyan>*</font>d' <font color=Cyan>+</font> d<font color=Cyan>*</font>c' <font color=Blue><i>-</i></font> a<font color=Cyan>*</font>b' <font color=Blue><i>-</i></font> b<font color=Cyan>*</font>a'
<a name="line-637"></a>    d'' <font color=Red>=</font> d<font color=Cyan>*</font>d' <font color=Blue><i>-</i></font> a<font color=Cyan>*</font>c' <font color=Blue><i>-</i></font> b<font color=Cyan>*</font>b' <font color=Blue><i>-</i></font> c<font color=Cyan>*</font>a'
<a name="line-638"></a>  negate <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> Omega <font color=Cyan>(</font><font color=Blue><i>-</i></font>a<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>b<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>c<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>d<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-639"></a>  fromInteger n <font color=Red>=</font> Omega <font color=Magenta>0</font> <font color=Magenta>0</font> <font color=Magenta>0</font> n' <font color=Green><u>where</u></font>
<a name="line-640"></a>    n' <font color=Red>=</font> fromInteger n
<a name="line-641"></a>  abs x <font color=Red>=</font> x
<a name="line-642"></a>  signum x <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-643"></a>
<a name="line-644"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>HalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> HalfRing <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-645"></a>  half <font color=Red>=</font> Omega <font color=Magenta>0</font> <font color=Magenta>0</font> <font color=Magenta>0</font> half
<a name="line-646"></a>
<a name="line-647"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>HalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootHalfRing <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-648"></a>  roothalf <font color=Red>=</font> Omega <font color=Cyan>(</font><font color=Blue><i>-</i></font>half<font color=Cyan>)</font> <font color=Magenta>0</font> half <font color=Magenta>0</font>
<a name="line-649"></a>
<a name="line-650"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RootTwoRing <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-651"></a>  roottwo <font color=Red>=</font> Omega <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font> <font color=Magenta>0</font> <font color=Magenta>1</font> <font color=Magenta>0</font>
<a name="line-652"></a>
<a name="line-653"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ComplexRing <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-654"></a>  i <font color=Red>=</font> Omega <font color=Magenta>0</font> <font color=Magenta>1</font> <font color=Magenta>0</font> <font color=Magenta>0</font>
<a name="line-655"></a>
<a name="line-656"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Adjoint a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-657"></a>  adj <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> Omega <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Cyan>(</font>adj c<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Cyan>(</font>adj b<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Cyan>(</font>adj a<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>(</font>adj d<font color=Cyan>)</font>
<a name="line-658"></a>
<a name="line-659"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Adjoint2 a<font color=Cyan>,</font> Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Adjoint2 <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-660"></a>  adj2 <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> Omega <font color=Cyan>(</font><font color=Blue><i>-</i></font>adj2 a<font color=Cyan>)</font> <font color=Cyan>(</font>adj2 b<font color=Cyan>)</font> <font color=Cyan>(</font><font color=Blue><i>-</i></font>adj2 c<font color=Cyan>)</font> <font color=Cyan>(</font>adj2 d<font color=Cyan>)</font>
<a name="line-661"></a>
<a name="line-662"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>NormedRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> NormedRing <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-663"></a>  norm <font color=Cyan>(</font>Omega x y z w<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>a<font color=Cyan>^</font><font color=Magenta>2</font><font color=Cyan>+</font>b<font color=Cyan>^</font><font color=Magenta>2</font><font color=Cyan>+</font>c<font color=Cyan>^</font><font color=Magenta>2</font><font color=Cyan>+</font>d<font color=Cyan>^</font><font color=Magenta>2</font><font color=Cyan>)</font><font color=Cyan>^</font><font color=Magenta>2</font><font color=Blue><i>-</i></font><font color=Magenta>2</font><font color=Cyan>*</font><font color=Cyan>(</font>a<font color=Cyan>*</font>b<font color=Cyan>+</font>b<font color=Cyan>*</font>c<font color=Cyan>+</font>c<font color=Cyan>*</font>d<font color=Blue><i>-</i></font>d<font color=Cyan>*</font>a<font color=Cyan>)</font><font color=Cyan>^</font><font color=Magenta>2</font>
<a name="line-664"></a>    <font color=Green><u>where</u></font>
<a name="line-665"></a>      a <font color=Red>=</font> norm x
<a name="line-666"></a>      b <font color=Red>=</font> norm y
<a name="line-667"></a>      c <font color=Red>=</font> norm z
<a name="line-668"></a>      d <font color=Red>=</font> norm w
<a name="line-669"></a>
<a name="line-670"></a><font color=Blue><i>-- This is an undecidable instance, but is not overlapping. Note: we</i></font>
<a name="line-671"></a><font color=Blue><i>-- do not declare OmegaRing (Omega a), because this usually follows</i></font>
<a name="line-672"></a><font color=Blue><i>-- from (ComplexRing a, RootHalfRing a). But there are some</i></font>
<a name="line-673"></a><font color=Blue><i>-- exceptions, such as OmegaRing (Omega Z2) and OmegaRing (Omega</i></font>
<a name="line-674"></a><font color=Blue><i>-- Integer).</i></font>
<a name="line-675"></a><font color=Green><u>instance</u></font> OmegaRing <font color=Cyan>(</font>Omega Z2<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-676"></a>  omega <font color=Red>=</font> Omega <font color=Magenta>0</font> <font color=Magenta>0</font> <font color=Magenta>1</font> <font color=Magenta>0</font>
<a name="line-677"></a>
<a name="line-678"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-679"></a><font color=Blue><i>-- ** The ring &#8484;[&#969;]</i></font>
<a name="line-680"></a>
<a name="line-681"></a><a name="ZOmega"></a><font color=Blue><i>-- | The ring &#8484;[&#969;] of /cyclotomic integers/ of degree 8. Such rings</i></font>
<a name="line-682"></a><a name="ZOmega"></a><font color=Blue><i>-- were first studied by Kummer around 1840, and used in his proof of</i></font>
<a name="line-683"></a><a name="ZOmega"></a><font color=Blue><i>-- special cases of Fermat's Last Theorem.  See also:</i></font>
<a name="line-684"></a><a name="ZOmega"></a><font color=Blue><i>-- </i></font>
<a name="line-685"></a><a name="ZOmega"></a><font color=Blue><i>-- * &lt;<a href="http://fermatslasttheorem.blogspot.com/2006/05/basic-properties-of-cyclotomic.html">http://fermatslasttheorem.blogspot.com/2006/05/basic-properties-of-cyclotomic.html</a>&gt;</i></font>
<a name="line-686"></a><a name="ZOmega"></a><font color=Blue><i>-- </i></font>
<a name="line-687"></a><a name="ZOmega"></a><font color=Blue><i>-- * &lt;<a href="http://fermatslasttheorem.blogspot.com/2006/02/cyclotomic-integers.html">http://fermatslasttheorem.blogspot.com/2006/02/cyclotomic-integers.html</a>&gt;</i></font>
<a name="line-688"></a><a name="ZOmega"></a><font color=Blue><i>-- </i></font>
<a name="line-689"></a><a name="ZOmega"></a><font color=Blue><i>-- * Harold M. Edwards, \"Fermat's Last Theorem: A Genetic</i></font>
<a name="line-690"></a><a name="ZOmega"></a><font color=Blue><i>-- Introduction to Algebraic Number Theory\"</i></font>
<a name="line-691"></a><a name="ZOmega"></a><font color=Green><u>type</u></font> ZOmega <font color=Red>=</font> Omega Integer
<a name="line-692"></a>
<a name="line-693"></a><a name="fromZOmega"></a><font color=Blue><i>-- | The unique ring homomorphism from &#8484;[&#969;] to any ring containing</i></font>
<a name="line-694"></a><font color=Blue><i>-- &#969;. This exists because &#8484;[&#969;] is the free such ring.</i></font>
<a name="line-695"></a><font color=Blue>fromZOmega</font> <font color=Red>::</font> <font color=Cyan>(</font>OmegaRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ZOmega <font color=Red>-&gt;</font> a
<a name="line-696"></a><font color=Blue>fromZOmega</font> <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> fromInteger a <font color=Cyan>*</font> omega<font color=Cyan>^</font><font color=Magenta>3</font> <font color=Cyan>+</font> fromInteger b <font color=Cyan>*</font> omega<font color=Cyan>^</font><font color=Magenta>2</font> <font color=Cyan>+</font> fromInteger c <font color=Cyan>*</font> omega <font color=Cyan>+</font> fromInteger d
<a name="line-697"></a>
<a name="line-698"></a><font color=Blue><i>-- This is an undecidable instance, but is not overlapping.</i></font>
<a name="line-699"></a><font color=Green><u>instance</u></font> OmegaRing ZOmega <font color=Green><u>where</u></font>
<a name="line-700"></a>  omega <font color=Red>=</font> Omega <font color=Magenta>0</font> <font color=Magenta>0</font> <font color=Magenta>1</font> <font color=Magenta>0</font>
<a name="line-701"></a>
<a name="line-702"></a><a name="dinteger_of_zomega"></a><font color=Blue><i>-- | Inverse of the embedding &#8484;[&#8730;2] &#8594; &#8484;[&#969;]. Note that &#8484;[&#8730;2] = &#8484;[&#969;] &#8745;</i></font>
<a name="line-703"></a><font color=Blue><i>-- &#8477;. This function takes an element of &#8484;[&#969;] that is real, and</i></font>
<a name="line-704"></a><font color=Blue><i>-- converts it to an element of &#8484;[&#8730;2]. It throws an error if the input</i></font>
<a name="line-705"></a><font color=Blue><i>-- is not real.</i></font>
<a name="line-706"></a><font color=Blue>dinteger_of_zomega</font> <font color=Red>::</font> ZOmega <font color=Red>-&gt;</font> DInteger
<a name="line-707"></a><font color=Blue>dinteger_of_zomega</font> <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font>
<a name="line-708"></a>  <font color=Red>|</font> a <font color=Cyan>==</font> <font color=Blue><i>-</i></font>c <font color=Cyan>&amp;&amp;</font> b <font color=Cyan>==</font> <font color=Magenta>0</font>  <font color=Red>=</font> RootTwo d c
<a name="line-709"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> error <font color=Magenta>"dinteger_of_zomega: non-real value"</font>
<a name="line-710"></a>  
<a name="line-711"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-712"></a><font color=Blue><i>-- ** The ring [bold D][&#969;]</i></font>
<a name="line-713"></a>
<a name="line-714"></a><a name="DOmega"></a><font color=Blue><i>-- | The ring [bold D][&#969;]. Here [bold D]=&#8484;[&#189;] is the ring of dyadic</i></font>
<a name="line-715"></a><a name="DOmega"></a><font color=Blue><i>-- fractions. In fact, [bold D][&#969;] is isomorphic to the ring &#8484;[1\/&#8730;2,</i></font>
<a name="line-716"></a><a name="DOmega"></a><font color=Blue><i>-- i], but they have different 'Show' instances.</i></font>
<a name="line-717"></a><a name="DOmega"></a><font color=Green><u>type</u></font> DOmega <font color=Red>=</font> Omega Dyadic
<a name="line-718"></a>
<a name="line-719"></a><a name="fromDOmega"></a><font color=Blue><i>-- | The unique ring homomorphism from [bold D][&#969;] to any ring containing</i></font>
<a name="line-720"></a><font color=Blue><i>-- 1\/&#8730;2 and /i/. This exists because [bold D][&#969;] is the free such ring.</i></font>
<a name="line-721"></a><font color=Blue>fromDOmega</font> <font color=Red>::</font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>,</font> ComplexRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> DOmega <font color=Red>-&gt;</font> a
<a name="line-722"></a><font color=Blue>fromDOmega</font> <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> fromDyadic a <font color=Cyan>*</font> omega<font color=Cyan>^</font><font color=Magenta>3</font> <font color=Cyan>+</font> fromDyadic b <font color=Cyan>*</font> omega<font color=Cyan>^</font><font color=Magenta>2</font> <font color=Cyan>+</font> fromDyadic c <font color=Cyan>*</font> omega <font color=Cyan>+</font> fromDyadic d
<a name="line-723"></a>
<a name="line-724"></a><font color=Blue><i>-- This is an overlapping instance. It is nicer to show an element of</i></font>
<a name="line-725"></a><font color=Blue><i>-- D[&#969;] by pulling out a common denominator exponent. But in cases</i></font>
<a name="line-726"></a><font color=Blue><i>-- where the typechecker cannot infer this, then it will just fall</i></font>
<a name="line-727"></a><font color=Blue><i>-- back to the more general method.</i></font>
<a name="line-728"></a><font color=Green><u>instance</u></font> Show DOmega <font color=Green><u>where</u></font>
<a name="line-729"></a>  showsPrec <font color=Red>=</font> showsPrec_DenomExp
<a name="line-730"></a>  
<a name="line-731"></a><font color=Blue><i>-- This is an overlapping instance. See previous comment.</i></font>
<a name="line-732"></a><font color=Green><u>instance</u></font> Show DComplex <font color=Green><u>where</u></font>
<a name="line-733"></a>  showsPrec <font color=Red>=</font> showsPrec_DenomExp
<a name="line-734"></a>
<a name="line-735"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-736"></a><font color=Blue><i>-- ** The field &#8474;[&#969;]</i></font>
<a name="line-737"></a>
<a name="line-738"></a><a name="QOmega"></a><font color=Blue><i>-- | The field &#8474;[&#969;] of /cyclotomic rationals/ of degree 8.</i></font>
<a name="line-739"></a><a name="QOmega"></a><font color=Green><u>type</u></font> QOmega <font color=Red>=</font> Omega Rationals
<a name="line-740"></a>
<a name="line-741"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-742"></a><font color=Blue><i>-- * Conversion to dyadic</i></font>
<a name="line-743"></a>
<a name="line-744"></a><font color=Blue><i>-- | A type class relating \"rational\" types to their dyadic</i></font>
<a name="line-745"></a><font color=Blue><i>-- counterparts.</i></font>
<a name="line-746"></a><font color=Green><u>class</u></font> ToDyadic a b <font color=Red>|</font> a <font color=Red>-&gt;</font> b <font color=Green><u>where</u></font>
<a name="line-747"></a>  <font color=Blue><i>-- | Convert a \"rational\" value to a \"dyadic\" value, if the</i></font>
<a name="line-748"></a>  <font color=Blue><i>-- denominator is a power of 2. Otherwise, return 'Nothing'.</i></font>
<a name="line-749"></a>  maybe_dyadic <font color=Red>::</font> a <font color=Red>-&gt;</font> Maybe b
<a name="line-750"></a>
<a name="line-751"></a><a name="to_dyadic"></a><font color=Blue><i>-- | Convert a \"rational\" value to a \"dyadic\" value, if the</i></font>
<a name="line-752"></a><font color=Blue><i>-- denominator is a power of 2. Otherwise, throw an error.</i></font>
<a name="line-753"></a><font color=Blue>to_dyadic</font> <font color=Red>::</font> <font color=Cyan>(</font>ToDyadic a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> b
<a name="line-754"></a><font color=Blue>to_dyadic</font> a <font color=Red>=</font> <font color=Green><u>case</u></font> maybe_dyadic a <font color=Green><u>of</u></font>
<a name="line-755"></a>  Just b <font color=Red>-&gt;</font> b
<a name="line-756"></a>  Nothing <font color=Red>-&gt;</font> error <font color=Magenta>"to_dyadic: denominator not a power of 2"</font>
<a name="line-757"></a>
<a name="line-758"></a><font color=Green><u>instance</u></font> ToDyadic Dyadic Dyadic <font color=Green><u>where</u></font>
<a name="line-759"></a>  maybe_dyadic <font color=Red>=</font> return
<a name="line-760"></a>
<a name="line-761"></a><font color=Green><u>instance</u></font> ToDyadic Rational Dyadic <font color=Green><u>where</u></font>
<a name="line-762"></a>  maybe_dyadic x <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-763"></a>    k <font color=Red>&lt;-</font> log2 denom
<a name="line-764"></a>    return <font color=Cyan>(</font>Dyadic numer k<font color=Cyan>)</font>
<a name="line-765"></a>    <font color=Green><u>where</u></font> denom <font color=Red>=</font> denominator x
<a name="line-766"></a>          numer <font color=Red>=</font> numerator x
<a name="line-767"></a>
<a name="line-768"></a><font color=Green><u>instance</u></font> ToDyadic Rationals Dyadic <font color=Green><u>where</u></font>
<a name="line-769"></a>  maybe_dyadic <font color=Red>=</font> maybe_dyadic <font color=Cyan>.</font> unRationals
<a name="line-770"></a>
<a name="line-771"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToDyadic a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToDyadic <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Cyan>(</font>RootTwo b<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-772"></a>  maybe_dyadic <font color=Cyan>(</font>RootTwo x y<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-773"></a>    x' <font color=Red>&lt;-</font> maybe_dyadic x
<a name="line-774"></a>    y' <font color=Red>&lt;-</font> maybe_dyadic y
<a name="line-775"></a>    return <font color=Cyan>(</font>RootTwo x' y'<font color=Cyan>)</font>
<a name="line-776"></a>
<a name="line-777"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToDyadic a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToDyadic <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Cyan>(</font>Cplx b<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-778"></a>  maybe_dyadic <font color=Cyan>(</font>Cplx x y<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-779"></a>    x' <font color=Red>&lt;-</font> maybe_dyadic x
<a name="line-780"></a>    y' <font color=Red>&lt;-</font> maybe_dyadic y
<a name="line-781"></a>    return <font color=Cyan>(</font>Cplx x' y'<font color=Cyan>)</font>
<a name="line-782"></a>
<a name="line-783"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToDyadic a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToDyadic <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Cyan>(</font>Omega b<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-784"></a>  maybe_dyadic <font color=Cyan>(</font>Omega x y z w<font color=Cyan>)</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-785"></a>    x' <font color=Red>&lt;-</font> maybe_dyadic x
<a name="line-786"></a>    y' <font color=Red>&lt;-</font> maybe_dyadic y
<a name="line-787"></a>    z' <font color=Red>&lt;-</font> maybe_dyadic z
<a name="line-788"></a>    w' <font color=Red>&lt;-</font> maybe_dyadic w
<a name="line-789"></a>    return <font color=Cyan>(</font>Omega x' y' z' w'<font color=Cyan>)</font>
<a name="line-790"></a>
<a name="line-791"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-792"></a><font color=Blue><i>-- * Real part</i></font>
<a name="line-793"></a>    
<a name="line-794"></a><a name="RealPart"></a><font color=Blue><i>-- | A type class for rings that have a \"real\" component. A typical</i></font>
<a name="line-795"></a><a name="RealPart"></a><font color=Blue><i>-- instance is /a/ = 'DComplex' with /b/ = 'DReal'.</i></font>
<a name="line-796"></a><a name="RealPart"></a><font color=Green><u>class</u></font> RealPart a b <font color=Red>|</font> a <font color=Red>-&gt;</font> b <font color=Green><u>where</u></font>
<a name="line-797"></a>  <font color=Blue><i>-- | Take the real part.</i></font>
<a name="line-798"></a>  real <font color=Red>::</font> a <font color=Red>-&gt;</font> b
<a name="line-799"></a>
<a name="line-800"></a><font color=Green><u>instance</u></font> RealPart <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> a <font color=Green><u>where</u></font>
<a name="line-801"></a>  real <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> a
<a name="line-802"></a>
<a name="line-803"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>HalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> RealPart <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-804"></a>  real <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> RootTwo d <font color=Cyan>(</font>half <font color=Cyan>*</font> <font color=Cyan>(</font>c <font color=Blue><i>-</i></font> a<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-805"></a>
<a name="line-806"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-807"></a><font color=Blue><i>-- * Rings of integers</i></font>
<a name="line-808"></a>  
<a name="line-809"></a><a name="WholePart"></a><font color=Blue><i>-- | A type class for rings that have a distinguished subring \"of</i></font>
<a name="line-810"></a><a name="WholePart"></a><font color=Blue><i>-- integers\". A typical instance is /a/ = 'DReal', which has /b/ =</i></font>
<a name="line-811"></a><a name="WholePart"></a><font color=Blue><i>-- 'DInteger' as its ring of integers.</i></font>
<a name="line-812"></a><a name="WholePart"></a><font color=Green><u>class</u></font> WholePart a b <font color=Red>|</font> a <font color=Red>-&gt;</font> b <font color=Green><u>where</u></font>  
<a name="line-813"></a>  <font color=Blue><i>-- | The embedding of the ring of integers into the larger ring.</i></font>
<a name="line-814"></a>  from_whole <font color=Red>::</font> b <font color=Red>-&gt;</font> a
<a name="line-815"></a>  <font color=Blue><i>-- | The inverse of 'from_whole'. Throws an error if the given</i></font>
<a name="line-816"></a>  <font color=Blue><i>-- element is not actually an integer in the ring.</i></font>
<a name="line-817"></a>  to_whole <font color=Red>::</font> a <font color=Red>-&gt;</font> b
<a name="line-818"></a>  
<a name="line-819"></a><font color=Green><u>instance</u></font> WholePart Dyadic Integer <font color=Green><u>where</u></font>
<a name="line-820"></a>  from_whole <font color=Red>=</font> fromInteger
<a name="line-821"></a>  to_whole d 
<a name="line-822"></a>    <font color=Red>|</font> n <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> a
<a name="line-823"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font> error <font color=Magenta>"to_whole: non-integral value"</font>
<a name="line-824"></a>    <font color=Green><u>where</u></font>
<a name="line-825"></a>      <font color=Cyan>(</font>a<font color=Cyan>,</font>n<font color=Cyan>)</font> <font color=Red>=</font> decompose_dyadic d
<a name="line-826"></a>
<a name="line-827"></a><font color=Green><u>instance</u></font> WholePart DReal DInteger <font color=Green><u>where</u></font>
<a name="line-828"></a>  from_whole <font color=Red>=</font> fromDInteger
<a name="line-829"></a>  to_whole <font color=Cyan>(</font>RootTwo x y<font color=Cyan>)</font> <font color=Red>=</font> RootTwo <font color=Cyan>(</font>to_whole x<font color=Cyan>)</font> <font color=Cyan>(</font>to_whole y<font color=Cyan>)</font>
<a name="line-830"></a>  
<a name="line-831"></a><font color=Green><u>instance</u></font> WholePart DOmega ZOmega <font color=Green><u>where</u></font>
<a name="line-832"></a>  from_whole <font color=Red>=</font> fromZOmega
<a name="line-833"></a>  to_whole <font color=Cyan>(</font>Omega x y z w<font color=Cyan>)</font> <font color=Red>=</font> Omega <font color=Cyan>(</font>to_whole x<font color=Cyan>)</font> <font color=Cyan>(</font>to_whole y<font color=Cyan>)</font> <font color=Cyan>(</font>to_whole z<font color=Cyan>)</font> <font color=Cyan>(</font>to_whole w<font color=Cyan>)</font>
<a name="line-834"></a>  
<a name="line-835"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>WholePart a a'<font color=Cyan>,</font> WholePart b b'<font color=Cyan>)</font> <font color=Red>=&gt;</font> WholePart <font color=Cyan>(</font>a<font color=Cyan>,</font>b<font color=Cyan>)</font> <font color=Cyan>(</font>a'<font color=Cyan>,</font>b'<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-836"></a>  from_whole <font color=Cyan>(</font>x<font color=Cyan>,</font>y<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>from_whole x<font color=Cyan>,</font> from_whole y<font color=Cyan>)</font>
<a name="line-837"></a>  to_whole <font color=Cyan>(</font>x<font color=Cyan>,</font>y<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>to_whole x<font color=Cyan>,</font> to_whole y<font color=Cyan>)</font>
<a name="line-838"></a>  
<a name="line-839"></a><font color=Green><u>instance</u></font> WholePart () () <font color=Green><u>where</u></font>  
<a name="line-840"></a>  from_whole <font color=Red>=</font> const ()
<a name="line-841"></a>  to_whole <font color=Red>=</font> const ()
<a name="line-842"></a>  
<a name="line-843"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>WholePart a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> WholePart <font color=Red>[</font>a<font color=Red>]</font> <font color=Red>[</font>b<font color=Red>]</font> <font color=Green><u>where</u></font>  
<a name="line-844"></a>  from_whole <font color=Red>=</font> map from_whole
<a name="line-845"></a>  to_whole <font color=Red>=</font> map to_whole
<a name="line-846"></a>  
<a name="line-847"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>WholePart a b<font color=Cyan>)</font> <font color=Red>=&gt;</font> WholePart <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Cyan>(</font>Cplx b<font color=Cyan>)</font> <font color=Green><u>where</u></font>  
<a name="line-848"></a>  from_whole <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> Cplx <font color=Cyan>(</font>from_whole a<font color=Cyan>)</font> <font color=Cyan>(</font>from_whole b<font color=Cyan>)</font>
<a name="line-849"></a>  to_whole <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> Cplx <font color=Cyan>(</font>to_whole a<font color=Cyan>)</font> <font color=Cyan>(</font>to_whole b<font color=Cyan>)</font>
<a name="line-850"></a>  
<a name="line-851"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-852"></a><font color=Blue><i>-- * Common denominators</i></font>
<a name="line-853"></a>  
<a name="line-854"></a><font color=Blue><i>-- | A type class for things from which a common power of 1\/&#8730;2 (a</i></font>
<a name="line-855"></a><font color=Blue><i>-- least denominator exponent) can be factored out. Typical instances</i></font>
<a name="line-856"></a><font color=Blue><i>-- are 'DReal', 'DComplex', as well as tuples, lists, vectors, and</i></font>
<a name="line-857"></a><font color=Blue><i>-- matrices thereof.</i></font>
<a name="line-858"></a><font color=Green><u>class</u></font> DenomExp a <font color=Green><u>where</u></font>
<a name="line-859"></a>  <font color=Blue><i>-- | Calculate the least denominator exponent /k/ of /a/. Returns</i></font>
<a name="line-860"></a>  <font color=Blue><i>-- the smallest /k/&#8805;0 such that /a/ = /b/\/&#8730;2[sup /k/] for some</i></font>
<a name="line-861"></a>  <font color=Blue><i>-- integral /b/.</i></font>
<a name="line-862"></a>  denomexp <font color=Red>::</font> a <font color=Red>-&gt;</font> Integer
<a name="line-863"></a>  
<a name="line-864"></a>  <font color=Blue><i>-- | Factor out a /k/th power of 1\/&#8730;2 from /a/. In other words,</i></font>
<a name="line-865"></a>  <font color=Blue><i>-- calculate /a/&#8730;2[sup /k/].</i></font>
<a name="line-866"></a>  denomexp_factor <font color=Red>::</font> a <font color=Red>-&gt;</font> Integer <font color=Red>-&gt;</font> a
<a name="line-867"></a>
<a name="line-868"></a><a name="denomexp_decompose"></a><font color=Blue><i>-- | Calculate and factor out the least denominator exponent /k/ of</i></font>
<a name="line-869"></a><font color=Blue><i>-- /a/. Return (/b/,/k/), where /a/ = /b/\/(&#8730;2)[sup /k/] and /k/&#8805;0.</i></font>
<a name="line-870"></a><font color=Blue>denomexp_decompose</font> <font color=Red>::</font> <font color=Cyan>(</font>WholePart a b<font color=Cyan>,</font> DenomExp a<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> <font color=Cyan>(</font>b<font color=Cyan>,</font> Integer<font color=Cyan>)</font>
<a name="line-871"></a><font color=Blue>denomexp_decompose</font> a <font color=Red>=</font> <font color=Cyan>(</font>b<font color=Cyan>,</font> k<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-872"></a>  k <font color=Red>=</font> denomexp a
<a name="line-873"></a>  b <font color=Red>=</font> to_whole <font color=Cyan>(</font>denomexp_factor a k<font color=Cyan>)</font>
<a name="line-874"></a>
<a name="line-875"></a><a name="showsPrec_DenomExp"></a><font color=Blue><i>-- | Generic 'show'-like method that factors out a common denominator</i></font>
<a name="line-876"></a><font color=Blue><i>-- exponent.</i></font>
<a name="line-877"></a><font color=Blue>showsPrec_DenomExp</font> <font color=Red>::</font> <font color=Cyan>(</font>WholePart a b<font color=Cyan>,</font> Show b<font color=Cyan>,</font> DenomExp a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Int <font color=Red>-&gt;</font> a <font color=Red>-&gt;</font> ShowS
<a name="line-878"></a><font color=Blue>showsPrec_DenomExp</font> d a 
<a name="line-879"></a>  <font color=Red>|</font> k <font color=Cyan>==</font> <font color=Magenta>0</font> <font color=Red>=</font> showsPrec d b
<a name="line-880"></a>  <font color=Red>|</font> k <font color=Cyan>==</font> <font color=Magenta>1</font> <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>7</font><font color=Cyan>)</font> <font color=Cyan>$</font> 
<a name="line-881"></a>             showString <font color=Magenta>"1/&#8730;2 "</font> <font color=Cyan>.</font> showsPrec <font color=Magenta>7</font> b
<a name="line-882"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> showParen <font color=Cyan>(</font>d <font color=Cyan>&gt;</font> <font color=Magenta>7</font><font color=Cyan>)</font> <font color=Cyan>$</font>
<a name="line-883"></a>                showString <font color=Cyan>(</font><font color=Magenta>"1/&#8730;2^"</font> <font color=Cyan>++</font> show k <font color=Cyan>++</font> <font color=Magenta>" "</font><font color=Cyan>)</font> <font color=Cyan>.</font> showsPrec <font color=Magenta>7</font> b
<a name="line-884"></a>  <font color=Green><u>where</u></font> <font color=Cyan>(</font>b<font color=Cyan>,</font> k<font color=Cyan>)</font> <font color=Red>=</font> denomexp_decompose a
<a name="line-885"></a>
<a name="line-886"></a><font color=Green><u>instance</u></font> DenomExp DReal <font color=Green><u>where</u></font>
<a name="line-887"></a>  denomexp <font color=Cyan>(</font>RootTwo x y<font color=Cyan>)</font> <font color=Red>=</font> k'
<a name="line-888"></a>    <font color=Green><u>where</u></font>
<a name="line-889"></a>      <font color=Cyan>(</font>a<font color=Cyan>,</font>k<font color=Cyan>)</font> <font color=Red>=</font> decompose_dyadic x
<a name="line-890"></a>      <font color=Cyan>(</font>b<font color=Cyan>,</font>l<font color=Cyan>)</font> <font color=Red>=</font> decompose_dyadic y
<a name="line-891"></a>      k' <font color=Red>=</font> maximum <font color=Red>[</font><font color=Magenta>2</font><font color=Cyan>*</font>k<font color=Cyan>,</font> <font color=Magenta>2</font><font color=Cyan>*</font>l<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Red>]</font>
<a name="line-892"></a>  denomexp_factor a k <font color=Red>=</font> a <font color=Cyan>*</font> roottwo<font color=Cyan>^</font>k
<a name="line-893"></a>
<a name="line-894"></a><font color=Green><u>instance</u></font> DenomExp DOmega <font color=Green><u>where</u></font>
<a name="line-895"></a>  denomexp <font color=Cyan>(</font>Omega x y z w<font color=Cyan>)</font> <font color=Red>=</font> k'
<a name="line-896"></a>      <font color=Green><u>where</u></font>
<a name="line-897"></a>        <font color=Cyan>(</font>a<font color=Cyan>,</font>ak<font color=Cyan>)</font> <font color=Red>=</font> decompose_dyadic x
<a name="line-898"></a>        <font color=Cyan>(</font>b<font color=Cyan>,</font>bk<font color=Cyan>)</font> <font color=Red>=</font> decompose_dyadic y
<a name="line-899"></a>        <font color=Cyan>(</font>c<font color=Cyan>,</font>ck<font color=Cyan>)</font> <font color=Red>=</font> decompose_dyadic z
<a name="line-900"></a>        <font color=Cyan>(</font>d<font color=Cyan>,</font>dk<font color=Cyan>)</font> <font color=Red>=</font> decompose_dyadic w
<a name="line-901"></a>        k <font color=Red>=</font> maximum <font color=Red>[</font>ak<font color=Cyan>,</font> bk<font color=Cyan>,</font> ck<font color=Cyan>,</font> dk<font color=Red>]</font>
<a name="line-902"></a>        a' <font color=Red>=</font> <font color=Green><u>if</u></font> k <font color=Cyan>==</font> ak <font color=Green><u>then</u></font> a <font color=Green><u>else</u></font> <font color=Magenta>0</font>
<a name="line-903"></a>        b' <font color=Red>=</font> <font color=Green><u>if</u></font> k <font color=Cyan>==</font> bk <font color=Green><u>then</u></font> b <font color=Green><u>else</u></font> <font color=Magenta>0</font>
<a name="line-904"></a>        c' <font color=Red>=</font> <font color=Green><u>if</u></font> k <font color=Cyan>==</font> ck <font color=Green><u>then</u></font> c <font color=Green><u>else</u></font> <font color=Magenta>0</font>
<a name="line-905"></a>        d' <font color=Red>=</font> <font color=Green><u>if</u></font> k <font color=Cyan>==</font> dk <font color=Green><u>then</u></font> d <font color=Green><u>else</u></font> <font color=Magenta>0</font>
<a name="line-906"></a>        k' <font color=Red>|</font> k<font color=Cyan>&gt;</font><font color=Magenta>0</font> <font color=Cyan>&amp;&amp;</font> even <font color=Cyan>(</font>a'<font color=Blue><i>-</i></font>c'<font color=Cyan>)</font> <font color=Cyan>&amp;&amp;</font> even <font color=Cyan>(</font>b'<font color=Blue><i>-</i></font>d'<font color=Cyan>)</font> <font color=Red>=</font> <font color=Magenta>2</font><font color=Cyan>*</font>k<font color=Blue><i>-</i></font><font color=Magenta>1</font>
<a name="line-907"></a>           <font color=Red>|</font> otherwise <font color=Red>=</font> <font color=Magenta>2</font><font color=Cyan>*</font>k
<a name="line-908"></a>  denomexp_factor a k <font color=Red>=</font> a <font color=Cyan>*</font> roottwo<font color=Cyan>^</font>k
<a name="line-909"></a>        
<a name="line-910"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>DenomExp a<font color=Cyan>,</font> DenomExp b<font color=Cyan>)</font> <font color=Red>=&gt;</font> DenomExp <font color=Cyan>(</font>a<font color=Cyan>,</font>b<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-911"></a>  denomexp <font color=Cyan>(</font>a<font color=Cyan>,</font>b<font color=Cyan>)</font> <font color=Red>=</font> denomexp a <font color=Cyan>`max`</font> denomexp b
<a name="line-912"></a>  denomexp_factor <font color=Cyan>(</font>a<font color=Cyan>,</font>b<font color=Cyan>)</font> k <font color=Red>=</font> <font color=Cyan>(</font>denomexp_factor a k<font color=Cyan>,</font> denomexp_factor b k<font color=Cyan>)</font>
<a name="line-913"></a>
<a name="line-914"></a><font color=Green><u>instance</u></font> DenomExp () <font color=Green><u>where</u></font>
<a name="line-915"></a>  denomexp <font color=Green><u>_</u></font> <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-916"></a>  denomexp_factor <font color=Green><u>_</u></font> k <font color=Red>=</font> ()
<a name="line-917"></a>
<a name="line-918"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>DenomExp a<font color=Cyan>)</font> <font color=Red>=&gt;</font> DenomExp <font color=Red>[</font>a<font color=Red>]</font> <font color=Green><u>where</u></font>
<a name="line-919"></a>  denomexp <font color=Green><u>as</u></font> <font color=Red>=</font> maximum <font color=Cyan>(</font><font color=Magenta>0</font> <font color=Red><b>:</b></font> <font color=Red>[</font> denomexp a <font color=Red>|</font> a <font color=Red>&lt;-</font> <font color=Green><u>as</u></font> <font color=Red>]</font><font color=Cyan>)</font>
<a name="line-920"></a>  denomexp_factor <font color=Green><u>as</u></font> k <font color=Red>=</font> <font color=Red>[</font> denomexp_factor a k <font color=Red>|</font> a <font color=Red>&lt;-</font> <font color=Green><u>as</u></font> <font color=Red>]</font>
<a name="line-921"></a>
<a name="line-922"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>DenomExp a<font color=Cyan>)</font> <font color=Red>=&gt;</font> DenomExp <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-923"></a>  denomexp <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> denomexp a <font color=Cyan>`max`</font> denomexp b
<a name="line-924"></a>  denomexp_factor <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> k <font color=Red>=</font> Cplx <font color=Cyan>(</font>denomexp_factor a k<font color=Cyan>)</font> <font color=Cyan>(</font>denomexp_factor b k<font color=Cyan>)</font>
<a name="line-925"></a>
<a name="line-926"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-927"></a><font color=Blue><i>-- * Conversion to EComplex</i></font>
<a name="line-928"></a>
<a name="line-929"></a><font color=Blue><i>-- $ 'EComplex' is the largest one of our \"exact\" arithmetic</i></font>
<a name="line-930"></a><font color=Blue><i>-- types. We define a 'toEComplex' family of functions for converting</i></font>
<a name="line-931"></a><font color=Blue><i>-- just about anything to an 'EComplex'.</i></font>
<a name="line-932"></a>
<a name="line-933"></a><a name="ToEComplex"></a><font color=Blue><i>-- | A type class for things that can be exactly converted to</i></font>
<a name="line-934"></a><a name="ToEComplex"></a><font color=Blue><i>-- 'EComplex'.</i></font>
<a name="line-935"></a><a name="ToEComplex"></a><font color=Green><u>class</u></font> ToEComplex a <font color=Green><u>where</u></font>
<a name="line-936"></a>  <font color=Blue><i>-- | Conversion to 'EComplex'.</i></font>
<a name="line-937"></a>  toEComplex <font color=Red>::</font> a <font color=Red>-&gt;</font> EComplex
<a name="line-938"></a>
<a name="line-939"></a><font color=Green><u>instance</u></font> ToEComplex Integer <font color=Green><u>where</u></font>
<a name="line-940"></a>  toEComplex <font color=Red>=</font> fromInteger
<a name="line-941"></a>
<a name="line-942"></a><font color=Green><u>instance</u></font> ToEComplex Rational <font color=Green><u>where</u></font>
<a name="line-943"></a>  toEComplex a <font color=Red>=</font> Cplx <font color=Cyan>(</font>RootTwo <font color=Cyan>(</font>ToRationals a<font color=Cyan>)</font> <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Magenta>0</font>
<a name="line-944"></a>
<a name="line-945"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToEComplex a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToEComplex <font color=Cyan>(</font>RootTwo a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-946"></a>  toEComplex <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font> <font color=Red>=</font> toEComplex a <font color=Cyan>+</font> roottwo <font color=Cyan>*</font> toEComplex b
<a name="line-947"></a>  
<a name="line-948"></a><font color=Green><u>instance</u></font> ToEComplex Dyadic <font color=Green><u>where</u></font>
<a name="line-949"></a>  toEComplex <font color=Cyan>(</font>Dyadic a n<font color=Cyan>)</font>
<a name="line-950"></a>    <font color=Red>|</font> n <font color=Cyan>&gt;=</font> <font color=Magenta>0</font>    <font color=Red>=</font> toEComplex a <font color=Cyan>*</font> half<font color=Cyan>^</font>n
<a name="line-951"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font> toEComplex a <font color=Cyan>*</font> <font color=Magenta>2</font><font color=Cyan>^</font><font color=Cyan>(</font><font color=Blue><i>-</i></font>n<font color=Cyan>)</font>
<a name="line-952"></a>
<a name="line-953"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToEComplex a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToEComplex <font color=Cyan>(</font>Cplx a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-954"></a>  toEComplex <font color=Cyan>(</font>Cplx a b<font color=Cyan>)</font> <font color=Red>=</font> toEComplex a <font color=Cyan>+</font> i <font color=Cyan>*</font> toEComplex b
<a name="line-955"></a>
<a name="line-956"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToEComplex a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToEComplex <font color=Cyan>(</font>Omega a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-957"></a>  toEComplex <font color=Cyan>(</font>Omega a b c d<font color=Cyan>)</font> <font color=Red>=</font> omega<font color=Cyan>^</font><font color=Magenta>3</font> <font color=Cyan>*</font> a' <font color=Cyan>+</font> omega<font color=Cyan>^</font><font color=Magenta>2</font> <font color=Cyan>*</font> b' <font color=Cyan>+</font> omega <font color=Cyan>*</font> c' <font color=Cyan>+</font> d'
<a name="line-958"></a>    <font color=Green><u>where</u></font>
<a name="line-959"></a>      a' <font color=Red>=</font> toEComplex a
<a name="line-960"></a>      b' <font color=Red>=</font> toEComplex b
<a name="line-961"></a>      c' <font color=Red>=</font> toEComplex c
<a name="line-962"></a>      d' <font color=Red>=</font> toEComplex d
<a name="line-963"></a>
<a name="line-964"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-965"></a><font color=Blue><i>-- * Parity</i></font>
<a name="line-966"></a>    
<a name="line-967"></a><a name="Parity"></a><font color=Blue><i>-- | A type class for things that have parity.</i></font>
<a name="line-968"></a><a name="Parity"></a><font color=Green><u>class</u></font> Parity a <font color=Green><u>where</u></font>
<a name="line-969"></a>  <font color=Blue><i>-- | Return the parity of something.</i></font>
<a name="line-970"></a>  parity <font color=Red>::</font> a <font color=Red>-&gt;</font> Z2
<a name="line-971"></a>
<a name="line-972"></a><font color=Green><u>instance</u></font> Integral a <font color=Red>=&gt;</font> Parity a <font color=Green><u>where</u></font>
<a name="line-973"></a>  parity x <font color=Red>=</font> <font color=Green><u>if</u></font> even x <font color=Green><u>then</u></font> <font color=Magenta>0</font> <font color=Green><u>else</u></font> <font color=Magenta>1</font>
<a name="line-974"></a>  
<a name="line-975"></a><font color=Green><u>instance</u></font> Parity DInteger <font color=Green><u>where</u></font>
<a name="line-976"></a>  parity <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font> <font color=Red>=</font> parity a
<a name="line-977"></a>
<a name="line-978"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-979"></a><font color=Blue><i>-- * Auxiliary functions</i></font>
<a name="line-980"></a>
<a name="line-981"></a><a name="lobit"></a><font color=Blue><i>-- | If /n/&#8800;0, return (/a/,/k/) such that /a/ is odd and /n/ =</i></font>
<a name="line-982"></a><font color=Blue><i>-- /a/&#8901;2[sup /k/]. If /n/=0, return (/0/,/0/).</i></font>
<a name="line-983"></a><font color=Blue>lobit</font> <font color=Red>::</font> Integer <font color=Red>-&gt;</font> <font color=Cyan>(</font>Integer<font color=Cyan>,</font> Integer<font color=Cyan>)</font>
<a name="line-984"></a><font color=Blue>lobit</font> <font color=Magenta>0</font> <font color=Red>=</font> <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font><font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-985"></a><font color=Blue>lobit</font> n <font color=Red>=</font> aux n <font color=Magenta>0</font> <font color=Green><u>where</u></font>
<a name="line-986"></a>  aux n <font color=Cyan>!</font>k
<a name="line-987"></a>    <font color=Red>|</font> n <font color=Cyan>.&amp;.</font> <font color=Magenta>0xffffffff</font> <font color=Cyan>==</font> <font color=Magenta>0</font>  <font color=Red>=</font> aux <font color=Cyan>(</font>shiftR n <font color=Magenta>32</font><font color=Cyan>)</font> <font color=Cyan>(</font>k<font color=Cyan>+</font><font color=Magenta>32</font><font color=Cyan>)</font>
<a name="line-988"></a>    <font color=Red>|</font> n <font color=Cyan>.&amp;.</font> <font color=Magenta>0xff</font> <font color=Cyan>==</font> <font color=Magenta>0</font>        <font color=Red>=</font> aux <font color=Cyan>(</font>shiftR n <font color=Magenta>8</font><font color=Cyan>)</font> <font color=Cyan>(</font>k<font color=Cyan>+</font><font color=Magenta>8</font><font color=Cyan>)</font>
<a name="line-989"></a>    <font color=Red>|</font> even n                 <font color=Red>=</font> aux <font color=Cyan>(</font>shiftR n <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Cyan>(</font>k<font color=Cyan>+</font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-990"></a>    <font color=Red>|</font> otherwise              <font color=Red>=</font> <font color=Cyan>(</font>n<font color=Cyan>,</font>k<font color=Cyan>)</font>
<a name="line-991"></a>        
<a name="line-992"></a><a name="log2"></a><font color=Blue><i>-- | If /n/ is of the form 2[sup /k/], return /k/. Otherwise, return</i></font>
<a name="line-993"></a><font color=Blue><i>-- 'Nothing'.</i></font>
<a name="line-994"></a><font color=Blue>log2</font> <font color=Red>::</font> Integer <font color=Red>-&gt;</font> Maybe Integer
<a name="line-995"></a><font color=Blue>log2</font> n
<a name="line-996"></a>  <font color=Red>|</font> a <font color=Cyan>==</font> <font color=Magenta>1</font> <font color=Red>=</font> Just k
<a name="line-997"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> Nothing
<a name="line-998"></a>    <font color=Green><u>where</u></font>
<a name="line-999"></a>      <font color=Cyan>(</font>a<font color=Cyan>,</font>k<font color=Cyan>)</font> <font color=Red>=</font> lobit n
<a name="line-1000"></a>
<a name="line-1001"></a><a name="intsqrt"></a><font color=Blue><i>-- | For /n/ &#8805; 0, return the floor of the square root of /n/. This is</i></font>
<a name="line-1002"></a><font color=Blue><i>-- done using integer arithmetic, so there are no rounding errors.</i></font>
<a name="line-1003"></a><font color=Blue>intsqrt</font> <font color=Red>::</font> <font color=Cyan>(</font>Integral n<font color=Cyan>)</font> <font color=Red>=&gt;</font> n <font color=Red>-&gt;</font> n
<a name="line-1004"></a><font color=Blue>intsqrt</font> n 
<a name="line-1005"></a>  <font color=Red>|</font> n <font color=Cyan>&lt;=</font> <font color=Magenta>0</font> <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-1006"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> iterate <font color=Magenta>1</font> 
<a name="line-1007"></a>    <font color=Green><u>where</u></font>
<a name="line-1008"></a>      iterate m
<a name="line-1009"></a>        <font color=Red>|</font> m_sq <font color=Cyan>&lt;=</font> n <font color=Cyan>&amp;&amp;</font> m_sq <font color=Cyan>+</font> <font color=Magenta>2</font><font color=Cyan>*</font>m <font color=Cyan>+</font> <font color=Magenta>1</font> <font color=Cyan>&gt;</font> n <font color=Red>=</font> m
<a name="line-1010"></a>        <font color=Red>|</font> otherwise <font color=Red>=</font> iterate <font color=Cyan>(</font><font color=Cyan>(</font>m <font color=Cyan>+</font> n <font color=Cyan>`div`</font> m<font color=Cyan>)</font> <font color=Cyan>`div`</font> <font color=Magenta>2</font><font color=Cyan>)</font>
<a name="line-1011"></a>          <font color=Green><u>where</u></font>
<a name="line-1012"></a>            m_sq <font color=Red>=</font> m<font color=Cyan>*</font>m
<a name="line-1013"></a>
</pre>
</body>
</html>