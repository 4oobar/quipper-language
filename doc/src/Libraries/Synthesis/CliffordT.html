<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>{-# LANGUAGE FlexibleInstances #-}</i></font>
<a name="line-2"></a><font color=Blue><i>{-# LANGUAGE UndecidableInstances #-}</i></font>
<a name="line-3"></a><font color=Blue><i>{-# LANGUAGE FlexibleContexts #-}</i></font>
<a name="line-4"></a>
<a name="line-5"></a><font color=Blue><i>-- | This module provides a representation of the single-qubit</i></font>
<a name="line-6"></a><font color=Blue><i>-- Clifford+/T/ operators, Matsumoto-Amano normal forms, and functions</i></font>
<a name="line-7"></a><font color=Blue><i>-- for the exact synthesis of single-qubit Clifford+/T/ operators.</i></font>
<a name="line-8"></a><font color=Blue><i>--</i></font>
<a name="line-9"></a><font color=Blue><i>-- Matsumoto-Amano normal forms and the Matsumoto-Amano exact</i></font>
<a name="line-10"></a><font color=Blue><i>-- synthesis algorithm are described in the paper:</i></font>
<a name="line-11"></a><font color=Blue><i>--</i></font>
<a name="line-12"></a><font color=Blue><i>-- * Ken Matsumoto, Kazuyuki Amano. Representation of Quantum Circuits</i></font>
<a name="line-13"></a><font color=Blue><i>-- with Clifford and &#960;\/8 Gates. &lt;<a href="http://arxiv.org/abs/0806.3834">http://arxiv.org/abs/0806.3834</a>&gt;.</i></font>
<a name="line-14"></a>
<a name="line-15"></a><font color=Green><u>module</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>CliffordT <font color=Green><u>where</u></font>
<a name="line-16"></a>
<a name="line-17"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Ring
<a name="line-18"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Matrix
<a name="line-19"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Clifford
<a name="line-20"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>MultiQubitSynthesis
<a name="line-21"></a>
<a name="line-22"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>List
<a name="line-23"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Bits
<a name="line-24"></a>
<a name="line-25"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-26"></a><font color=Blue><i>-- * Clifford+/T/ interchange format</i></font>
<a name="line-27"></a>
<a name="line-28"></a><font color=Blue><i>-- $ It is convenient to have a simple but exact \"interchange</i></font>
<a name="line-29"></a><font color=Blue><i>-- format\" for operators in the single-qubit Clifford+/T/</i></font>
<a name="line-30"></a><font color=Blue><i>-- group. Different operator representations can be converted to and</i></font>
<a name="line-31"></a><font color=Blue><i>-- from this format.</i></font>
<a name="line-32"></a><font color=Blue><i>--</i></font>
<a name="line-33"></a><font color=Blue><i>-- Our format is simply a list of gates from /X/, /Y/, /Z/, /H/, /S/,</i></font>
<a name="line-34"></a><font color=Blue><i>-- /T/, and /E/ = /H//S/[sup 3]&#969;[sup 3], with the obvious</i></font>
<a name="line-35"></a><font color=Blue><i>-- interpretation as a matrix product. We also include the global</i></font>
<a name="line-36"></a><font color=Blue><i>-- phase gate /W/ = &#969; = [exp /i/&#960;\/4]. The /W/ gate is ignored when</i></font>
<a name="line-37"></a><font color=Blue><i>-- converting to or from representations that cannot represent global</i></font>
<a name="line-38"></a><font color=Blue><i>-- phase (such as the Bloch sphere representation).</i></font>
<a name="line-39"></a>
<a name="line-40"></a><a name="Gate"></a><font color=Blue><i>-- | An enumeration type to represent symbolic basic gates (/X/, /Y/,</i></font>
<a name="line-41"></a><a name="Gate"></a><font color=Blue><i>-- /Z/, /H/, /S/, /T/, /W/, /E/).</i></font>
<a name="line-42"></a><a name="Gate"></a><font color=Blue><i>-- </i></font>
<a name="line-43"></a><a name="Gate"></a><font color=Blue><i>-- Note: when we use a list of 'Gate's to express a sequence of</i></font>
<a name="line-44"></a><a name="Gate"></a><font color=Blue><i>-- operators, the operators are meant to be applied right-to-left,</i></font>
<a name="line-45"></a><a name="Gate"></a><font color=Blue><i>-- i.e., as in the mathematical notation for matrix multiplication.</i></font>
<a name="line-46"></a><a name="Gate"></a><font color=Blue><i>-- This is the opposite of the quantum circuit notation.</i></font>
<a name="line-47"></a><a name="Gate"></a><font color=Green><u>data</u></font> Gate <font color=Red>=</font> X <font color=Red>|</font> Y <font color=Red>|</font> Z <font color=Red>|</font> H <font color=Red>|</font> S <font color=Red>|</font> T <font color=Red>|</font> E <font color=Red>|</font> W
<a name="line-48"></a>          <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Show<font color=Cyan>,</font> Eq<font color=Cyan>)</font>
<a name="line-49"></a>
<a name="line-50"></a><a name="ToGates"></a><font color=Blue><i>-- | A type class for all things that can be exactly converted to a</i></font>
<a name="line-51"></a><a name="ToGates"></a><font color=Blue><i>-- list of gates. These are the exact representations of the</i></font>
<a name="line-52"></a><a name="ToGates"></a><font color=Blue><i>-- single-qubit Clifford+/T/ group.</i></font>
<a name="line-53"></a><a name="ToGates"></a><font color=Green><u>class</u></font> ToGates a <font color=Green><u>where</u></font>
<a name="line-54"></a>  <font color=Blue><i>-- | Convert any suitable thing to a list of gates.</i></font>
<a name="line-55"></a>  to_gates <font color=Red>::</font> a <font color=Red>-&gt;</font> <font color=Red>[</font>Gate<font color=Red>]</font>
<a name="line-56"></a>
<a name="line-57"></a><font color=Green><u>instance</u></font> ToGates Gate <font color=Green><u>where</u></font>
<a name="line-58"></a>  to_gates x <font color=Red>=</font> <font color=Red>[</font>x<font color=Red>]</font>
<a name="line-59"></a>
<a name="line-60"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToGates a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToGates <font color=Red>[</font>a<font color=Red>]</font> <font color=Green><u>where</u></font>
<a name="line-61"></a>  to_gates x <font color=Red>=</font> concat <font color=Red>[</font> to_gates y <font color=Red>|</font> y <font color=Red>&lt;-</font> x <font color=Red>]</font>
<a name="line-62"></a>
<a name="line-63"></a><font color=Green><u>instance</u></font> ToGates Char <font color=Green><u>where</u></font>
<a name="line-64"></a>  to_gates <font color=Magenta>'X'</font> <font color=Red>=</font> <font color=Red>[</font>X<font color=Red>]</font>
<a name="line-65"></a>  to_gates <font color=Magenta>'Y'</font> <font color=Red>=</font> <font color=Red>[</font>Y<font color=Red>]</font>
<a name="line-66"></a>  to_gates <font color=Magenta>'Z'</font> <font color=Red>=</font> <font color=Red>[</font>Z<font color=Red>]</font>
<a name="line-67"></a>  to_gates <font color=Magenta>'H'</font> <font color=Red>=</font> <font color=Red>[</font>H<font color=Red>]</font>
<a name="line-68"></a>  to_gates <font color=Magenta>'S'</font> <font color=Red>=</font> <font color=Red>[</font>S<font color=Red>]</font>
<a name="line-69"></a>  to_gates <font color=Magenta>'T'</font> <font color=Red>=</font> <font color=Red>[</font>T<font color=Red>]</font>
<a name="line-70"></a>  to_gates <font color=Magenta>'E'</font> <font color=Red>=</font> <font color=Red>[</font>E<font color=Red>]</font>
<a name="line-71"></a>  to_gates <font color=Magenta>'W'</font> <font color=Red>=</font> <font color=Red>[</font>W<font color=Red>]</font>
<a name="line-72"></a>  to_gates <font color=Magenta>'I'</font> <font color=Red>=</font> []
<a name="line-73"></a>  to_gates <font color=Magenta>'-'</font> <font color=Red>=</font> <font color=Red>[</font>W<font color=Cyan>,</font>W<font color=Cyan>,</font>W<font color=Cyan>,</font>W<font color=Red>]</font>
<a name="line-74"></a>  to_gates <font color=Magenta>'i'</font> <font color=Red>=</font> <font color=Red>[</font>W<font color=Cyan>,</font>W<font color=Red>]</font>
<a name="line-75"></a>  to_gates x <font color=Red>=</font> error <font color=Cyan>$</font> <font color=Magenta>"to_gates[Char]: undefined -- "</font> <font color=Cyan>++</font> <font color=Cyan>(</font>show x<font color=Cyan>)</font>
<a name="line-76"></a>
<a name="line-77"></a><font color=Green><u>instance</u></font> ToGates Axis <font color=Green><u>where</u></font>
<a name="line-78"></a>  to_gates Axis_I <font color=Red>=</font> []
<a name="line-79"></a>  to_gates Axis_H <font color=Red>=</font> <font color=Red>[</font>H<font color=Red>]</font>
<a name="line-80"></a>  to_gates Axis_SH <font color=Red>=</font> <font color=Red>[</font>S<font color=Cyan>,</font>H<font color=Red>]</font>
<a name="line-81"></a>
<a name="line-82"></a><font color=Green><u>instance</u></font> ToGates Clifford <font color=Green><u>where</u></font>
<a name="line-83"></a>  to_gates op <font color=Red>=</font> <font color=Green><u>as</u></font> <font color=Cyan>++</font> xs <font color=Cyan>++</font> ss <font color=Cyan>++</font> ws <font color=Green><u>where</u></font>
<a name="line-84"></a>    <font color=Cyan>(</font>k<font color=Cyan>,</font> b<font color=Cyan>,</font> c<font color=Cyan>,</font> d<font color=Cyan>)</font> <font color=Red>=</font> clifford_decompose_coset op
<a name="line-85"></a>    <font color=Green><u>as</u></font> <font color=Red>=</font> to_gates k
<a name="line-86"></a>    xs  <font color=Red>=</font> replicate b X
<a name="line-87"></a>    ss  <font color=Red>=</font> replicate c S
<a name="line-88"></a>    ws  <font color=Red>=</font> replicate d W
<a name="line-89"></a>
<a name="line-90"></a><a name="FromGates"></a><font color=Blue><i>-- | A type class for all things that a list of gates can be converted</i></font>
<a name="line-91"></a><a name="FromGates"></a><font color=Blue><i>-- to. For example, a list of gates can be converted to an element of</i></font>
<a name="line-92"></a><a name="FromGates"></a><font color=Blue><i>-- /U/(2) or an element of /SO/(3), using various (exact or</i></font>
<a name="line-93"></a><a name="FromGates"></a><font color=Blue><i>-- approximate) representations of the matrix entries.</i></font>
<a name="line-94"></a><a name="FromGates"></a><font color=Green><u>class</u></font> FromGates a <font color=Green><u>where</u></font>
<a name="line-95"></a>  <font color=Blue><i>-- | Convert a list of gates to any suitable type.</i></font>
<a name="line-96"></a>  from_gates <font color=Red>::</font> <font color=Red>[</font>Gate<font color=Red>]</font> <font color=Red>-&gt;</font> a
<a name="line-97"></a>
<a name="line-98"></a><font color=Green><u>instance</u></font> FromGates String <font color=Green><u>where</u></font>
<a name="line-99"></a>  from_gates <font color=Red>=</font> concat <font color=Cyan>.</font> map show
<a name="line-100"></a>
<a name="line-101"></a><font color=Green><u>instance</u></font> FromGates <font color=Red>[</font>Gate<font color=Red>]</font> <font color=Green><u>where</u></font>
<a name="line-102"></a>  from_gates <font color=Red>=</font> id
<a name="line-103"></a>
<a name="line-104"></a><a name="invert_gates"></a><font color=Blue><i>-- | Invert a gate list.</i></font>
<a name="line-105"></a><font color=Blue>invert_gates</font> <font color=Red>::</font> <font color=Red>[</font>Gate<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Red>[</font>Gate<font color=Red>]</font>
<a name="line-106"></a><font color=Blue>invert_gates</font> gs <font color=Red>=</font> aux [] gs <font color=Green><u>where</u></font>
<a name="line-107"></a>  aux acc [] <font color=Red>=</font> acc
<a name="line-108"></a>  aux acc <font color=Cyan>(</font>X<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> aux <font color=Cyan>(</font>X<font color=Red><b>:</b></font>acc<font color=Cyan>)</font> t
<a name="line-109"></a>  aux acc <font color=Cyan>(</font>Y<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> aux <font color=Cyan>(</font>Y<font color=Red><b>:</b></font>acc<font color=Cyan>)</font> t
<a name="line-110"></a>  aux acc <font color=Cyan>(</font>Z<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> aux <font color=Cyan>(</font>Z<font color=Red><b>:</b></font>acc<font color=Cyan>)</font> t
<a name="line-111"></a>  aux acc <font color=Cyan>(</font>H<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> aux <font color=Cyan>(</font>H<font color=Red><b>:</b></font>acc<font color=Cyan>)</font> t
<a name="line-112"></a>  aux acc <font color=Cyan>(</font>S<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> aux <font color=Cyan>(</font>Z<font color=Red><b>:</b></font>S<font color=Red><b>:</b></font>acc<font color=Cyan>)</font> t
<a name="line-113"></a>  aux acc <font color=Cyan>(</font>T<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> aux <font color=Cyan>(</font>Z<font color=Red><b>:</b></font>S<font color=Red><b>:</b></font>T<font color=Red><b>:</b></font>acc<font color=Cyan>)</font> t
<a name="line-114"></a>  aux acc <font color=Cyan>(</font>E<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> aux <font color=Cyan>(</font>E<font color=Red><b>:</b></font>E<font color=Red><b>:</b></font>acc<font color=Cyan>)</font> t
<a name="line-115"></a>  aux acc <font color=Cyan>(</font>W<font color=Red><b>:</b></font>t<font color=Cyan>)</font> <font color=Red>=</font> aux <font color=Cyan>(</font>W<font color=Red><b>:</b></font>W<font color=Red><b>:</b></font>W<font color=Red><b>:</b></font>W<font color=Red><b>:</b></font>W<font color=Red><b>:</b></font>W<font color=Red><b>:</b></font>W<font color=Red><b>:</b></font>acc<font color=Cyan>)</font> t
<a name="line-116"></a>
<a name="line-117"></a><a name="convert"></a><font color=Blue><i>-- | Convert any precise format to any format.</i></font>
<a name="line-118"></a><font color=Blue>convert</font> <font color=Red>::</font> <font color=Cyan>(</font>ToGates a<font color=Cyan>,</font> FromGates b<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> b
<a name="line-119"></a><font color=Blue>convert</font> <font color=Red>=</font> from_gates <font color=Cyan>.</font> to_gates
<a name="line-120"></a>
<a name="line-121"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-122"></a><font color=Blue><i>-- * Matrices in /U/(2) and /SO/(3)</i></font>
<a name="line-123"></a>
<a name="line-124"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-125"></a><font color=Blue><i>-- ** Matrices in /U/(2)</i></font>
<a name="line-126"></a>
<a name="line-127"></a><a name="u2_X"></a><font color=Blue><i>-- | The Pauli /X/ operator.</i></font>
<a name="line-128"></a><font color=Blue>u2_X</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a
<a name="line-129"></a><font color=Blue>u2_X</font> <font color=Red>=</font> matrix2x2 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-130"></a>                 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-131"></a>
<a name="line-132"></a><a name="u2_Y"></a><font color=Blue><i>-- | The Pauli /Y/ operator.</i></font>
<a name="line-133"></a><font color=Blue>u2_Y</font> <font color=Red>::</font> <font color=Cyan>(</font>ComplexRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a
<a name="line-134"></a><font color=Blue>u2_Y</font> <font color=Red>=</font> matrix2x2 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font>i<font color=Cyan>)</font>
<a name="line-135"></a>                 <font color=Cyan>(</font>i<font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-136"></a>
<a name="line-137"></a><a name="u2_Z"></a><font color=Blue><i>-- | The Pauli /Z/ operator.</i></font>
<a name="line-138"></a><font color=Blue>u2_Z</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a
<a name="line-139"></a><font color=Blue>u2_Z</font> <font color=Red>=</font> matrix2x2 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-140"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-141"></a>
<a name="line-142"></a><a name="u2_H"></a><font color=Blue><i>-- | The Hadamard operator.</i></font>
<a name="line-143"></a><font color=Blue>u2_H</font> <font color=Red>::</font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a
<a name="line-144"></a><font color=Blue>u2_H</font> <font color=Red>=</font> roothalf <font color=Cyan>*</font> matrix2x2 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font>  <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-145"></a>                            <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-146"></a>
<a name="line-147"></a><a name="u2_S"></a><font color=Blue><i>-- | The /S/ operator.</i></font>
<a name="line-148"></a><font color=Blue>u2_S</font> <font color=Red>::</font> <font color=Cyan>(</font>ComplexRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a
<a name="line-149"></a><font color=Blue>u2_S</font> <font color=Red>=</font> matrix2x2 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-150"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> i<font color=Cyan>)</font>
<a name="line-151"></a>
<a name="line-152"></a><a name="u2_T"></a><font color=Blue><i>-- | The /T/ operator.</i></font>
<a name="line-153"></a><font color=Blue>u2_T</font> <font color=Red>::</font> <font color=Cyan>(</font>OmegaRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a
<a name="line-154"></a><font color=Blue>u2_T</font> <font color=Red>=</font> matrix2x2 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font>     <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-155"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> omega<font color=Cyan>)</font>
<a name="line-156"></a>
<a name="line-157"></a><a name="u2_E"></a><font color=Blue><i>-- | The /E/ operator.</i></font>
<a name="line-158"></a><font color=Blue>u2_E</font> <font color=Red>::</font> <font color=Cyan>(</font>OmegaRing a<font color=Cyan>,</font> RootHalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a
<a name="line-159"></a><font color=Blue>u2_E</font> <font color=Red>=</font> roothalf <font color=Cyan>*</font> matrix2x2 <font color=Cyan>(</font>omega<font color=Cyan>^</font><font color=Magenta>3</font><font color=Cyan>,</font>  omega<font color=Cyan>)</font>
<a name="line-160"></a>                            <font color=Cyan>(</font>omega<font color=Cyan>^</font><font color=Magenta>3</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font>omega<font color=Cyan>)</font>
<a name="line-161"></a>
<a name="line-162"></a><a name="u2_W"></a><font color=Blue><i>-- | The /W/ = [exp /i/&#960;\/4] global phase operator.</i></font>
<a name="line-163"></a><font color=Blue>u2_W</font> <font color=Red>::</font> <font color=Cyan>(</font>OmegaRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a
<a name="line-164"></a><font color=Blue>u2_W</font> <font color=Red>=</font> matrix2x2 <font color=Cyan>(</font>omega<font color=Cyan>,</font>     <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-165"></a>                 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font>     omega<font color=Cyan>)</font>
<a name="line-166"></a>
<a name="line-167"></a><a name="u2_of_gate"></a><font color=Blue><i>-- | Convert a symbolic gate to the corresponding operator.</i></font>
<a name="line-168"></a><font color=Blue>u2_of_gate</font> <font color=Red>::</font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>,</font> ComplexRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Gate <font color=Red>-&gt;</font> U2 a
<a name="line-169"></a><font color=Blue>u2_of_gate</font> X <font color=Red>=</font> u2_X
<a name="line-170"></a><font color=Blue>u2_of_gate</font> Y <font color=Red>=</font> u2_Y
<a name="line-171"></a><font color=Blue>u2_of_gate</font> Z <font color=Red>=</font> u2_Z
<a name="line-172"></a><font color=Blue>u2_of_gate</font> H <font color=Red>=</font> u2_H
<a name="line-173"></a><font color=Blue>u2_of_gate</font> S <font color=Red>=</font> u2_S
<a name="line-174"></a><font color=Blue>u2_of_gate</font> T <font color=Red>=</font> u2_T
<a name="line-175"></a><font color=Blue>u2_of_gate</font> E <font color=Red>=</font> u2_E
<a name="line-176"></a><font color=Blue>u2_of_gate</font> W <font color=Red>=</font> u2_W
<a name="line-177"></a>
<a name="line-178"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>,</font> ComplexRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> FromGates <font color=Cyan>(</font>U2 a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-179"></a>  from_gates <font color=Red>=</font> product' <font color=Cyan>.</font> map u2_of_gate <font color=Green><u>where</u></font>
<a name="line-180"></a>    product' <font color=Red>=</font> foldl' <font color=Cyan>(</font><font color=Cyan>*</font><font color=Cyan>)</font> <font color=Magenta>1</font>
<a name="line-181"></a>
<a name="line-182"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-183"></a><font color=Blue><i>-- ** Matrices in /SO/(3)</i></font>
<a name="line-184"></a>
<a name="line-185"></a><font color=Blue><i>-- $ This is the Bloch sphere representation of single qubit</i></font>
<a name="line-186"></a><font color=Blue><i>-- operators.</i></font>
<a name="line-187"></a>
<a name="line-188"></a><a name="so3_X"></a><font color=Blue><i>-- | The Pauli /X/ operator.</i></font>
<a name="line-189"></a><font color=Blue>so3_X</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> SO3 a
<a name="line-190"></a><font color=Blue>so3_X</font> <font color=Red>=</font> matrix3x3 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-191"></a>                  <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-192"></a>                  <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-193"></a>
<a name="line-194"></a><a name="so3_Y"></a><font color=Blue><i>-- | The Pauli /Y/ operator.</i></font>
<a name="line-195"></a><font color=Blue>so3_Y</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> SO3 a
<a name="line-196"></a><font color=Blue>so3_Y</font> <font color=Red>=</font> matrix3x3 <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-197"></a>                  <font color=Cyan>(</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-198"></a>                  <font color=Cyan>(</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-199"></a>
<a name="line-200"></a><a name="so3_Z"></a><font color=Blue><i>-- | The Pauli /Z/ operator.</i></font>
<a name="line-201"></a><font color=Blue>so3_Z</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> SO3 a
<a name="line-202"></a><font color=Blue>so3_Z</font> <font color=Red>=</font> matrix3x3 <font color=Cyan>(</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-203"></a>                  <font color=Cyan>(</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-204"></a>                  <font color=Cyan>(</font> <font color=Magenta>0</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-205"></a>
<a name="line-206"></a><a name="so3_H"></a><font color=Blue><i>-- | The Hadamard operator.</i></font>
<a name="line-207"></a><font color=Blue>so3_H</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> SO3 a
<a name="line-208"></a><font color=Blue>so3_H</font> <font color=Red>=</font> matrix3x3 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-209"></a>                  <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-210"></a>                  <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-211"></a>
<a name="line-212"></a><a name="so3_S"></a><font color=Blue><i>-- | The operator /S/.</i></font>
<a name="line-213"></a><font color=Blue>so3_S</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> SO3 a
<a name="line-214"></a><font color=Blue>so3_S</font> <font color=Red>=</font> matrix3x3 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-215"></a>                  <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-216"></a>                  <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-217"></a>
<a name="line-218"></a><a name="so3_E"></a><font color=Blue><i>-- | The operator /E/.</i></font>
<a name="line-219"></a><font color=Blue>so3_E</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>)</font> <font color=Red>=&gt;</font> SO3 a
<a name="line-220"></a><font color=Blue>so3_E</font> <font color=Red>=</font> matrix3x3 <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-221"></a>                  <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-222"></a>                  <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-223"></a>
<a name="line-224"></a><a name="so3_T"></a><font color=Blue><i>-- | The /T/ operator.</i></font>
<a name="line-225"></a><font color=Blue>so3_T</font> <font color=Red>::</font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> SO3 a
<a name="line-226"></a><font color=Blue>so3_T</font> <font color=Red>=</font> matrix3x3 <font color=Cyan>(</font>r<font color=Cyan>,</font> <font color=Blue><i>-</i></font>r<font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-227"></a>                  <font color=Cyan>(</font>r<font color=Cyan>,</font>  r<font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-228"></a>                  <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font>  <font color=Magenta>0</font><font color=Cyan>,</font>  <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-229"></a>  <font color=Green><u>where</u></font> r <font color=Red>=</font> roothalf
<a name="line-230"></a>
<a name="line-231"></a><a name="so3_of_gate"></a><font color=Blue><i>-- | Convert a symbolic gate to the corresponding Bloch sphere</i></font>
<a name="line-232"></a><font color=Blue><i>-- operator.</i></font>
<a name="line-233"></a><font color=Blue>so3_of_gate</font> <font color=Red>::</font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> Gate <font color=Red>-&gt;</font> SO3 a
<a name="line-234"></a><font color=Blue>so3_of_gate</font> X <font color=Red>=</font> so3_X
<a name="line-235"></a><font color=Blue>so3_of_gate</font> Y <font color=Red>=</font> so3_Y
<a name="line-236"></a><font color=Blue>so3_of_gate</font> Z <font color=Red>=</font> so3_Z
<a name="line-237"></a><font color=Blue>so3_of_gate</font> H <font color=Red>=</font> so3_H
<a name="line-238"></a><font color=Blue>so3_of_gate</font> S <font color=Red>=</font> so3_S
<a name="line-239"></a><font color=Blue>so3_of_gate</font> T <font color=Red>=</font> so3_T
<a name="line-240"></a><font color=Blue>so3_of_gate</font> E <font color=Red>=</font> so3_E
<a name="line-241"></a><font color=Blue>so3_of_gate</font> W <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-242"></a>
<a name="line-243"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>RootHalfRing a<font color=Cyan>)</font> <font color=Red>=&gt;</font> FromGates <font color=Cyan>(</font>SO3 a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-244"></a>  from_gates <font color=Red>=</font> product <font color=Cyan>.</font> map so3_of_gate
<a name="line-245"></a>
<a name="line-246"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-247"></a><font color=Blue><i>-- ** Conversions</i></font>
<a name="line-248"></a>
<a name="line-249"></a><a name="so3_of_u2"></a><font color=Blue><i>-- | Conversion from /U/(2) to /SO/(3).</i></font>
<a name="line-250"></a><font color=Blue>so3_of_u2</font> <font color=Red>::</font> <font color=Cyan>(</font>Adjoint a<font color=Cyan>,</font> ComplexRing a<font color=Cyan>,</font> RealPart a b<font color=Cyan>,</font> HalfRing b<font color=Cyan>)</font> <font color=Red>=&gt;</font> U2 a <font color=Red>-&gt;</font> SO3 b
<a name="line-251"></a><font color=Blue>so3_of_u2</font> u <font color=Red>=</font> matrix_of_function f <font color=Green><u>where</u></font>
<a name="line-252"></a>  f i j <font color=Red>=</font> half <font color=Cyan>*</font> <font color=Cyan>(</font>real <font color=Cyan>$</font> tr <font color=Cyan>(</font>sigma i <font color=Cyan>*</font> u <font color=Cyan>*</font> sigma j <font color=Cyan>*</font> adj u<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-253"></a>  sigma <font color=Magenta>0</font> <font color=Red>=</font> u2_X
<a name="line-254"></a>  sigma <font color=Magenta>1</font> <font color=Red>=</font> u2_Y
<a name="line-255"></a>  sigma <font color=Magenta>2</font> <font color=Red>=</font> u2_Z
<a name="line-256"></a>  sigma <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"so3_of_u2"</font> <font color=Blue><i>-- not reached</i></font>
<a name="line-257"></a>
<a name="line-258"></a><a name="so3_of_clifford"></a><font color=Blue><i>-- | Convert a Clifford operator to a matrix in /SO/(3).</i></font>
<a name="line-259"></a><font color=Blue>so3_of_clifford</font> <font color=Red>::</font> <font color=Cyan>(</font>ToClifford a<font color=Cyan>,</font> Ring b<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> SO3 b
<a name="line-260"></a><font color=Blue>so3_of_clifford</font> m <font color=Red>=</font> so3_E<font color=Cyan>^</font>a <font color=Cyan>*</font> so3_X<font color=Cyan>^</font>b <font color=Cyan>*</font> so3_S<font color=Cyan>^</font>c <font color=Green><u>where</u></font>
<a name="line-261"></a>  <font color=Cyan>(</font>a<font color=Cyan>,</font>b<font color=Cyan>,</font>c<font color=Cyan>,</font>d<font color=Cyan>)</font> <font color=Red>=</font> clifford_decompose m
<a name="line-262"></a>
<a name="line-263"></a><a name="clifford_of_so3"></a><font color=Blue><i>-- | Convert a matrix in /SO/(3) to a Clifford gate. Throw an error if</i></font>
<a name="line-264"></a><font color=Blue><i>-- the matrix isn't Clifford.</i></font>
<a name="line-265"></a><font color=Blue>clifford_of_so3</font> <font color=Red>::</font> <font color=Cyan>(</font>Ring a<font color=Cyan>,</font> Eq a<font color=Cyan>,</font> Adjoint a<font color=Cyan>)</font> <font color=Red>=&gt;</font> SO3 a <font color=Red>-&gt;</font> Clifford
<a name="line-266"></a><font color=Blue>clifford_of_so3</font> m <font color=Red>=</font> <font color=Green><u>case</u></font> from_matrix m <font color=Green><u>of</u></font>
<a name="line-267"></a>  <font color=Red>[</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Red>[</font> <font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Red>]</font> <font color=Red>-&gt;</font> with <font color=Magenta>"H"</font>
<a name="line-268"></a>  <font color=Red>[</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Red>[</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Red>]</font> <font color=Red>-&gt;</font> with <font color=Magenta>"HX"</font>
<a name="line-269"></a>  <font color=Red>[</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Red>[</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Red>]</font> <font color=Red>-&gt;</font> with <font color=Magenta>"SH"</font>
<a name="line-270"></a>  <font color=Red>[</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Red>[</font> <font color=Magenta>0</font><font color=Cyan>,</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Red>]</font> <font color=Red>-&gt;</font> with <font color=Magenta>"SHX"</font>
<a name="line-271"></a>  <font color=Red>[</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Red>[</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Red>]</font><font color=Red>]</font> <font color=Red>-&gt;</font> with <font color=Magenta>"X"</font>
<a name="line-272"></a>  <font color=Red>[</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Red>[</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Red>]</font> <font color=Red>-&gt;</font> with <font color=Magenta>"S"</font>
<a name="line-273"></a>  <font color=Red>[</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Red>[</font> <font color=Magenta>0</font><font color=Cyan>,</font><font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Red>]</font> <font color=Red>-&gt;</font> with <font color=Magenta>"SS"</font>
<a name="line-274"></a>  <font color=Red>[</font><font color=Green><u>_</u></font><font color=Cyan>,</font> <font color=Red>[</font> <font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Red>]</font> <font color=Red>-&gt;</font> with <font color=Magenta>"SSS"</font>
<a name="line-275"></a>  <font color=Red>[</font><font color=Red>[</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font><font color=Cyan>,</font> <font color=Red>[</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Red>]</font><font color=Red>]</font> <font color=Red>-&gt;</font> clifford_id
<a name="line-276"></a>  <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> error <font color=Magenta>"clifford_of_so3: not a Clifford operator"</font>
<a name="line-277"></a>  <font color=Green><u>where</u></font>
<a name="line-278"></a>    with s <font color=Red>=</font> op <font color=Cyan>`clifford_mult`</font> op1 <font color=Green><u>where</u></font>
<a name="line-279"></a>      op <font color=Red>=</font> to_clifford s
<a name="line-280"></a>      m1 <font color=Red>=</font> adj <font color=Cyan>(</font>so3_of_clifford op<font color=Cyan>)</font> <font color=Cyan>*</font> m
<a name="line-281"></a>      op1 <font color=Red>=</font> clifford_of_so3 m1
<a name="line-282"></a>
<a name="line-283"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>Ring a<font color=Cyan>,</font> Eq a<font color=Cyan>,</font> Adjoint a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToClifford <font color=Cyan>(</font>SO3 a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-284"></a>  to_clifford <font color=Red>=</font> clifford_of_so3
<a name="line-285"></a>
<a name="line-286"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-287"></a><font color=Blue><i>-- * Matsumoto-Amano normal forms</i></font>
<a name="line-288"></a>
<a name="line-289"></a><font color=Blue><i>-- $ A Matsumoto-Amano normal form is a sequence of Clifford+/T/</i></font>
<a name="line-290"></a><font color=Blue><i>-- operators that is of the form</i></font>
<a name="line-291"></a><font color=Blue><i>--</i></font>
<a name="line-292"></a><font color=Blue><i>-- * (&#949; | /T/) (/HT/ | /SHT/)[sup *] /C/.</i></font>
<a name="line-293"></a><font color=Blue><i>--</i></font>
<a name="line-294"></a><font color=Blue><i>-- Here, &#949; is the empty sequence, /C/ is any Clifford operator, and</i></font>
<a name="line-295"></a><font color=Blue><i>-- the meanings of @\"|\"@ and @\"*\"@ are as for regular</i></font>
<a name="line-296"></a><font color=Blue><i>-- expressions. Every single-qubit Clifford+/T/ operator has a unique</i></font>
<a name="line-297"></a><font color=Blue><i>-- Matsumoto-Amano normal form.</i></font>
<a name="line-298"></a>
<a name="line-299"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-300"></a><font color=Blue><i>-- ** Representation of normal forms</i></font>
<a name="line-301"></a>
<a name="line-302"></a><a name="NormalForm"></a><font color=Blue><i>-- | A representation of normal forms, optimized for right</i></font>
<a name="line-303"></a><a name="NormalForm"></a><font color=Blue><i>-- multiplication.</i></font>
<a name="line-304"></a><a name="NormalForm"></a><font color=Green><u>data</u></font> NormalForm <font color=Red>=</font> NormalForm Syllables Clifford
<a name="line-305"></a>                  <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Eq<font color=Cyan>)</font>
<a name="line-306"></a>
<a name="line-307"></a><a name="Syllables"></a><font color=Blue><i>-- | Syllables is a circuit of the form (&#949;|/T/) (/HT/|/SHT/)[sup *].</i></font>
<a name="line-308"></a><a name="Syllables"></a><font color=Green><u>data</u></font> Syllables <font color=Red>=</font>
<a name="line-309"></a>  S_I                  <font color=Blue><i>-- ^ The empty sequence &#949;.</i></font>
<a name="line-310"></a>  <font color=Red>|</font> S_T                <font color=Blue><i>-- ^ The sequence /T/.</i></font>
<a name="line-311"></a>  <font color=Red>|</font> SApp_HT Syllables  <font color=Blue><i>-- ^ A sequence of the form &#8230;/HT/.</i></font>
<a name="line-312"></a>  <font color=Red>|</font> SApp_SHT Syllables <font color=Blue><i>-- ^ A sequence of the form &#8230;/SHT/.</i></font>
<a name="line-313"></a>            <font color=Green><u>deriving</u></font> <font color=Cyan>(</font>Eq<font color=Cyan>,</font> Show<font color=Cyan>)</font>
<a name="line-314"></a>
<a name="line-315"></a><font color=Green><u>instance</u></font> ToGates NormalForm <font color=Green><u>where</u></font>
<a name="line-316"></a>  to_gates <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> <font color=Red>=</font> to_gates ts <font color=Cyan>++</font> to_gates c
<a name="line-317"></a>
<a name="line-318"></a><font color=Green><u>instance</u></font> ToGates Syllables <font color=Green><u>where</u></font>
<a name="line-319"></a>  to_gates S_I <font color=Red>=</font> []
<a name="line-320"></a>  to_gates S_T <font color=Red>=</font> <font color=Red>[</font>T<font color=Red>]</font>
<a name="line-321"></a>  to_gates <font color=Cyan>(</font>SApp_HT ts<font color=Cyan>)</font> <font color=Red>=</font> to_gates ts <font color=Cyan>++</font> <font color=Red>[</font>H<font color=Cyan>,</font> T<font color=Red>]</font>
<a name="line-322"></a>  to_gates <font color=Cyan>(</font>SApp_SHT ts<font color=Cyan>)</font> <font color=Red>=</font> to_gates ts <font color=Cyan>++</font> <font color=Red>[</font>S<font color=Cyan>,</font> H<font color=Cyan>,</font> T<font color=Red>]</font>
<a name="line-323"></a>
<a name="line-324"></a><font color=Green><u>instance</u></font> Show NormalForm <font color=Green><u>where</u></font>
<a name="line-325"></a>  show x <font color=Red>=</font> <font color=Green><u>case</u></font> to_gates x <font color=Green><u>of</u></font>
<a name="line-326"></a>    [] <font color=Red>-&gt;</font> <font color=Magenta>"&#949;"</font>
<a name="line-327"></a>    gs <font color=Red>-&gt;</font> concat <font color=Cyan>$</font> map show gs
<a name="line-328"></a>
<a name="line-329"></a><a name="normalform_append"></a><font color=Blue><i>-- | Right-multiply the given normal form by a gate.</i></font>
<a name="line-330"></a><font color=Blue>normalform_append</font> <font color=Red>::</font> NormalForm <font color=Red>-&gt;</font> Gate <font color=Red>-&gt;</font> NormalForm
<a name="line-331"></a><font color=Blue>normalform_append</font> <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> X <font color=Red>=</font>
<a name="line-332"></a>  NormalForm ts <font color=Cyan>(</font>c <font color=Cyan>`clifford_mult`</font> clifford_X<font color=Cyan>)</font>
<a name="line-333"></a><font color=Blue>normalform_append</font> <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> Y <font color=Red>=</font>
<a name="line-334"></a>  NormalForm ts <font color=Cyan>(</font>c <font color=Cyan>`clifford_mult`</font> clifford_Y<font color=Cyan>)</font>
<a name="line-335"></a><font color=Blue>normalform_append</font> <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> Z <font color=Red>=</font>
<a name="line-336"></a>  NormalForm ts <font color=Cyan>(</font>c <font color=Cyan>`clifford_mult`</font> clifford_Z<font color=Cyan>)</font>
<a name="line-337"></a><font color=Blue>normalform_append</font> <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> H <font color=Red>=</font>
<a name="line-338"></a>  NormalForm ts <font color=Cyan>(</font>c <font color=Cyan>`clifford_mult`</font> clifford_H<font color=Cyan>)</font>
<a name="line-339"></a><font color=Blue>normalform_append</font> <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> S <font color=Red>=</font>
<a name="line-340"></a>  NormalForm ts <font color=Cyan>(</font>c <font color=Cyan>`clifford_mult`</font> clifford_S<font color=Cyan>)</font>
<a name="line-341"></a><font color=Blue>normalform_append</font> <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> E <font color=Red>=</font>
<a name="line-342"></a>  NormalForm ts <font color=Cyan>(</font>c <font color=Cyan>`clifford_mult`</font> clifford_E<font color=Cyan>)</font>
<a name="line-343"></a><font color=Blue>normalform_append</font> <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> W <font color=Red>=</font>
<a name="line-344"></a>  NormalForm ts <font color=Cyan>(</font>c <font color=Cyan>`clifford_mult`</font> clifford_W<font color=Cyan>)</font>
<a name="line-345"></a><font color=Blue>normalform_append</font> <font color=Cyan>(</font>NormalForm ts c<font color=Cyan>)</font> T
<a name="line-346"></a>  <font color=Red>|</font> k <font color=Cyan>==</font> Axis_H <font color=Red>=</font> NormalForm <font color=Cyan>(</font>SApp_HT ts<font color=Cyan>)</font> c'
<a name="line-347"></a>  <font color=Red>|</font> k <font color=Cyan>==</font> Axis_SH <font color=Red>=</font> NormalForm <font color=Cyan>(</font>SApp_SHT ts<font color=Cyan>)</font> c'
<a name="line-348"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> <font color=Green><u>case</u></font> ts <font color=Green><u>of</u></font>
<a name="line-349"></a>      S_I <font color=Red>-&gt;</font> NormalForm S_T c'
<a name="line-350"></a>      S_T <font color=Red>-&gt;</font> NormalForm S_I <font color=Cyan>(</font>clifford_S <font color=Cyan>`clifford_mult`</font> c'<font color=Cyan>)</font>
<a name="line-351"></a>      SApp_HT ts' <font color=Red>-&gt;</font> NormalForm ts' <font color=Cyan>(</font>clifford_HS <font color=Cyan>`clifford_mult`</font> c'<font color=Cyan>)</font>
<a name="line-352"></a>      SApp_SHT ts' <font color=Red>-&gt;</font> NormalForm ts' <font color=Cyan>(</font>clifford_SHS <font color=Cyan>`clifford_mult`</font> c'<font color=Cyan>)</font>
<a name="line-353"></a>  <font color=Green><u>where</u></font>
<a name="line-354"></a>    <font color=Cyan>(</font>k<font color=Cyan>,</font> c'<font color=Cyan>)</font> <font color=Red>=</font> clifford_tconj c
<a name="line-355"></a>    clifford_HS <font color=Red>=</font> to_clifford <font color=Magenta>"HS"</font>
<a name="line-356"></a>    clifford_SHS <font color=Red>=</font> to_clifford <font color=Magenta>"SHS"</font>
<a name="line-357"></a>
<a name="line-358"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-359"></a><font color=Blue><i>-- ** Group operations on normal forms</i></font>
<a name="line-360"></a>
<a name="line-361"></a><a name="nf_id"></a><font color=Blue><i>-- | The identity as a normal form.</i></font>
<a name="line-362"></a><font color=Blue>nf_id</font> <font color=Red>::</font> NormalForm
<a name="line-363"></a><font color=Blue>nf_id</font> <font color=Red>=</font> NormalForm S_I clifford_id
<a name="line-364"></a>
<a name="line-365"></a><a name="nf_mult"></a><font color=Blue><i>-- | Multiply two normal forms. The right factor can be any</i></font>
<a name="line-366"></a><font color=Blue><i>-- 'ToGates'.</i></font>
<a name="line-367"></a><font color=Blue>nf_mult</font> <font color=Red>::</font> <font color=Cyan>(</font>ToGates b<font color=Cyan>)</font> <font color=Red>=&gt;</font> NormalForm <font color=Red>-&gt;</font> b <font color=Red>-&gt;</font> NormalForm
<a name="line-368"></a><font color=Blue>nf_mult</font> a b <font color=Red>=</font> foldl' normalform_append a <font color=Cyan>(</font>to_gates b<font color=Cyan>)</font>
<a name="line-369"></a>
<a name="line-370"></a><a name="nf_inv"></a><font color=Blue><i>-- | Invert a normal form. The input can be any 'ToGates'.</i></font>
<a name="line-371"></a><font color=Blue>nf_inv</font> <font color=Red>::</font> <font color=Cyan>(</font>ToGates a<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> NormalForm
<a name="line-372"></a><font color=Blue>nf_inv</font> <font color=Red>=</font> from_gates <font color=Cyan>.</font> invert_gates <font color=Cyan>.</font> to_gates
<a name="line-373"></a>
<a name="line-374"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-375"></a><font color=Blue><i>-- ** Conversion to normal form</i></font>
<a name="line-376"></a>
<a name="line-377"></a><a name="normalize"></a><font color=Blue><i>-- | Convert any 'ToGates' list to a 'NormalForm', thereby normalizing it.</i></font>
<a name="line-378"></a><font color=Blue>normalize</font> <font color=Red>::</font> <font color=Cyan>(</font>ToGates a<font color=Cyan>)</font> <font color=Red>=&gt;</font> a <font color=Red>-&gt;</font> NormalForm
<a name="line-379"></a><font color=Blue>normalize</font> <font color=Red>=</font> nf_mult nf_id
<a name="line-380"></a>
<a name="line-381"></a><font color=Green><u>instance</u></font> FromGates NormalForm <font color=Green><u>where</u></font>
<a name="line-382"></a>  from_gates <font color=Red>=</font> normalize
<a name="line-383"></a>
<a name="line-384"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-385"></a><font color=Blue><i>-- * Exact synthesis</i></font>
<a name="line-386"></a>
<a name="line-387"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-388"></a><font color=Blue><i>-- ** Synthesis from /SO/(3)</i></font>
<a name="line-389"></a>
<a name="line-390"></a><a name="synthesis_bloch"></a><font color=Blue><i>-- | Input an exact matrix in /SO/(3), and output the corresponding</i></font>
<a name="line-391"></a><font color=Blue><i>-- Clifford+/T/ normal form. It is an error if the given matrix is not</i></font>
<a name="line-392"></a><font color=Blue><i>-- an element of /SO/(3), i.e., orthogonal with determinant 1.</i></font>
<a name="line-393"></a><font color=Blue><i>--</i></font>
<a name="line-394"></a><font color=Blue><i>-- This implementation uses the Matsumoto-Amano algorithm.</i></font>
<a name="line-395"></a><font color=Blue><i>-- </i></font>
<a name="line-396"></a><font color=Blue><i>-- Note: the list of gates will be returned in right-to-left order,</i></font>
<a name="line-397"></a><font color=Blue><i>-- i.e., as in the mathematical notation for matrix multiplication.</i></font>
<a name="line-398"></a><font color=Blue><i>-- This is the opposite of the quantum circuit notation.</i></font>
<a name="line-399"></a><font color=Blue>synthesis_bloch</font> <font color=Red>::</font> SO3 DReal <font color=Red>-&gt;</font> <font color=Red>[</font>Gate<font color=Red>]</font>
<a name="line-400"></a><font color=Blue>synthesis_bloch</font> m <font color=Red>=</font> aux m1 k
<a name="line-401"></a>  <font color=Green><u>where</u></font>
<a name="line-402"></a>    <font color=Cyan>(</font>m1<font color=Cyan>,</font> k<font color=Cyan>)</font> <font color=Red>=</font> denomexp_decompose m
<a name="line-403"></a>
<a name="line-404"></a>    aux <font color=Red>::</font> SO3 DInteger <font color=Red>-&gt;</font> Integer <font color=Red>-&gt;</font> <font color=Red>[</font>Gate<font color=Red>]</font>    
<a name="line-405"></a>    aux m <font color=Magenta>0</font> <font color=Red>=</font> to_gates <font color=Cyan>(</font>clifford_of_so3 m<font color=Cyan>)</font>
<a name="line-406"></a>    aux m k <font color=Red>=</font> to_gates axis <font color=Cyan>++</font> <font color=Red>[</font>T<font color=Red>]</font> <font color=Cyan>++</font> aux m4 <font color=Cyan>(</font>k<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-407"></a>      <font color=Green><u>where</u></font>
<a name="line-408"></a>        Matrix p <font color=Red>=</font> matrix_map parity m
<a name="line-409"></a>        v1 <font color=Red>=</font> vector_head p
<a name="line-410"></a>        v2 <font color=Red>=</font> vector_head <font color=Cyan>(</font>vector_tail p<font color=Cyan>)</font>
<a name="line-411"></a>        v <font color=Red>=</font> list_of_vector <font color=Cyan>$</font> vector_zipwith <font color=Cyan>(</font><font color=Red>\</font>x y <font color=Red>-&gt;</font> x <font color=Cyan>+</font> y <font color=Blue><i>-</i></font> x<font color=Cyan>*</font>y<font color=Cyan>)</font> v1 v2
<a name="line-412"></a>        axis <font color=Red>=</font> <font color=Green><u>case</u></font> v <font color=Green><u>of</u></font>
<a name="line-413"></a>          <font color=Red>[</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Red>]</font> <font color=Red>-&gt;</font> Axis_I
<a name="line-414"></a>          <font color=Red>[</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Red>]</font> <font color=Red>-&gt;</font> Axis_H
<a name="line-415"></a>          <font color=Red>[</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Red>]</font> <font color=Red>-&gt;</font> Axis_SH
<a name="line-416"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> error <font color=Magenta>"synthesis_bloch: not unitary"</font>
<a name="line-417"></a>        m2 <font color=Red>=</font> adj <font color=Cyan>(</font>so3_of_clifford axis<font color=Cyan>)</font> <font color=Cyan>*</font> m
<a name="line-418"></a>        m3 <font color=Red>=</font> adj sqrt2T <font color=Cyan>*</font> m2
<a name="line-419"></a>        m4 <font color=Red>=</font> matrix_map half_DInteger m3
<a name="line-420"></a>    sqrt2T <font color=Red>=</font> matrix3x3 <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Cyan>(</font><font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>1</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Cyan>(</font><font color=Magenta>0</font><font color=Cyan>,</font> <font color=Magenta>0</font><font color=Cyan>,</font> roottwo<font color=Cyan>)</font>
<a name="line-421"></a>
<a name="line-422"></a>    <font color=Blue><i>-- Divide a 'DInteger' of the form 2/a/ + 2/b/&#8730;2 by 2, or throw an</i></font>
<a name="line-423"></a>    <font color=Blue><i>-- error if it is not of the required form.</i></font>
<a name="line-424"></a>    half_DInteger <font color=Red>::</font> DInteger <font color=Red>-&gt;</font> DInteger
<a name="line-425"></a>    half_DInteger <font color=Cyan>(</font>RootTwo a b<font color=Cyan>)</font>
<a name="line-426"></a>      <font color=Red>|</font> even a <font color=Cyan>&amp;&amp;</font> even b <font color=Red>=</font> RootTwo a' b'
<a name="line-427"></a>      <font color=Red>|</font> otherwise <font color=Red>=</font> error <font color=Magenta>"synthesis_bloch: not unitary"</font>
<a name="line-428"></a>      <font color=Green><u>where</u></font>
<a name="line-429"></a>        a' <font color=Red>=</font> a <font color=Cyan>`div`</font> <font color=Magenta>2</font>
<a name="line-430"></a>        b' <font color=Red>=</font> b <font color=Cyan>`div`</font> <font color=Magenta>2</font>
<a name="line-431"></a>
<a name="line-432"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToEComplex a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToGates <font color=Cyan>(</font>SO3 a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-433"></a>  to_gates <font color=Red>=</font> synthesis_bloch <font color=Cyan>.</font> to_dyadic <font color=Cyan>.</font> matrix_map <font color=Cyan>(</font>to_real <font color=Cyan>.</font> toEComplex<font color=Cyan>)</font>
<a name="line-434"></a>    <font color=Green><u>where</u></font>
<a name="line-435"></a>      to_real <font color=Cyan>(</font>Cplx a <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>=</font> a
<a name="line-436"></a>      to_real <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Magenta>"to_gates: not a real number"</font>
<a name="line-437"></a>
<a name="line-438"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-439"></a><font color=Blue><i>-- ** Synthesis from /U/(2)</i></font>
<a name="line-440"></a>
<a name="line-441"></a><font color=Green><u>instance</u></font> ToGates TwoLevel <font color=Green><u>where</u></font>
<a name="line-442"></a>  to_gates <font color=Cyan>(</font>TL_X <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Red>[</font>X<font color=Red>]</font>
<a name="line-443"></a>  to_gates <font color=Cyan>(</font>TL_X <font color=Magenta>1</font> <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Red>[</font>X<font color=Red>]</font>
<a name="line-444"></a>  to_gates <font color=Cyan>(</font>TL_H <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Red>[</font>H<font color=Red>]</font>
<a name="line-445"></a>  to_gates <font color=Cyan>(</font>TL_H <font color=Magenta>1</font> <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Red>[</font>X<font color=Cyan>,</font>H<font color=Cyan>,</font>X<font color=Red>]</font>
<a name="line-446"></a>  to_gates <font color=Cyan>(</font>TL_T k <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-447"></a>    <font color=Red>|</font> k <font color=Cyan>`mod`</font> <font color=Magenta>2</font> <font color=Cyan>==</font> <font color=Magenta>1</font> <font color=Red>=</font> <font color=Red>[</font>T<font color=Red>]</font> <font color=Cyan>++</font> to_gates <font color=Cyan>(</font>TL_T <font color=Cyan>(</font>k<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font> <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-448"></a>    <font color=Red>|</font> k <font color=Cyan>`mod`</font> <font color=Magenta>4</font> <font color=Cyan>==</font> <font color=Magenta>2</font> <font color=Red>=</font> <font color=Red>[</font>S<font color=Red>]</font> <font color=Cyan>++</font> to_gates <font color=Cyan>(</font>TL_T <font color=Cyan>(</font>k<font color=Blue><i>-</i></font><font color=Magenta>2</font><font color=Cyan>)</font> <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-449"></a>    <font color=Red>|</font> k <font color=Cyan>`mod`</font> <font color=Magenta>8</font> <font color=Cyan>==</font> <font color=Magenta>4</font> <font color=Red>=</font> <font color=Red>[</font>Z<font color=Red>]</font>
<a name="line-450"></a>    <font color=Red>|</font> otherwise <font color=Red>=</font> []
<a name="line-451"></a>  to_gates <font color=Cyan>(</font>TL_T k <font color=Magenta>1</font> <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>=</font> <font color=Red>[</font>X<font color=Red>]</font> <font color=Cyan>++</font> to_gates <font color=Cyan>(</font>TL_T k <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Cyan>++</font> <font color=Red>[</font>X<font color=Red>]</font>
<a name="line-452"></a>  to_gates <font color=Cyan>(</font>TL_omega k <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Red>=</font> to_gates <font color=Cyan>(</font>TL_T k <font color=Magenta>0</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-453"></a>  to_gates <font color=Cyan>(</font>TL_omega k <font color=Magenta>0</font><font color=Cyan>)</font> <font color=Red>=</font> to_gates <font color=Cyan>(</font>TL_T k <font color=Magenta>1</font> <font color=Magenta>0</font><font color=Cyan>)</font>
<a name="line-454"></a>  to_gates <font color=Green><u>_</u></font> <font color=Red>=</font> error <font color=Cyan>$</font> <font color=Magenta>"ToGates TwoLevel: invalid gate"</font>
<a name="line-455"></a>
<a name="line-456"></a><a name="synthesis_u2"></a><font color=Blue><i>-- | Input an exact matrix in /U/(2), and output the corresponding</i></font>
<a name="line-457"></a><font color=Blue><i>-- Clifford+/T/ normal form. The behavior is undefined if the given</i></font>
<a name="line-458"></a><font color=Blue><i>-- matrix is not an element of /U/(2), i.e., unitary with determinant</i></font>
<a name="line-459"></a><font color=Blue><i>-- 1.</i></font>
<a name="line-460"></a><font color=Blue><i>--</i></font>
<a name="line-461"></a><font color=Blue><i>-- We use a variant of the Kliuchnikov-Maslov-Mosca algorithm, as</i></font>
<a name="line-462"></a><font color=Blue><i>-- implemented in "Libraries.Synthesis.MultiQubitSynthesis".</i></font>
<a name="line-463"></a><font color=Blue><i>-- </i></font>
<a name="line-464"></a><font color=Blue><i>-- Note: the list of gates will be returned in right-to-left order,</i></font>
<a name="line-465"></a><font color=Blue><i>-- i.e., as in the mathematical notation for matrix multiplication.</i></font>
<a name="line-466"></a><font color=Blue><i>-- This is the opposite of the quantum circuit notation.</i></font>
<a name="line-467"></a><font color=Blue>synthesis_u2</font> <font color=Red>::</font> U2 DOmega <font color=Red>-&gt;</font> <font color=Red>[</font>Gate<font color=Red>]</font>
<a name="line-468"></a><font color=Blue>synthesis_u2</font> <font color=Red>=</font> to_gates <font color=Cyan>.</font> normalize <font color=Cyan>.</font> synthesis_nqubit
<a name="line-469"></a>
<a name="line-470"></a><font color=Green><u>instance</u></font> <font color=Cyan>(</font>ToEComplex a<font color=Cyan>)</font> <font color=Red>=&gt;</font> ToGates <font color=Cyan>(</font>U2 a<font color=Cyan>)</font> <font color=Green><u>where</u></font>
<a name="line-471"></a>  to_gates <font color=Red>=</font> synthesis_u2 <font color=Cyan>.</font> matrix_map <font color=Cyan>(</font>fromDComplex <font color=Cyan>.</font> to_dyadic <font color=Cyan>.</font> toEComplex<font color=Cyan>)</font>
<a name="line-472"></a>
<a name="line-473"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-474"></a><font color=Blue><i>-- * Compact representation of normal forms</i></font>
<a name="line-475"></a>
<a name="line-476"></a><font color=Blue><i>-- $ It is sometimes useful to store Clifford+/T/ operators in a file;</i></font>
<a name="line-477"></a><font color=Blue><i>-- for this purpose, we provide a very succinct encoding of</i></font>
<a name="line-478"></a><font color=Blue><i>-- Clifford+/T/ operators as bit strings, which are in turns</i></font>
<a name="line-479"></a><font color=Blue><i>-- represented as integers.</i></font>
<a name="line-480"></a><font color=Blue><i>--</i></font>
<a name="line-481"></a><font color=Blue><i>-- Our bitwise encoding is as follows. The first regular expression</i></font>
<a name="line-482"></a><font color=Blue><i>-- represents the set of Matsumoto-Amano normal forms (with a</i></font>
<a name="line-483"></a><font color=Blue><i>-- particular presentation of the rightmost Clifford operator). The</i></font>
<a name="line-484"></a><font color=Blue><i>-- second regular expression, which has the same form, defines the</i></font>
<a name="line-485"></a><font color=Blue><i>-- corresponding bit string encoding.</i></font>
<a name="line-486"></a><font color=Blue><i>--</i></font>
<a name="line-487"></a><font color=Blue><i>-- * (&#949;|/T/) (/HT/|/SHT/)[sup *] (&#949;|/H/|/SH/) (&#949;|/X/) (&#949;|/S&#178;/) (&#949;|/S/) (&#949;|&#969;&#8308;) (&#949;|&#969;&#178;) (&#949;|&#969;)</i></font>
<a name="line-488"></a><font color=Blue><i>--</i></font>
<a name="line-489"></a><font color=Blue><i>-- * (10|11) (0|1)[sup *] (00|01|10) (0|1) (0|1) (0|1) (0|1) (0|1) (0|1)</i></font>
<a name="line-490"></a><font color=Blue><i>--</i></font>
<a name="line-491"></a><font color=Blue><i>-- As a special case, the leading bits 10 are omitted in case the</i></font>
<a name="line-492"></a><font color=Blue><i>-- encoded operator is a Clifford operator. This ensures that the</i></font>
<a name="line-493"></a><font color=Blue><i>-- encoding of a Clifford operator is an integer from 0 to 191.</i></font>
<a name="line-494"></a><font color=Blue><i>-- </i></font>
<a name="line-495"></a><font color=Blue><i>-- This format has the property that the encoded Clifford+/T/</i></font>
<a name="line-496"></a><font color=Blue><i>-- operator can, in principle, be read off directly from the hexadecimal</i></font>
<a name="line-497"></a><font color=Blue><i>-- representation of the bit string, with the following decoding:</i></font>
<a name="line-498"></a><font color=Blue><i>--</i></font>
<a name="line-499"></a><font color=Blue><i>-- Leftmost one or two hexadecimal digits:</i></font>
<a name="line-500"></a><font color=Blue><i>--</i></font>
<a name="line-501"></a><font color=Blue><i>-- &gt;  0 = n/a             4 = HT              8 = HTHT            c = THTHT</i></font>
<a name="line-502"></a><font color=Blue><i>-- &gt;  1 = see below       5 = SHT             9 = HTSHT           d = THTSHT</i></font>
<a name="line-503"></a><font color=Blue><i>-- &gt;  2 = &#949;               6 = THT             a = SHTHT           e = TSHTHT</i></font>
<a name="line-504"></a><font color=Blue><i>-- &gt;  3 = T               7 = TSHT            b = SHTSHT          f = TSHTSHT</i></font>
<a name="line-505"></a><font color=Blue><i>-- &gt;</i></font>
<a name="line-506"></a><font color=Blue><i>-- &gt;  10 = HTHTHT         14 = SHTHTHT        18 = THTHTHT        1c = TSHTHTHT</i></font>
<a name="line-507"></a><font color=Blue><i>-- &gt;  11 = HTHTSHT        15 = SHTHTSHT       19 = THTHTSHT       1d = TSHTHTSHT</i></font>
<a name="line-508"></a><font color=Blue><i>-- &gt;  12 = HTSHTHT        16 = SHTSHTHT       1a = THTSHTHT       1e = TSHTSHTHT</i></font>
<a name="line-509"></a><font color=Blue><i>-- &gt;  13 = HTSHTSHT       17 = SHTSHTSHT      1b = THTSHTSHT      1f = TSHTSHTSHT</i></font>
<a name="line-510"></a><font color=Blue><i>--</i></font>
<a name="line-511"></a><font color=Blue><i>-- Central hexadecimal digit:</i></font>
<a name="line-512"></a><font color=Blue><i>--</i></font>
<a name="line-513"></a><font color=Blue><i>-- &gt;  0 = HTHTHTHT        4 = HTSHTHTHT       8 = SHTHTHTHT       c = SHTSHTHTHT</i></font>
<a name="line-514"></a><font color=Blue><i>-- &gt;  1 = HTHTHTSHT       5 = HTSHTHTSHT      9 = SHTHTHTSHT      d = SHTSHTHTSHT</i></font>
<a name="line-515"></a><font color=Blue><i>-- &gt;  2 = HTHTSHTHT       6 = HTSHTSHTHT      a = SHTHTSHTHT      e = SHTSHTSHTHT</i></font>
<a name="line-516"></a><font color=Blue><i>-- &gt;  3 = HTHTSHTSHT      7 = HTSHTSHTSHT     b = SHTHTSHTSHT     f = SHTSHTSHTSHT</i></font>
<a name="line-517"></a><font color=Blue><i>--</i></font>
<a name="line-518"></a><font color=Blue><i>-- Second-to-rightmost hexadecimal digit:</i></font>
<a name="line-519"></a><font color=Blue><i>--</i></font>
<a name="line-520"></a><font color=Blue><i>-- &gt;  0 = &#949;               4 = H               8 = SH              c = n/a</i></font>
<a name="line-521"></a><font color=Blue><i>-- &gt;  1 = SS              5 = HSS             9 = SHSS            d = n/a</i></font>
<a name="line-522"></a><font color=Blue><i>-- &gt;  2 = X               6 = HX              a = SHX             e = n/a</i></font>
<a name="line-523"></a><font color=Blue><i>-- &gt;  3 = XSS             7 = HXSS            b = SHXSS           f = n/a</i></font>
<a name="line-524"></a><font color=Blue><i>--</i></font>
<a name="line-525"></a><font color=Blue><i>-- Rightmost hexadecimal digit:</i></font>
<a name="line-526"></a><font color=Blue><i>--</i></font>
<a name="line-527"></a><font color=Blue><i>-- &gt;  0 = &#949;               4 = &#969;&#8308;              8 = S               c = S&#969;&#8308;</i></font>
<a name="line-528"></a><font color=Blue><i>-- &gt;  1 = &#969;               5 = &#969;&#8309;              9 = S&#969;              d = S&#969;&#8309;</i></font>
<a name="line-529"></a><font color=Blue><i>-- &gt;  2 = &#969;&#178;              6 = &#969;&#8310;              a = S&#969;&#178;             e = S&#969;&#8310;</i></font>
<a name="line-530"></a><font color=Blue><i>-- &gt;  3 = &#969;&#179;              7 = &#969;&#8311;              b = S&#969;&#179;             f = S&#969;&#8311;</i></font>
<a name="line-531"></a><font color=Blue><i>--</i></font>
<a name="line-532"></a><font color=Blue><i>-- For example, the hexadecimal integer</i></font>
<a name="line-533"></a><font color=Blue><i>--</i></font>
<a name="line-534"></a><font color=Blue><i>-- &gt; 6bf723e31</i></font>
<a name="line-535"></a><font color=Blue><i>--</i></font>
<a name="line-536"></a><font color=Blue><i>-- encodes the Clifford+/T/ operator</i></font>
<a name="line-537"></a><font color=Blue><i>--</i></font>
<a name="line-538"></a><font color=Blue><i>-- &gt; THT SHTHTSHTSHT SHTSHTSHTSHT HTSHTSHTSHT HTHTSHTHT HTHTSHTSHT SHTSHTSHTHT XSS &#969;.</i></font>
<a name="line-539"></a>
<a name="line-540"></a><a name="normalform_pack"></a><font color=Blue><i>-- | Compactly encode a 'NormalForm' as an 'Integer'.</i></font>
<a name="line-541"></a><font color=Blue>normalform_pack</font> <font color=Red>::</font> NormalForm <font color=Red>-&gt;</font> Integer
<a name="line-542"></a><font color=Blue>normalform_pack</font> <font color=Cyan>(</font>NormalForm S_I op<font color=Cyan>)</font> <font color=Red>=</font> clifford_pack op
<a name="line-543"></a><font color=Blue>normalform_pack</font> <font color=Cyan>(</font>NormalForm s op<font color=Cyan>)</font> <font color=Red>=</font> <font color=Magenta>256</font> <font color=Cyan>*</font> syllables_pack s <font color=Cyan>+</font> clifford_pack op
<a name="line-544"></a>  <font color=Green><u>where</u></font>
<a name="line-545"></a>    syllables_pack <font color=Red>::</font> Syllables <font color=Red>-&gt;</font> Integer
<a name="line-546"></a>    syllables_pack S_I <font color=Red>=</font> <font color=Magenta>2</font>
<a name="line-547"></a>    syllables_pack S_T <font color=Red>=</font> <font color=Magenta>3</font>
<a name="line-548"></a>    syllables_pack <font color=Cyan>(</font>SApp_HT s<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>syllables_pack s <font color=Cyan>`shiftL`</font> <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Cyan>+</font> <font color=Magenta>0</font>
<a name="line-549"></a>    syllables_pack <font color=Cyan>(</font>SApp_SHT s<font color=Cyan>)</font> <font color=Red>=</font> <font color=Cyan>(</font>syllables_pack s <font color=Cyan>`shiftL`</font> <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Cyan>+</font> <font color=Magenta>1</font>
<a name="line-550"></a>
<a name="line-551"></a><a name="normalform_unpack"></a><font color=Blue><i>-- | Decode a 'NormalForm' from its 'Integer' encoding. This is the</i></font>
<a name="line-552"></a><font color=Blue><i>-- inverse of 'normalform_pack'.</i></font>
<a name="line-553"></a><font color=Blue>normalform_unpack</font> <font color=Red>::</font> Integer <font color=Red>-&gt;</font> NormalForm
<a name="line-554"></a><font color=Blue>normalform_unpack</font> n 
<a name="line-555"></a>  <font color=Red>|</font> n <font color=Cyan>&lt;</font> <font color=Magenta>0</font> <font color=Red>=</font> error <font color=Magenta>"normalform_unpack: invalid encoding"</font>
<a name="line-556"></a>  <font color=Red>|</font> n <font color=Cyan>&lt;</font> <font color=Magenta>192</font> <font color=Red>=</font> NormalForm S_I op
<a name="line-557"></a>  <font color=Red>|</font> n <font color=Cyan>&lt;</font> <font color=Magenta>768</font> <font color=Red>=</font> error <font color=Magenta>"normalform_unpack: invalid encoding"</font>
<a name="line-558"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> NormalForm s op 
<a name="line-559"></a>  <font color=Green><u>where</u></font>
<a name="line-560"></a>    s <font color=Red>=</font> syllables_unpack <font color=Cyan>(</font>n <font color=Cyan>`shiftR`</font> <font color=Magenta>8</font><font color=Cyan>)</font>
<a name="line-561"></a>    op <font color=Red>=</font> clifford_unpack <font color=Cyan>(</font>n <font color=Cyan>.&amp;.</font> <font color=Magenta>0xff</font><font color=Cyan>)</font>
<a name="line-562"></a>
<a name="line-563"></a>    syllables_unpack <font color=Red>::</font> Integer <font color=Red>-&gt;</font> Syllables
<a name="line-564"></a>    syllables_unpack <font color=Magenta>0</font> <font color=Red>=</font> error <font color=Magenta>"normalform_unpack: invalid encoding"</font>
<a name="line-565"></a>    syllables_unpack <font color=Magenta>1</font> <font color=Red>=</font> error <font color=Magenta>"normalform_unpack: invalid encoding"</font>
<a name="line-566"></a>    syllables_unpack <font color=Magenta>2</font> <font color=Red>=</font> S_I
<a name="line-567"></a>    syllables_unpack <font color=Magenta>3</font> <font color=Red>=</font> S_T
<a name="line-568"></a>    syllables_unpack n
<a name="line-569"></a>      <font color=Red>|</font> even n     <font color=Red>=</font> SApp_HT s
<a name="line-570"></a>      <font color=Red>|</font> otherwise  <font color=Red>=</font> SApp_SHT s
<a name="line-571"></a>      <font color=Green><u>where</u></font>
<a name="line-572"></a>        s <font color=Red>=</font> syllables_unpack <font color=Cyan>(</font>n <font color=Cyan>`shiftR`</font> <font color=Magenta>1</font><font color=Cyan>)</font>
<a name="line-573"></a>
<a name="line-574"></a><a name="clifford_pack"></a><font color=Blue><i>-- | Encode a Clifford operator as an integer in the range 0&#8722;191.</i></font>
<a name="line-575"></a><font color=Blue>clifford_pack</font> <font color=Red>::</font> Clifford <font color=Red>-&gt;</font> Integer
<a name="line-576"></a><font color=Blue>clifford_pack</font> op <font color=Red>=</font> toInteger <font color=Cyan>(</font><font color=Magenta>64</font> <font color=Cyan>*</font> encode k <font color=Cyan>+</font> <font color=Magenta>32</font><font color=Cyan>*</font>b <font color=Cyan>+</font> <font color=Magenta>8</font><font color=Cyan>*</font>c <font color=Cyan>+</font> d<font color=Cyan>)</font>
<a name="line-577"></a>  <font color=Green><u>where</u></font>
<a name="line-578"></a>    <font color=Cyan>(</font>k<font color=Cyan>,</font> b<font color=Cyan>,</font> c<font color=Cyan>,</font> d<font color=Cyan>)</font> <font color=Red>=</font> clifford_decompose_coset op
<a name="line-579"></a>    encode Axis_I <font color=Red>=</font> <font color=Magenta>0</font>
<a name="line-580"></a>    encode Axis_H <font color=Red>=</font> <font color=Magenta>1</font>
<a name="line-581"></a>    encode Axis_SH <font color=Red>=</font> <font color=Magenta>2</font>
<a name="line-582"></a>
<a name="line-583"></a><a name="clifford_unpack"></a><font color=Blue><i>-- | Decode a Clifford operator from its integer encoding. This is the</i></font>
<a name="line-584"></a><font color=Blue><i>-- inverse of 'clifford_pack'</i></font>
<a name="line-585"></a><font color=Blue>clifford_unpack</font> <font color=Red>::</font> Integer <font color=Red>-&gt;</font> Clifford
<a name="line-586"></a><font color=Blue>clifford_unpack</font> n 
<a name="line-587"></a>  <font color=Red>|</font> n <font color=Cyan>&lt;</font> <font color=Magenta>0</font> <font color=Cyan>||</font> n <font color=Cyan>&gt;</font> <font color=Magenta>191</font> <font color=Red>=</font> error <font color=Magenta>"clifford_unpack: invalid encoding"</font>
<a name="line-588"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> decode k <font color=Cyan>*</font> <font color=Cyan>(</font>clifford_X<font color=Cyan>^</font>b<font color=Cyan>)</font> <font color=Cyan>*</font> <font color=Cyan>(</font>clifford_S<font color=Cyan>^</font>c<font color=Cyan>)</font> <font color=Cyan>*</font> <font color=Cyan>(</font>clifford_W<font color=Cyan>^</font>d<font color=Cyan>)</font>
<a name="line-589"></a>  <font color=Green><u>where</u></font>
<a name="line-590"></a>    d <font color=Red>=</font> n <font color=Cyan>.&amp;.</font> <font color=Magenta>0x7</font>
<a name="line-591"></a>    c <font color=Red>=</font> <font color=Cyan>(</font>n <font color=Cyan>`shiftR`</font> <font color=Magenta>3</font><font color=Cyan>)</font> <font color=Cyan>.&amp;.</font> <font color=Magenta>0x3</font>
<a name="line-592"></a>    b <font color=Red>=</font> <font color=Cyan>(</font>n <font color=Cyan>`shiftR`</font> <font color=Magenta>5</font><font color=Cyan>)</font> <font color=Cyan>.&amp;.</font> <font color=Magenta>0x1</font>
<a name="line-593"></a>    k <font color=Red>=</font> <font color=Cyan>(</font>n <font color=Cyan>`shiftR`</font> <font color=Magenta>6</font><font color=Cyan>)</font> <font color=Cyan>.&amp;.</font> <font color=Magenta>0x3</font>
<a name="line-594"></a>    decode <font color=Magenta>0</font> <font color=Red>=</font> clifford_id
<a name="line-595"></a>    decode <font color=Magenta>1</font> <font color=Red>=</font> clifford_H
<a name="line-596"></a>    decode <font color=Green><u>_</u></font> <font color=Red>=</font> clifford_SH
<a name="line-597"></a>    <font color=Cyan>(</font><font color=Cyan>*</font><font color=Cyan>)</font> <font color=Red>=</font> clifford_mult
<a name="line-598"></a>    <font color=Cyan>(</font><font color=Cyan>^</font><font color=Cyan>)</font> x n <font color=Red>=</font> foldl <font color=Cyan>(</font><font color=Cyan>*</font><font color=Cyan>)</font> clifford_id <font color=Cyan>(</font>genericReplicate n x<font color=Cyan>)</font>
<a name="line-599"></a>
<a name="line-600"></a><font color=Green><u>instance</u></font> ToGates Integer <font color=Green><u>where</u></font>
<a name="line-601"></a>  to_gates <font color=Red>=</font> to_gates <font color=Cyan>.</font> normalform_unpack
<a name="line-602"></a>
<a name="line-603"></a><font color=Green><u>instance</u></font> FromGates Integer <font color=Green><u>where</u></font>
<a name="line-604"></a>  from_gates <font color=Red>=</font> normalform_pack <font color=Cyan>.</font> from_gates
</pre>
</body>
</html>