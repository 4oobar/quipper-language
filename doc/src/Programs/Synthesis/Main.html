<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Haskell code</title>
</head>
<body>
<pre><a name="line-1"></a><font color=Blue><i>-- | This module provides a command line interface to the</i></font>
<a name="line-2"></a><font color=Blue><i>-- decomposition library.</i></font>
<a name="line-3"></a>
<a name="line-4"></a><font color=Green><u>module</u></font> Programs<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Main <font color=Green><u>where</u></font>
<a name="line-5"></a>
<a name="line-6"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Newsynth
<a name="line-7"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>SymReal
<a name="line-8"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>CliffordT
<a name="line-9"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Ring
<a name="line-10"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>Matrix
<a name="line-11"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>Synthesis<font color=Cyan>.</font>LaTeX
<a name="line-12"></a>
<a name="line-13"></a><font color=Green><u>import</u></font> Libraries<font color=Cyan>.</font>CommandLine
<a name="line-14"></a>
<a name="line-15"></a><font color=Blue><i>-- import other stuff</i></font>
<a name="line-16"></a><font color=Green><u>import</u></font> Control<font color=Cyan>.</font>Monad
<a name="line-17"></a><font color=Green><u>import</u></font> Data<font color=Cyan>.</font>Time
<a name="line-18"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Console<font color=Cyan>.</font>GetOpt
<a name="line-19"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Environment    
<a name="line-20"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Exit
<a name="line-21"></a><font color=Green><u>import</u></font> System<font color=Cyan>.</font>Random
<a name="line-22"></a><font color=Green><u>import</u></font> Text<font color=Cyan>.</font>Printf
<a name="line-23"></a>
<a name="line-24"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-25"></a><font color=Blue><i>-- * Option processing</i></font>
<a name="line-26"></a>
<a name="line-27"></a><a name="Options"></a><font color=Blue><i>-- | A data type to hold values set by command line options.</i></font>
<a name="line-28"></a><a name="Options"></a><font color=Green><u>data</u></font> Options <font color=Red>=</font> Options <font color=Cyan>{</font>
<a name="line-29"></a>  opt_digits <font color=Red>::</font> Double<font color=Cyan>,</font>       <font color=Blue><i>-- ^ Requested precision in digits (default: 10).</i></font>
<a name="line-30"></a>  opt_theta <font color=Red>::</font> SymReal<font color=Cyan>,</font>       <font color=Blue><i>-- ^ Angle to approximate.</i></font>
<a name="line-31"></a>  opt_hex   <font color=Red>::</font> Bool<font color=Cyan>,</font>          <font color=Blue><i>-- ^ Output operator in hex coding? (default: ASCII).</i></font>
<a name="line-32"></a>  opt_stats <font color=Red>::</font> Bool<font color=Cyan>,</font>          <font color=Blue><i>-- ^ Output statistics?</i></font>
<a name="line-33"></a>  opt_latex <font color=Red>::</font> Bool<font color=Cyan>,</font>          <font color=Blue><i>-- ^ Additional LaTeX output?</i></font>
<a name="line-34"></a>  opt_count <font color=Red>::</font> Integer<font color=Cyan>,</font>       <font color=Blue><i>-- ^ Repetition count for stats (default: 1).</i></font>
<a name="line-35"></a>  opt_rseed <font color=Red>::</font> Maybe StdGen   <font color=Blue><i>-- ^ An optional random seed.</i></font>
<a name="line-36"></a><font color=Cyan>}</font> <font color=Green><u>deriving</u></font> Show
<a name="line-37"></a>
<a name="line-38"></a><a name="defaultOptions"></a><font color=Blue><i>-- | The default options.</i></font>
<a name="line-39"></a><font color=Blue>defaultOptions</font> <font color=Red>::</font> Options
<a name="line-40"></a><font color=Blue>defaultOptions</font> <font color=Red>=</font> Options
<a name="line-41"></a>  <font color=Cyan>{</font> opt_digits <font color=Red>=</font> <font color=Magenta>10</font><font color=Cyan>,</font>
<a name="line-42"></a>    opt_theta <font color=Red>=</font> <font color=Magenta>0.0</font><font color=Cyan>,</font>
<a name="line-43"></a>    opt_hex   <font color=Red>=</font> False<font color=Cyan>,</font>
<a name="line-44"></a>    opt_stats <font color=Red>=</font> False<font color=Cyan>,</font>
<a name="line-45"></a>    opt_latex <font color=Red>=</font> False<font color=Cyan>,</font>
<a name="line-46"></a>    opt_count <font color=Red>=</font> <font color=Magenta>1</font><font color=Cyan>,</font>
<a name="line-47"></a>    opt_rseed <font color=Red>=</font> Nothing
<a name="line-48"></a>  <font color=Cyan>}</font>
<a name="line-49"></a>
<a name="line-50"></a><a name="options"></a><font color=Blue><i>-- | The list of command line options, in the format required by 'getOpt'.</i></font>
<a name="line-51"></a><font color=Blue>options</font> <font color=Red>::</font> <font color=Red>[</font>OptDescr <font color=Cyan>(</font>Options <font color=Red>-&gt;</font> IO Options<font color=Cyan>)</font><font color=Red>]</font>
<a name="line-52"></a><font color=Blue>options</font> <font color=Red>=</font>
<a name="line-53"></a>  <font color=Red>[</font> Option <font color=Red>[</font><font color=Magenta>'h'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"help"</font><font color=Red>]</font>    <font color=Cyan>(</font>NoArg help<font color=Cyan>)</font>           <font color=Magenta>"print usage info and exit"</font><font color=Cyan>,</font>
<a name="line-54"></a>    Option <font color=Red>[</font><font color=Magenta>'d'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"digits"</font><font color=Red>]</font>  <font color=Cyan>(</font>ReqArg digits <font color=Magenta>"&lt;n&gt;"</font><font color=Cyan>)</font>  <font color=Magenta>"set precision in decimal digits (default: 10)"</font><font color=Cyan>,</font>
<a name="line-55"></a>    Option <font color=Red>[</font><font color=Magenta>'b'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"bits"</font><font color=Red>]</font>    <font color=Cyan>(</font>ReqArg bits <font color=Magenta>"&lt;n&gt;"</font><font color=Cyan>)</font>    <font color=Magenta>"set precision in bits"</font><font color=Cyan>,</font>
<a name="line-56"></a>    Option <font color=Red>[</font><font color=Magenta>'e'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"epsilon"</font><font color=Red>]</font> <font color=Cyan>(</font>ReqArg epsilon <font color=Magenta>"&lt;n&gt;"</font><font color=Cyan>)</font> <font color=Magenta>"set precision as epsilon (default: 1e-10)"</font><font color=Cyan>,</font>
<a name="line-57"></a>    Option <font color=Red>[</font><font color=Magenta>'x'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"hex"</font><font color=Red>]</font>     <font color=Cyan>(</font>NoArg hex<font color=Cyan>)</font>            <font color=Magenta>"output hexadecimal coding (default: ASCII)"</font><font color=Cyan>,</font>
<a name="line-58"></a>    Option <font color=Red>[</font><font color=Magenta>'s'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"stats"</font><font color=Red>]</font>   <font color=Cyan>(</font>NoArg stats<font color=Cyan>)</font>          <font color=Magenta>"output statistics"</font><font color=Cyan>,</font>
<a name="line-59"></a>    Option <font color=Red>[</font><font color=Magenta>'l'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"latex"</font><font color=Red>]</font>   <font color=Cyan>(</font>NoArg latex<font color=Cyan>)</font>          <font color=Magenta>"additional output in LaTeX format"</font><font color=Cyan>,</font>
<a name="line-60"></a>    Option <font color=Red>[</font><font color=Magenta>'c'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"count"</font><font color=Red>]</font>   <font color=Cyan>(</font>ReqArg count <font color=Magenta>"&lt;n&gt;"</font><font color=Cyan>)</font>   <font color=Magenta>"average statistics over &lt;n&gt; runs (default: 1)"</font><font color=Cyan>,</font>
<a name="line-61"></a>    Option <font color=Red>[</font><font color=Magenta>'r'</font><font color=Red>]</font> <font color=Red>[</font><font color=Magenta>"rseed"</font><font color=Red>]</font>   <font color=Cyan>(</font>ReqArg rseed <font color=Magenta>"\"&lt;s&gt;\""</font><font color=Cyan>)</font> <font color=Magenta>"set optional random seed (default: random)"</font>
<a name="line-62"></a>  <font color=Red>]</font>
<a name="line-63"></a>    <font color=Green><u>where</u></font>
<a name="line-64"></a>      help <font color=Red>::</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-65"></a>      help o <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-66"></a>        usage
<a name="line-67"></a>        exitSuccess
<a name="line-68"></a>
<a name="line-69"></a>      digits <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-70"></a>      digits string o <font color=Red>=</font>
<a name="line-71"></a>        <font color=Green><u>case</u></font> parse_double string <font color=Green><u>of</u></font>
<a name="line-72"></a>          Just n <font color=Red>|</font> n <font color=Cyan>&gt;=</font> <font color=Magenta>0</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> opt_digits <font color=Red>=</font> n <font color=Cyan>}</font>
<a name="line-73"></a>          Just n <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Number of digits must not be negative -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-74"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid digits -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-75"></a>
<a name="line-76"></a>      bits <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-77"></a>      bits string o <font color=Red>=</font>
<a name="line-78"></a>        <font color=Green><u>case</u></font> parse_double string <font color=Green><u>of</u></font>
<a name="line-79"></a>          Just n <font color=Red>|</font> n <font color=Cyan>&gt;=</font> <font color=Magenta>0</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> opt_digits <font color=Red>=</font> n <font color=Cyan>*</font> logBase <font color=Magenta>10</font> <font color=Magenta>2</font> <font color=Cyan>}</font>
<a name="line-80"></a>          Just n <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Number of bits must not be negative -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-81"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid bits -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-82"></a>
<a name="line-83"></a>      epsilon <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-84"></a>      epsilon string o <font color=Red>=</font>
<a name="line-85"></a>        <font color=Green><u>case</u></font> parse_double string <font color=Green><u>of</u></font>
<a name="line-86"></a>          Just eps <font color=Red>|</font> eps <font color=Cyan>&lt;</font> <font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> eps <font color=Cyan>&gt;</font> <font color=Magenta>0</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> opt_digits <font color=Red>=</font> <font color=Blue><i>-</i></font>logBase <font color=Magenta>10</font> eps <font color=Cyan>}</font>
<a name="line-87"></a>          Just n <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Epsilon must be between 0 and 1 -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-88"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid epsilon -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-89"></a>
<a name="line-90"></a>      hex <font color=Red>::</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-91"></a>      hex o <font color=Red>=</font> return o <font color=Cyan>{</font> opt_hex <font color=Red>=</font> True <font color=Cyan>}</font>
<a name="line-92"></a>
<a name="line-93"></a>      stats <font color=Red>::</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-94"></a>      stats o <font color=Red>=</font> return o <font color=Cyan>{</font> opt_stats <font color=Red>=</font> True <font color=Cyan>}</font>
<a name="line-95"></a>
<a name="line-96"></a>      latex <font color=Red>::</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-97"></a>      latex o <font color=Red>=</font> return o <font color=Cyan>{</font> opt_latex <font color=Red>=</font> True <font color=Cyan>}</font>
<a name="line-98"></a>
<a name="line-99"></a>      count <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-100"></a>      count string o <font color=Red>=</font>
<a name="line-101"></a>        <font color=Green><u>case</u></font> parse_int string <font color=Green><u>of</u></font>
<a name="line-102"></a>          Just n <font color=Red>|</font> n <font color=Cyan>&gt;=</font> <font color=Magenta>1</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> opt_count <font color=Red>=</font> n <font color=Cyan>}</font>
<a name="line-103"></a>          Just n <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid count, must be positive -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-104"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid count -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-105"></a>
<a name="line-106"></a>      rseed <font color=Red>::</font> String <font color=Red>-&gt;</font> Options <font color=Red>-&gt;</font> IO Options
<a name="line-107"></a>      rseed string o <font color=Red>=</font>
<a name="line-108"></a>        <font color=Green><u>case</u></font> reads string <font color=Green><u>of</u></font>
<a name="line-109"></a>          <font color=Red>[</font><font color=Cyan>(</font>g<font color=Cyan>,</font> <font color=Magenta>""</font><font color=Cyan>)</font><font color=Red>]</font> <font color=Red>-&gt;</font> return o <font color=Cyan>{</font> opt_rseed <font color=Red>=</font> Just g <font color=Cyan>}</font>
<a name="line-110"></a>          <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid random seed -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-111"></a>
<a name="line-112"></a><a name="dopts"></a><font color=Blue><i>-- | Process /argv/-style command line options into an 'Options' structure.</i></font>
<a name="line-113"></a><font color=Blue>dopts</font> <font color=Red>::</font> <font color=Red>[</font>String<font color=Red>]</font> <font color=Red>-&gt;</font> IO Options
<a name="line-114"></a><font color=Blue>dopts</font> argv <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-115"></a>  <font color=Green><u>let</u></font> <font color=Cyan>(</font>o<font color=Cyan>,</font> args<font color=Cyan>,</font> errs<font color=Cyan>)</font> <font color=Red>=</font> getOpt Permute options argv
<a name="line-116"></a>  opts <font color=Red>&lt;-</font> foldM <font color=Cyan>(</font>flip id<font color=Cyan>)</font> defaultOptions o
<a name="line-117"></a>  when <font color=Cyan>(</font>errs <font color=Cyan>/=</font> []<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-118"></a>    optfail <font color=Cyan>(</font>concat errs<font color=Cyan>)</font>
<a name="line-119"></a>  <font color=Green><u>case</u></font> args <font color=Green><u>of</u></font>
<a name="line-120"></a>    [] <font color=Red>-&gt;</font> optfail <font color=Magenta>"Missing argument: theta.\n"</font>
<a name="line-121"></a>    <font color=Red>[</font>string<font color=Red>]</font> <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-122"></a>      <font color=Green><u>case</u></font> parse_SymReal string <font color=Green><u>of</u></font>
<a name="line-123"></a>        Just theta <font color=Red>-&gt;</font> return opts <font color=Cyan>{</font> opt_theta <font color=Red>=</font> theta <font color=Cyan>}</font>
<a name="line-124"></a>        <font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Invalid theta -- "</font> <font color=Cyan>++</font> string <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-125"></a>    h1<font color=Red><b>:</b></font>h2<font color=Red><b>:</b></font>[] <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Too many non-option arguments -- "</font> <font color=Cyan>++</font> h1 <font color=Cyan>++</font> <font color=Magenta>", "</font> <font color=Cyan>++</font> h2 <font color=Cyan>++</font> <font color=Magenta>"\n"</font><font color=Cyan>)</font>
<a name="line-126"></a>    h1<font color=Red><b>:</b></font>h2<font color=Red><b>:</b></font><font color=Green><u>_</u></font> <font color=Red>-&gt;</font> optfail <font color=Cyan>(</font><font color=Magenta>"Too many non-option arguments -- "</font> <font color=Cyan>++</font> h1 <font color=Cyan>++</font> <font color=Magenta>", "</font> <font color=Cyan>++</font> h2 <font color=Cyan>++</font> <font color=Magenta>"...\n"</font><font color=Cyan>)</font>
<a name="line-127"></a>
<a name="line-128"></a><a name="usage"></a><font color=Blue><i>-- | Print usage message to 'stdout'.</i></font>
<a name="line-129"></a><font color=Blue>usage</font> <font color=Red>::</font> IO ()
<a name="line-130"></a><font color=Blue>usage</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-131"></a>  putStr <font color=Cyan>(</font>usageInfo header options<font color=Cyan>)</font> 
<a name="line-132"></a>    <font color=Green><u>where</u></font> header <font color=Red>=</font> 
<a name="line-133"></a>            <font color=Magenta>"Usage: newsynth [OPTION...] &lt;theta&gt;\n"</font>
<a name="line-134"></a>            <font color=Cyan>++</font> <font color=Magenta>"Arguments:\n"</font>
<a name="line-135"></a>            <font color=Cyan>++</font> <font color=Magenta>" &lt;theta&gt;                   z-rotation angle. May be symbolic, e.g. pi/128\n"</font>
<a name="line-136"></a>            <font color=Cyan>++</font> <font color=Magenta>"Options:"</font>
<a name="line-137"></a>
<a name="line-138"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-139"></a><font color=Blue><i>-- * The main function</i></font>
<a name="line-140"></a>
<a name="line-141"></a><a name="main"></a><font color=Blue><i>-- | Main function: read options, then execute the appropriate tasks.</i></font>
<a name="line-142"></a><font color=Blue>main</font> <font color=Red>::</font> IO()
<a name="line-143"></a><font color=Blue>main</font> <font color=Red>=</font> <font color=Green><u>do</u></font>
<a name="line-144"></a>  <font color=Blue><i>-- Read options.</i></font>
<a name="line-145"></a>  argv <font color=Red>&lt;-</font> getArgs
<a name="line-146"></a>  options <font color=Red>&lt;-</font> dopts argv
<a name="line-147"></a>  <font color=Green><u>let</u></font> digits <font color=Red>=</font> opt_digits options
<a name="line-148"></a>  <font color=Green><u>let</u></font> prec <font color=Red>=</font> digits <font color=Cyan>*</font> logBase <font color=Magenta>2</font> <font color=Magenta>10</font>
<a name="line-149"></a>  <font color=Green><u>let</u></font> theta <font color=Red>=</font> opt_theta options
<a name="line-150"></a>  <font color=Green><u>let</u></font> count <font color=Red>=</font> opt_count options
<a name="line-151"></a>  <font color=Green><u>let</u></font> exponent <font color=Red>=</font> ceiling digits
<a name="line-152"></a>  
<a name="line-153"></a>  <font color=Blue><i>-- Set random seed.</i></font>
<a name="line-154"></a>  g <font color=Red>&lt;-</font> <font color=Green><u>case</u></font> opt_rseed options <font color=Green><u>of</u></font>
<a name="line-155"></a>    Nothing <font color=Red>-&gt;</font> newStdGen
<a name="line-156"></a>    Just g <font color=Red>-&gt;</font> return g
<a name="line-157"></a>  
<a name="line-158"></a>  <font color=Blue><i>-- Expand random seed opt_count times.</i></font>
<a name="line-159"></a>  <font color=Green><u>let</u></font> gs <font color=Red>=</font> expand_seed count g
<a name="line-160"></a>
<a name="line-161"></a>  <font color=Blue><i>-- Do it for each element of gs.</i></font>
<a name="line-162"></a>  stats <font color=Red>&lt;-</font> sequence <font color=Cyan>$</font> flip map <font color=Cyan>(</font>zip gs <font color=Red>[</font><font color=Magenta>1</font><font color=Red>..</font><font color=Red>]</font><font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Red>\</font><font color=Cyan>(</font>g<font color=Cyan>,</font>n<font color=Cyan>)</font> <font color=Red>-&gt;</font> <font color=Green><u>do</u></font>
<a name="line-163"></a>    
<a name="line-164"></a>    when <font color=Cyan>(</font>count <font color=Cyan>&gt;</font> <font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> <font color=Cyan>(</font>opt_stats options <font color=Cyan>||</font> opt_latex options<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-165"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Solution "</font> <font color=Cyan>++</font> show n <font color=Cyan>++</font> <font color=Magenta>":"</font><font color=Cyan>)</font>
<a name="line-166"></a>    
<a name="line-167"></a>    <font color=Blue><i>-- Payload.</i></font>
<a name="line-168"></a>    t0 <font color=Red>&lt;-</font> getCurrentTime
<a name="line-169"></a>    <font color=Green><u>let</u></font> <font color=Cyan>(</font>m<font color=Cyan>,</font>err<font color=Cyan>,</font>ct<font color=Cyan>)</font> <font color=Red>=</font> newsynth_stats prec theta g
<a name="line-170"></a>        gates <font color=Red>=</font> to_gates m
<a name="line-171"></a>    <font color=Green><u>if</u></font> opt_hex options <font color=Green><u>then</u></font>
<a name="line-172"></a>      printf <font color=Magenta>"%x\n"</font> <font color=Cyan>(</font>convert gates <font color=Red>::</font> Integer<font color=Cyan>)</font>
<a name="line-173"></a>      <font color=Green><u>else</u></font>
<a name="line-174"></a>      putStrLn <font color=Cyan>(</font><font color=Green><u>if</u></font> gates <font color=Cyan>==</font> [] <font color=Green><u>then</u></font> <font color=Magenta>"I"</font> <font color=Green><u>else</u></font> convert gates<font color=Cyan>)</font>
<a name="line-175"></a>    t1 <font color=Red>&lt;-</font> getCurrentTime
<a name="line-176"></a>
<a name="line-177"></a>    <font color=Blue><i>-- Print optional statistics</i></font>
<a name="line-178"></a>    <font color=Green><u>let</u></font> tcount <font color=Red>=</font> length <font color=Cyan>$</font> filter <font color=Cyan>(</font><font color=Cyan>==</font>T<font color=Cyan>)</font> gates
<a name="line-179"></a>    <font color=Green><u>let</u></font> secs <font color=Red>=</font> diffUTCTime t1 t0
<a name="line-180"></a>  
<a name="line-181"></a>    when <font color=Cyan>(</font>opt_stats options <font color=Cyan>||</font> opt_latex options<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-182"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Random seed: "</font> <font color=Cyan>++</font> show g<font color=Cyan>)</font>
<a name="line-183"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"T-count: "</font> <font color=Cyan>++</font> show tcount<font color=Cyan>)</font>
<a name="line-184"></a>    
<a name="line-185"></a>    when <font color=Cyan>(</font>opt_stats options<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-186"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Theta: "</font> <font color=Cyan>++</font> show theta<font color=Cyan>)</font>
<a name="line-187"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Epsilon: "</font> <font color=Cyan>++</font> show_exp <font color=Magenta>10</font> exponent <font color=Cyan>(</font>Just digits<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-188"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Matrix: "</font> <font color=Cyan>++</font> show m<font color=Cyan>)</font>
<a name="line-189"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Actual error: "</font> <font color=Cyan>++</font> show_exp <font color=Magenta>10</font> exponent err<font color=Cyan>)</font>
<a name="line-190"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Runtime: "</font> <font color=Cyan>++</font> show secs<font color=Cyan>)</font>
<a name="line-191"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Candidates tried: "</font> <font color=Cyan>++</font> show ct<font color=Cyan>)</font>
<a name="line-192"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Time/candidate: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>secs <font color=Cyan>/</font> fromInteger ct<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-193"></a>
<a name="line-194"></a>    <font color=Blue><i>-- Optional LaTeX output</i></font>
<a name="line-195"></a>    when <font color=Cyan>(</font>opt_latex options<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-196"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Gates: "</font> <font color=Cyan>++</font> showlatex gates<font color=Cyan>)</font>
<a name="line-197"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Theta: "</font> <font color=Cyan>++</font> showlatex theta<font color=Cyan>)</font>
<a name="line-198"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Epsilon: "</font> <font color=Cyan>++</font> showlatex_exp <font color=Magenta>5</font> exponent <font color=Cyan>(</font>Just digits<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-199"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Matrix: "</font> <font color=Cyan>++</font> showlatex <font color=Cyan>(</font>convert gates <font color=Red>::</font> U2 DOmega<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-200"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Actual error: "</font> <font color=Cyan>++</font> showlatex_exp <font color=Magenta>5</font> exponent err<font color=Cyan>)</font>
<a name="line-201"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Runtime: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>round_to <font color=Magenta>2</font> secs<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-202"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Candidates tried: "</font> <font color=Cyan>++</font> show ct<font color=Cyan>)</font>
<a name="line-203"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Time/candidate: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>round_to <font color=Magenta>4</font> <font color=Cyan>(</font>secs <font color=Cyan>/</font> fromInteger ct<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-204"></a>      
<a name="line-205"></a>    when <font color=Cyan>(</font>count <font color=Cyan>&gt;</font> <font color=Magenta>1</font> <font color=Cyan>&amp;&amp;</font> <font color=Cyan>(</font>opt_stats options <font color=Cyan>||</font> opt_latex options<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-206"></a>      putStrLn <font color=Magenta>""</font>
<a name="line-207"></a>
<a name="line-208"></a>    return <font color=Cyan>(</font>ct<font color=Cyan>,</font> secs<font color=Cyan>)</font>
<a name="line-209"></a>
<a name="line-210"></a>  <font color=Blue><i>-- If count &gt; 1, show summary stats.</i></font>
<a name="line-211"></a>  when <font color=Cyan>(</font>count <font color=Cyan>&gt;</font> <font color=Magenta>1</font><font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-212"></a>    <font color=Green><u>let</u></font> <font color=Cyan>(</font>cts<font color=Cyan>,</font> secss<font color=Cyan>)</font> <font color=Red>=</font> unzip stats
<a name="line-213"></a>    <font color=Green><u>let</u></font> ct_total <font color=Red>=</font> sum cts
<a name="line-214"></a>    <font color=Green><u>let</u></font> secs_total <font color=Red>=</font> sum secss
<a name="line-215"></a>    
<a name="line-216"></a>    when <font color=Cyan>(</font>opt_stats options <font color=Cyan>||</font> opt_latex options<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-217"></a>      putStrLn <font color=Magenta>"Summary:"</font>
<a name="line-218"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Number of runs: "</font> <font color=Cyan>++</font> show count<font color=Cyan>)</font>
<a name="line-219"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Total runtime: "</font> <font color=Cyan>++</font> show secs_total<font color=Cyan>)</font>
<a name="line-220"></a>    
<a name="line-221"></a>    when <font color=Cyan>(</font>opt_stats options<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-222"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Average runtime: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>secs_total <font color=Cyan>/</font> fromInteger count<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-223"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Average candidates tried: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>fromInteger ct_total <font color=Cyan>/</font> fromInteger count <font color=Red>::</font> Double<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-224"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"Average time/candidate: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>secs_total <font color=Cyan>/</font> fromInteger ct_total<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-225"></a>
<a name="line-226"></a>    when <font color=Cyan>(</font>opt_latex options<font color=Cyan>)</font> <font color=Cyan>$</font> <font color=Green><u>do</u></font>
<a name="line-227"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Average runtime: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>round_to <font color=Magenta>2</font> <font color=Cyan>(</font>secs_total <font color=Cyan>/</font> fromInteger count<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-228"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Average candidates tried: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>fromInteger ct_total <font color=Cyan>/</font> fromInteger count <font color=Red>::</font> Double<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-229"></a>      putStrLn <font color=Cyan>(</font><font color=Magenta>"LaTeX Average time/candidate: "</font> <font color=Cyan>++</font> show <font color=Cyan>(</font>round_to <font color=Magenta>4</font> <font color=Cyan>(</font>secs_total <font color=Cyan>/</font> fromInteger ct_total<font color=Cyan>)</font><font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-230"></a>
<a name="line-231"></a><font color=Blue><i>-- ----------------------------------------------------------------------</i></font>
<a name="line-232"></a><font color=Blue><i>-- * Miscellaneous</i></font>
<a name="line-233"></a>
<a name="line-234"></a><a name="round_to"></a><font color=Blue><i>-- | Round a 'RealFrac' value to the given number of decimals.                </i></font>
<a name="line-235"></a><font color=Blue>round_to</font> <font color=Red>::</font> <font color=Cyan>(</font>RealFrac r<font color=Cyan>)</font> <font color=Red>=&gt;</font> Integer <font color=Red>-&gt;</font> r <font color=Red>-&gt;</font> r               
<a name="line-236"></a><font color=Blue>round_to</font> n x <font color=Red>=</font> fromInteger <font color=Cyan>(</font>round <font color=Cyan>(</font>x <font color=Cyan>*</font> <font color=Magenta>10</font><font color=Cyan>^</font>n<font color=Cyan>)</font><font color=Cyan>)</font> <font color=Cyan>/</font> <font color=Magenta>10</font><font color=Cyan>^</font>n
<a name="line-237"></a>
<a name="line-238"></a><a name="show_exp"></a><font color=Blue><i>-- | Show the number 10[sup -/x/] in the format 10^(-n) or</i></font>
<a name="line-239"></a><font color=Blue><i>-- 1.23*10^(-n), with precision /d/ and exponent -/n/. A value of</i></font>
<a name="line-240"></a><font color=Blue><i>-- 'Nothing' is treated as 0.</i></font>
<a name="line-241"></a><font color=Blue><i>-- </i></font>
<a name="line-242"></a><font color=Blue><i>-- For example, display @0.316*10^(-13)@ instead of @10^(-13.5)@.</i></font>
<a name="line-243"></a><font color=Blue>show_exp</font> <font color=Red>::</font> <font color=Cyan>(</font>Show r<font color=Cyan>,</font> RealFrac r<font color=Cyan>,</font> Floating r<font color=Cyan>,</font> PrintfArg r<font color=Cyan>)</font> <font color=Red>=&gt;</font> Integer <font color=Red>-&gt;</font> Integer <font color=Red>-&gt;</font> Maybe r <font color=Red>-&gt;</font> String
<a name="line-244"></a><font color=Blue>show_exp</font> d n x
<a name="line-245"></a>  <font color=Red>|</font> y <font color=Cyan>==</font> <font color=Magenta>1</font>    <font color=Red>=</font> <font color=Magenta>"10^("</font> <font color=Cyan>++</font> show <font color=Cyan>(</font><font color=Blue><i>-</i></font>n<font color=Cyan>)</font> <font color=Cyan>++</font> <font color=Magenta>")"</font>
<a name="line-246"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> printf <font color=Cyan>(</font><font color=Magenta>"%."</font> <font color=Cyan>++</font> show d <font color=Cyan>++</font> <font color=Magenta>"f"</font><font color=Cyan>)</font> y <font color=Cyan>++</font> <font color=Magenta>"*10^("</font> <font color=Cyan>++</font> show <font color=Cyan>(</font><font color=Blue><i>-</i></font>n<font color=Cyan>)</font> <font color=Cyan>++</font> <font color=Magenta>")"</font>
<a name="line-247"></a>  <font color=Green><u>where</u></font>
<a name="line-248"></a>    y <font color=Red>=</font> <font color=Green><u>case</u></font> x <font color=Green><u>of</u></font>
<a name="line-249"></a>      Nothing <font color=Red>-&gt;</font> <font color=Magenta>0</font>
<a name="line-250"></a>      Just x <font color=Red>-&gt;</font> round_to d <font color=Cyan>(</font><font color=Magenta>10</font> <font color=Cyan>**</font> <font color=Cyan>(</font>fromInteger n <font color=Blue><i>-</i></font> x<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-251"></a>  
<a name="line-252"></a><a name="showlatex_exp"></a><font color=Blue><i>-- | Show the number 10[sup -/x/] in the format @10^{-n}@ or</i></font>
<a name="line-253"></a><font color=Blue><i>-- @1.23\\cdot 10^{-n}@, with precision /d/ and exponent -/n/. A value</i></font>
<a name="line-254"></a><font color=Blue><i>-- of 'Nothing' is treated as 0.</i></font>
<a name="line-255"></a><font color=Blue>showlatex_exp</font> <font color=Red>::</font> <font color=Cyan>(</font>Show r<font color=Cyan>,</font> RealFrac r<font color=Cyan>,</font> Floating r<font color=Cyan>,</font> PrintfArg r<font color=Cyan>)</font> <font color=Red>=&gt;</font> Integer <font color=Red>-&gt;</font> Integer <font color=Red>-&gt;</font> Maybe r <font color=Red>-&gt;</font> String
<a name="line-256"></a><font color=Blue>showlatex_exp</font> d n x 
<a name="line-257"></a>  <font color=Red>|</font> y <font color=Cyan>==</font> <font color=Magenta>1</font>    <font color=Red>=</font> <font color=Magenta>"10^{"</font> <font color=Cyan>++</font> show <font color=Cyan>(</font><font color=Blue><i>-</i></font>n<font color=Cyan>)</font> <font color=Cyan>++</font> <font color=Magenta>"}"</font>
<a name="line-258"></a>  <font color=Red>|</font> otherwise <font color=Red>=</font> printf <font color=Cyan>(</font><font color=Magenta>"%."</font> <font color=Cyan>++</font> show d <font color=Cyan>++</font> <font color=Magenta>"f"</font><font color=Cyan>)</font> y <font color=Cyan>++</font> <font color=Magenta>"\\cdot 10^{"</font> <font color=Cyan>++</font> show <font color=Cyan>(</font><font color=Blue><i>-</i></font>n<font color=Cyan>)</font> <font color=Cyan>++</font> <font color=Magenta>"}"</font>
<a name="line-259"></a>  <font color=Green><u>where</u></font>
<a name="line-260"></a>    y <font color=Red>=</font> <font color=Green><u>case</u></font> x <font color=Green><u>of</u></font>
<a name="line-261"></a>      Nothing <font color=Red>-&gt;</font> <font color=Magenta>0</font>
<a name="line-262"></a>      Just x <font color=Red>-&gt;</font> round_to d <font color=Cyan>(</font><font color=Magenta>10</font> <font color=Cyan>**</font> <font color=Cyan>(</font>fromInteger n <font color=Blue><i>-</i></font> x<font color=Cyan>)</font><font color=Cyan>)</font>
<a name="line-263"></a>
<a name="line-264"></a><a name="expand_seed"></a><font color=Blue><i>-- | Expand a random seed /g/ into a list [/g/[sub 1], &#8230;, </i></font>
<a name="line-265"></a><font color=Blue><i>-- /g/[sub /n/]] of /n/ random seeds. This is done in such a way that</i></font>
<a name="line-266"></a><font color=Blue><i>-- /g/[sub 1] = /g/.</i></font>
<a name="line-267"></a><font color=Blue>expand_seed</font> <font color=Red>::</font> <font color=Cyan>(</font>RandomGen g<font color=Cyan>)</font> <font color=Red>=&gt;</font> Integer <font color=Red>-&gt;</font> g <font color=Red>-&gt;</font> <font color=Red>[</font>g<font color=Red>]</font>
<a name="line-268"></a><font color=Blue>expand_seed</font> <font color=Magenta>0</font> g <font color=Red>=</font> []
<a name="line-269"></a><font color=Blue>expand_seed</font> n g <font color=Red>=</font> g<font color=Red><b>:</b></font>expand_seed <font color=Cyan>(</font>n<font color=Blue><i>-</i></font><font color=Magenta>1</font><font color=Cyan>)</font> g' <font color=Green><u>where</u></font>
<a name="line-270"></a>  <font color=Cyan>(</font>g'<font color=Cyan>,</font> <font color=Green><u>_</u></font><font color=Cyan>)</font> <font color=Red>=</font> split g
</pre>
</body>
</html>